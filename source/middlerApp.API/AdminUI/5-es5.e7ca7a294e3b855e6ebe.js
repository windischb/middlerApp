!function(){function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var c,l=e[Symbol.iterator]();!(i=(c=l.next()).done)&&(n.push(c.value),!t||n.length!==t);i=!0);}catch(a){r=!0,o=a}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}return n}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=a(e);if(t){var r=a(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l(this,n)}}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{CgPW:function(n,i,o){"use strict";o.r(i),o.d(i,"EndpointRulesModule",(function(){return At}));var l,a,u,f=o("2kYt"),b=o("sEIs"),h=o("EM62"),p=o("ZF+8"),g=function e(){d(this,e)},m=o("8j5Y"),v=o("C05f"),S=function(){function e(t){d(this,e),this.Item=t,this._showDetails=!1,this.ShowDetailsSubject$=new v.a(!1),this.ShowDetails$=this.ShowDetailsSubject$.asObservable()}return s(e,[{key:"ShowDetails",set:function(e){this._showDetails=e,this.ShowDetailsSubject$.next(this._showDetails)},get:function(){return this._showDetails}}]),e}(),O=o("oqI+"),y=function(){function e(){d(this,e),this.AllItems=[],this.Selected=[]}return s(e,[{key:"Single",get:function(){var e;return 1===(null===(e=this.Selected)||void 0===e?void 0:e.length)?this.Selected[0]:null}},{key:"IsFirst",get:function(){return this.Single?this.AllItems[0].Id===this.Single.Id:null}},{key:"IsLast",get:function(){return this.Single?this.AllItems[this.AllItems.length-1].Id===this.Single.Id:null}}]),e}(),x=o("vobO"),T=o("YtkY"),k=o("J+dc"),z=o("kZjU"),C=o("D57K"),w=o("XzLU"),I=((a=function(e){r(n,e);var t=c(n);function n(){return d(this,n),t.call(this)}return n}(w.a)).\u0275fac=function(e){return new(e||a)},a.\u0275prov=h.Jb({token:a,factory:a.\u0275fac,providedIn:"root"}),a=Object(C.a)([Object(w.e)({name:"endpoint-rules",idKey:"Id"})],a)),M=((l=function(e){r(n,e);var t=c(n);function n(e){var i;return d(this,n),(i=t.call(this,e)).store=e,i}return n}(w.c)).\u0275fac=function(e){return new(e||l)(h.Xb(I))},l.\u0275prov=h.Jb({token:l,factory:l.\u0275fac,providedIn:"root"}),l),P=new x.e({"Content-Type":"application/json-patch+json",Accept:"application/json"}),R=((u=function(){function e(t,n,i,r){var o=this;d(this,e),this.http=t,this.message=n,this.endpointRulesStore=i,this.endpointRulesQuery=r,this.RulesOrder={},this.typings$=new v.a([]),this.Subscribe(),this.message.RunOnEveryReconnect((function(){return o.GetAllRules().subscribe()})),this.message.RunOnEveryReconnect((function(){return o.GetTypings()}))}return s(e,[{key:"Subscribe",value:function(){var e=this;this.message.Stream("MiddlerRule.Subscribe").pipe(Object(m.a)((function(t){switch(t.Action){case"Created":e.endpointRulesStore.add(t.Payload);break;case"Updated":if(t.MetaData.UpdateOrder){var n=t.Payload;Object.keys(n).forEach((function(t){e.endpointRulesStore.update(t,{Order:n[t]})}))}else e.endpointRulesStore.update(t.Payload.Id,(function(e){return t.Payload}));break;case"Deleted":e.endpointRulesStore.update(t.Payload,(function(e){return Object.assign(Object.assign({},e),{Deleted:!0})})),e.endpointRulesStore.remove(t.Payload)}}))).subscribe()}},{key:"ReLoadRules",value:function(){var e=this;this.http.get("/api/endpoint-rules").pipe(Object(m.a)((function(t){return e.endpointRulesStore.set(t)}))).subscribe()}},{key:"GetAllRules",value:function(e){var t=this;return!e&&this.endpointRulesQuery.getHasCache()||this.ReLoadRules(),this.endpointRulesQuery.selectAll().pipe(Object(T.a)((function(e){return e.sort(t.SortRules)})))}},{key:"GetRule",value:function(e){return this.http.get("/api/endpoint-rules/"+e)}},{key:"Add",value:function(e){return this.http.post("/api/endpoint-rules",e)}},{key:"Remove",value:function(e){return this.http.delete("/api/endpoint-rules/"+e)}},{key:"Update",value:function(e,t){return this.http.put("/api/endpoint-rules/"+e,t)}},{key:"SortRules",value:function(e,t){return e.Order>t.Order?1:e.Order<t.Order?-1:0}},{key:"GetNextLastOrder",value:function(){var e=this.endpointRulesQuery.getAll();return e&&0!==e.length?Math.trunc(Math.max.apply(Math,t(e.map((function(e){return e.Order}))))+10):10}},{key:"UpdateRuleOrder",value:function(e,t){var n={};n[e.Id]=t,this.http.post("/api/endpoint-rules/order",n,{headers:P}).subscribe()}},{key:"SetRuleEnabled",value:function(e,t){this.http.put("/api/endpoint-rules/".concat(e.Id,"/enabled/").concat(t),null,{headers:P}).subscribe()}},{key:"GetTypings",value:function(){var e=this;this.message.Invoke("MiddlerRule.GetTypings").pipe(Object(k.a)(1),Object(m.a)((function(t){var n=t.map((function(e){return new z.b(e.Key,e.Value,!1)}));e.typings$.next(n)}))).subscribe()}}]),e}()).\u0275fac=function(e){return new(e||u)(h.Xb(x.c),h.Xb(p.d),h.Xb(I),h.Xb(M))},u.\u0275prov=h.Jb({token:u,factory:u.\u0275fac,providedIn:"root"}),u),A=o("5m6l"),_=function e(){d(this,e),this.Enabled=!0},D=function e(){d(this,e),this.RewriteTo=""},F=function(e){r(n,e);var t=c(n);function n(){var e;return d(this,n),(e=t.apply(this,arguments)).ActionType="UrlRewrite",e.Parameters=new D,e.Terminating=!1,e}return n}(_),N=o("nIj0"),H=o("l+TO"),E=o("duTG"),U=o("ZTwM"),L=o("1spV");function j(e,t){1&e&&(h.Tb(0,"div"),h.Fc(1,"Action"),h.Sb())}var G,B=["*"],V=((G=function e(){d(this,e),this.ok=new h.n,this.cancel=new h.n}).\u0275fac=function(e){return new(e||G)},G.\u0275cmp=h.Hb({type:G,selectors:[["action-basic-modal"]],hostAttrs:[1,"flex-grow-column","action-basic-modal"],inputs:{form:"form"},outputs:{ok:"ok",cancel:"cancel"},ngContentSelectors:B,decls:15,vars:2,consts:[[1,"modal-header",2,"padding","10px !important","display","flex","margin-bottom","1px"],[2,"font-size","2em","font-weight","bold","line-height","1.4285em","color","whitesmoke","margin","auto"],["dbPortal","ActionModalHeader-Left",1,"Irgendwos"],["left","dbPortal"],[4,"ngIf"],[2,"flex-grow","1"],["dbPortal","ActionModalHeader-Right"],[1,"modal-content"],[1,"modal-footer",2,"margin-bottom","0px","margin-top","1px"],["nz-button","","nzType","primary","nzBlock","",2,"height","40px",3,"disabled","click"],["nz-button","","nzType","default","nzBlock","",1,"secondary",2,"height","40px",3,"click"]],template:function(e,t){if(1&e&&(h.kc(),h.Tb(0,"div",0),h.Tb(1,"div",1),h.Pb(2,2,3),h.Dc(4,j,2,0,"div",4),h.Sb(),h.Ob(5,"div",5),h.Tb(6,"div"),h.Pb(7,6),h.Sb(),h.Sb(),h.Tb(8,"div",7),h.jc(9),h.Sb(),h.Tb(10,"div",8),h.Tb(11,"button",9),h.bc("click",(function(){return t.ok.next()})),h.Fc(12,"Submit"),h.Sb(),h.Tb(13,"button",10),h.bc("click",(function(){return t.cancel.next()})),h.Fc(14,"Cancel"),h.Sb(),h.Sb()),2&e){var n=h.tc(3);h.zb(4),h.lc("ngIf",!n.hasSource),h.zb(7),h.lc("disabled",!t.form.valid)}},directives:[H.d,f.o,E.a,U.a,L.a],styles:["[_nghost-%COMP%]{box-shadow:0 0 1px 2px #dedddd;max-width:100%;max-height:100%;background-color:#dedddd}",".modal-header[_ngcontent-%COMP%]{background-color:#292f3b!important}.modal-header[_ngcontent-%COMP%], .modal-header[_ngcontent-%COMP%]   .ui.huge.header[_ngcontent-%COMP%]{color:#fff!important}.modal-content[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]{border:none!important;display:flex}.modal-content[_ngcontent-%COMP%]{flex-grow:1;max-width:100%;max-height:100%}.flex-grow-column[_ngcontent-%COMP%], .modal-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], action-basic-modal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], action-basic-modal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   ng-component[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column}action-basic-modal[_ngcontent-%COMP%]   div[name][_ngcontent-%COMP%]{min-height:1.28571429em}.action-basic-modal[_ngcontent-%COMP%]{box-shadow:0 0 3px 1px #bfbfbf!important}"]}),G),K=o("PlhU"),J=o("Mr8s"),Q=o("mybp");function X(e,t){1&e&&h.Fc(0," Url - Rewrite ")}var q,W=((q=function(){function e(t,n){d(this,e),this.fb=t,this.context=n}return s(e,[{key:"ngOnInit",value:function(){this.form=this.fb.group({RewriteTo:[]}),this.form.patchValue(this.context.data.Parameters)}},{key:"ok",value:function(){this.context.invoke("OK",this.form.value)}},{key:"cancel",value:function(){this.context.handle.Close()}}]),e}()).\u0275fac=function(e){return new(e||q)(h.Nb(N.e),h.Nb(A.d))},q.\u0275cmp=h.Hb({type:q,selectors:[["ng-component"]],decls:7,vars:2,consts:[[3,"form","ok","cancel"],["nz-form","",2,"width","100%",3,"formGroup"],["nzRequired","","nzFor","RewriteTo"],["nz-input","","formControlName","RewriteTo","id","RewriteTo",2,"width","100%"],["dbPortalTemplate","ActionModalHeader-Left"]],template:function(e,t){1&e&&(h.Tb(0,"action-basic-modal",0),h.bc("ok",(function(){return t.ok()}))("cancel",(function(){return t.cancel()})),h.Tb(1,"form",1),h.Tb(2,"nz-form-label",2),h.Fc(3,"RewriteTo"),h.Sb(),h.Tb(4,"nz-form-control"),h.Ob(5,"input",3),h.Sb(),h.Dc(6,X,1,0,"ng-template",4),h.Sb(),h.Sb()),2&e&&(h.lc("form",t.form),h.zb(1),h.lc("formGroup",t.form))},directives:[V,N.r,N.n,K.b,N.h,J.a,K.d,K.a,Q.b,N.d,N.m,N.g,H.e],styles:[""]}),q),Y=function e(){d(this,e),this.RedirectTo="",this.Permanent=!1,this.PreserveMethod=!0},Z=function(e){r(n,e);var t=c(n);function n(){var e;return d(this,n),(e=t.apply(this,arguments)).ActionType="UrlRedirect",e.Parameters=new Y,e.Terminating=!0,e}return n}(_),ee=o("MaY1");function te(e,t){1&e&&h.Fc(0," Url - Redirect ")}var ne,ie=((ne=function(){function e(t,n){d(this,e),this.fb=t,this.context=n}return s(e,[{key:"ngOnInit",value:function(){this.form=this.fb.group({RedirectTo:[],Permanent:[],PreserveMethod:[]}),this.form.patchValue(this.context.data.Parameters)}},{key:"ok",value:function(){this.context.invoke("OK",this.form.value)}},{key:"cancel",value:function(){this.context.handle.Close()}}]),e}()).\u0275fac=function(e){return new(e||ne)(h.Nb(N.e),h.Nb(A.d))},ne.\u0275cmp=h.Hb({type:ne,selectors:[["ng-component"]],decls:14,vars:2,consts:[[3,"form","ok","cancel"],["nz-form","",2,"width","100%",3,"formGroup"],["nzRequired","","nzFor","RedirectTo"],["nz-input","","formControlName","RedirectTo","id","RedirectTo",2,"width","100%"],[2,"display","flex","flex-direction","row"],[1,"field"],["nz-checkbox","","formControlName","PreserveMethod"],["nz-checkbox","","formControlName","Permanent"],["dbPortalTemplate","ActionModalHeader-Left"]],template:function(e,t){1&e&&(h.Tb(0,"action-basic-modal",0),h.bc("ok",(function(){return t.ok()}))("cancel",(function(){return t.cancel()})),h.Tb(1,"form",1),h.Tb(2,"nz-form-label",2),h.Fc(3,"RedirectTo"),h.Sb(),h.Tb(4,"nz-form-control"),h.Ob(5,"input",3),h.Sb(),h.Tb(6,"div",4),h.Tb(7,"div",5),h.Tb(8,"label",6),h.Fc(9,"PreserveMethod"),h.Sb(),h.Sb(),h.Tb(10,"div",5),h.Tb(11,"label",7),h.Fc(12,"Permanent"),h.Sb(),h.Sb(),h.Sb(),h.Dc(13,te,1,0,"ng-template",8),h.Sb(),h.Sb()),2&e&&(h.lc("form",t.form),h.zb(1),h.lc("formGroup",t.form))},directives:[V,N.r,N.n,K.b,N.h,J.a,K.d,K.a,Q.b,N.d,N.m,N.g,ee.a,H.e],styles:[".field[_ngcontent-%COMP%]{padding-top:5px}"]}),ne),re=function e(){d(this,e),this.Language="Typescript"},oe=function(e){r(n,e);var t=c(n);function n(){var e;return d(this,n),(e=t.apply(this,arguments)).ActionType="Script",e.Parameters=new re,e.Terminating=!0,e}return n}(_),ce=o("ox+w");function le(e,t){1&e&&h.Fc(0," Script ")}function ae(e,t){1&e&&(h.Tb(0,"div",6),h.Tb(1,"div",7),h.Tb(2,"nz-select",8),h.Ob(3,"nz-option",9),h.Ob(4,"nz-option",10),h.Ob(5,"nz-option",11),h.Sb(),h.Sb(),h.Sb())}var ue,se,de=function(){return{noLib:!0}},fe=((se=function(){function e(t,n,i){d(this,e),this.fb=t,this.context=n,this.rulesService=i,this.typings$=this.rulesService.typings$.pipe(Object(m.a)((function(e){return console.log(e)})))}return s(e,[{key:"ngOnInit",value:function(){this.form=this.fb.group({Language:[],SourceCode:[]}),this.context.data.Parameters.Language||(this.context.data.Parameters.Language="Typescript"),this.form.patchValue(this.context.data.Parameters)}},{key:"initRestrictionsAccordion",value:function(e){$(e.nativeElement).accordion()}},{key:"ok",value:function(){this.context.invoke("OK",this.form.value)}},{key:"cancel",value:function(){this.context.handle.Close()}}]),e}()).\u0275fac=function(e){return new(e||se)(h.Nb(N.e),h.Nb(A.d),h.Nb(R))},se.\u0275cmp=h.Hb({type:se,selectors:[["ng-component"]],decls:7,vars:8,consts:[[3,"form","ok","cancel"],["nz-form","",1,"flex-grow-column",2,"width","100%",3,"formGroup"],[1,"field","flex-grow-column"],["formControlName","SourceCode",2,"max-width","100%","max-height","100%","position","relative",3,"language","typings","tsOptions"],["dbPortalTemplate","ActionModalHeader-Left"],["dbPortalTemplate","ActionModalHeader-Right"],[1,"fields"],[2,"width","180px"],["formControlName","Language",2,"width","100%"],["nzLabel","Typescript","nzValue","Typescript"],["nzLabel","Javascript","nzValue","Javascript"],["nzLabel","Powershell","nzValue","Powershell"]],template:function(e,t){1&e&&(h.Tb(0,"action-basic-modal",0),h.bc("ok",(function(){return t.ok()}))("cancel",(function(){return t.cancel()})),h.Tb(1,"form",1),h.Tb(2,"div",2),h.Ob(3,"db-editor",3),h.fc(4,"async"),h.Sb(),h.Dc(5,le,1,0,"ng-template",4),h.Dc(6,ae,6,0,"ng-template",5),h.Sb(),h.Sb()),2&e&&(h.lc("form",t.form),h.zb(1),h.lc("formGroup",t.form),h.zb(2),h.lc("language",t.form.value.Language)("typings",h.gc(4,5,t.typings$))("tsOptions",h.nc(7,de)))},directives:[V,N.r,N.n,K.b,N.h,z.a,N.m,N.g,H.e,ce.b,ce.a],pipes:[f.b],styles:[""]}),se),be=((ue=function(){function e(t,n){d(this,e),this.modal=t,this.componentFactoryResolver=n}return s(e,[{key:"GetIcon",value:function(e){switch(e.ActionType){case"UrlRedirect":return"rollback";case"UrlRewrite":return"edit";case"Proxy":return"fa#random";case"Script":return"code"}return"hat wizard"}},{key:"GetModal",value:function(e){switch(e.toLowerCase()){case"urlredirect":return this.modal.FromComponent(ie).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"50%",maxWidth:"500px"}}).CloseOnOutsideClick();case"urlrewrite":return this.modal.FromComponent(W).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"50%",maxWidth:"500px"}}).CloseOnOutsideClick();case"script":return this.modal.FromComponent(fe).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"80%",height:"90%"}}).CloseOnOutsideClick()}}}]),e}()).\u0275fac=function(e){return new(e||ue)(h.Xb(A.b),h.Xb(h.j))},ue.\u0275prov=h.Jb({token:ue,factory:ue.\u0275fac,providedIn:"root"}),ue),he=o("2rm1"),pe=o("t8yx"),ge=o("XS/p"),me=["contextMenu"],ve=["addRuleTemplate"];function Se(e,t){1&e&&(h.Tb(0,"div",8),h.Tb(1,"div",9),h.Fc(2,"Currently there is nothing..."),h.Sb(),h.Tb(3,"p"),h.Fc(4,"Use the ContextMenu to create your first rule!"),h.Sb(),h.Sb())}function Oe(e,t){if(1&e&&(h.Tb(0,"span",21),h.Ob(1,"db-icon",22),h.Sb()),2&e){var n=t.$implicit,i=h.ec(2);h.lc("nzTooltipTitle",n.ActionType),h.zb(1),h.lc("icon",i.GetIcon(n))}}function ye(e,t){1&e&&h.Ob(0,"div",23)}function xe(e,t){if(1&e){var n=h.Ub();h.Tb(0,"div",10),h.bc("click",(function(e){h.vc(n);var i=t.$implicit;return h.ec().clickAction(e,i)}))("contextmenu",(function(e){h.vc(n);var i=t.$implicit,r=h.ec(),o=h.tc(11);return r.openItemContextMenu(e,o,i)}))("dblclick",(function(){h.vc(n);var e=t.$implicit;return h.ec().editRule(e.Item.Id)})),h.Tb(1,"div",11),h.Tb(2,"div",12),h.Ob(3,"db-icon",13),h.Sb(),h.Tb(4,"div",14),h.Tb(5,"div",15),h.Fc(6),h.Sb(),h.Tb(7,"div"),h.Fc(8),h.Sb(),h.Sb(),h.Tb(9,"div",16),h.Tb(10,"div"),h.Fc(11),h.Sb(),h.Tb(12,"div"),h.Fc(13),h.Sb(),h.Sb(),h.Tb(14,"div",17),h.Tb(15,"div",18),h.Tb(16,"div"),h.Fc(17),h.Sb(),h.Dc(18,Oe,2,2,"span",19),h.Sb(),h.Dc(19,ye,1,0,"div",20),h.Sb(),h.Sb(),h.Sb()}if(2&e){var i=t.$implicit,r=h.ec();h.Fb("selected",i.Selected)("disabled",!i.Item.Enabled),h.zb(6),h.Gc(i.Item.Name),h.zb(2),h.Gc(i.Item.Path),h.zb(3),h.Gc(i.Item.Scheme),h.zb(2),h.Gc(i.Item.Hostname),h.zb(4),h.Hc(" ",(null==i.Item.Actions?null:i.Item.Actions.length)||0," Actions "),h.zb(1),h.lc("ngForOf",i.Item.Actions),h.zb(1),h.lc("ngIf",r.IsRuleTerminating(i.Item))}}function Te(e,t){if(1&e){var n=h.Ub();h.Tb(0,"ul",24),h.Tb(1,"li",25),h.Tb(2,"ul",26),h.Tb(3,"li",27),h.bc("click",(function(){return h.vc(n),h.ec().CreateRuleOnTop()})),h.Ob(4,"db-icon",28),h.Fc(5," Top "),h.Sb(),h.Tb(6,"li",27),h.bc("click",(function(){return h.vc(n),h.ec().CreateRuleOnBottom()})),h.Ob(7,"db-icon",29),h.Fc(8," Bottom "),h.Sb(),h.Sb(),h.Sb(),h.Sb()}}function ke(e,t){if(1&e){var n=h.Ub();h.Tb(0,"li",27),h.bc("click",(function(){h.vc(n);var e=h.ec().$implicit;return h.ec().SetRuleEnabled(e.Single,!0)})),h.Ob(1,"db-icon",34),h.Fc(2," Enable "),h.Sb()}}function ze(e,t){if(1&e){var n=h.Ub();h.Tb(0,"li",27),h.bc("click",(function(){h.vc(n);var e=h.ec().$implicit;return h.ec().SetRuleEnabled(e.Single,!1)})),h.Ob(1,"db-icon",35),h.Fc(2," Disable "),h.Sb()}}function Ce(e,t){if(1&e){var n=h.Ub();h.Tb(0,"li",25),h.Tb(1,"ul",26),h.Tb(2,"li",27),h.bc("click",(function(){return h.vc(n),h.ec(2).CreateRuleOnTop()})),h.Ob(3,"db-icon",28),h.Fc(4," Top "),h.Sb(),h.Tb(5,"li",27),h.bc("click",(function(){h.vc(n);var e=h.ec().$implicit;return h.ec().CreateRuleBefore(e.Single)})),h.Ob(6,"db-icon",36),h.Fc(7," Before "),h.Sb(),h.Tb(8,"li",27),h.bc("click",(function(){h.vc(n);var e=h.ec().$implicit;return h.ec().CreateRuleAfter(e.Single)})),h.Ob(9,"db-icon",37),h.Fc(10," After "),h.Sb(),h.Tb(11,"li",27),h.bc("click",(function(){return h.vc(n),h.ec(2).CreateRuleOnBottom()})),h.Ob(12,"db-icon",29),h.Fc(13," Bottom "),h.Sb(),h.Sb(),h.Sb()}}function we(e,t){if(1&e){var n=h.Ub();h.Tb(0,"ul",24),h.Dc(1,ke,3,0,"li",30),h.Dc(2,ze,3,0,"li",30),h.Dc(3,Ce,14,0,"li",31),h.Ob(4,"li",32),h.Tb(5,"li",27),h.bc("click",(function(){h.vc(n);var e=t.$implicit;return h.ec().RemoveRules(e.Selected)})),h.Ob(6,"db-icon",33),h.Fc(7," Remove "),h.Sb(),h.Sb()}if(2&e){var i=t.$implicit;h.zb(1),h.lc("ngIf",!1===(null==i.Single?null:i.Single.Enabled)),h.zb(1),h.lc("ngIf",!0===(null==i.Single?null:i.Single.Enabled)),h.zb(1),h.lc("ngIf",i.Single)}}var Ie,Me,Pe=function(){return[]},Re=((Me=function(){function e(t,n,i,r,o,c,l,a){d(this,e),this.rulesService=t,this.cref=n,this.overlay=i,this.viewContainerRef=r,this.router=o,this.route=c,this.actionHelper=l,this.endpointRulesQuery=a,this._rules=[],this.rulesSubject$=new v.a(this._rules),this.rules$=this.rulesSubject$.asObservable(),this.rulesChanged=new h.n,this.selected=[],this.registered=[],this.onTouched=function(){}}return s(e,[{key:"ngOnInit",value:function(){var e=this;this.rulesService.GetAllRules().pipe(Object(m.a)((function(t){e.rules=t}))).subscribe()}},{key:"ngAfterViewInit",value:function(){}},{key:"clickAction",value:function(e,t){e.ctrlKey?t.Selected=!t.Selected:this._rules=this._rules.map((function(e){return e.Selected=e==t,e}))}},{key:"openOuterContextMenu",value:function(e,t){var n;e.stopPropagation(),null===(n=this.ContextMenu)||void 0===n||n.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,null)}},{key:"openItemContextMenu",value:function(e,t,n){var i;e.stopPropagation();var r=this._rules.filter((function(e){return e.Selected}));0!=r.length&&r.includes(n)||(this._rules=this._rules.map((function(e){return e.Selected=e==n,e}))),null===(i=this.ContextMenu)||void 0===i||i.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,this.BuildContext())}},{key:"DeSelectAll",value:function(){console.log("Deselect"),this._rules=this._rules.map((function(e){return e.Selected=!1,e}))}},{key:"SetRuleEnabled",value:function(e,t){var n;null===(n=this.ContextMenu)||void 0===n||n.Close(),this.rulesService.SetRuleEnabled(e,t)}},{key:"GetActionByIndex",value:function(e){return this.rules[e]}},{key:"GetActionById",value:function(e){return this.rules.find((function(t){return t.Id===e}))}},{key:"ClearSelection",value:function(){this.selected=[],this.cref.markForCheck()}},{key:"BuildContext",value:function(){var e=new y;return e.AllItems=this.rules,e.Selected=this._rules.filter((function(e){return e.Selected})).map((function(e){return e.Item})),e}},{key:"IsRuleTerminating",value:function(e){return!!e.Actions&&-1!=e.Actions.findIndex((function(e){return e.Enabled&&e.Terminating}))}},{key:"initContextMenu",value:function(e){}},{key:"CreateRuleOnTop",value:function(){var e=new g;e.Enabled=!1,e.Order=this.rules&&0!=this.rules.length?this.rules[0].Order/2:10,this.rulesService.Add(e).subscribe(),this.ContextMenu.Close()}},{key:"CreateRuleBefore",value:function(e){var t=this.rules.findIndex((function(t){return t.Order===e.Order})),n=new g;n.Enabled=!1,n.Order=0==t?e.Order/2:e.Order-(e.Order-this.rules[t-1].Order)/2,console.log(n),this.rulesService.Add(n).subscribe(),this.ContextMenu.Close()}},{key:"CreateRuleAfter",value:function(e){var t=this.rules.findIndex((function(t){return t.Order===e.Order})),n=new g;n.Enabled=!1,n.Order=t==this.rules.length-1?this.rulesService.GetNextLastOrder():e.Order+(this.rules[t+1].Order-e.Order)/2,console.log(n),this.rulesService.Add(n).subscribe(),this.ContextMenu.Close()}},{key:"CreateRuleOnBottom",value:function(){var e=new g;e.Enabled=!1,e.Order=this.rulesService.GetNextLastOrder(),this.rulesService.Add(e).subscribe(),this.ContextMenu.Close()}},{key:"RemoveRules",value:function(e){var t=this;e.forEach((function(e){return t.rulesService.Remove(e.Id).subscribe()})),this.ContextMenu.Close()}},{key:"editRule",value:function(e){this.router.navigate([e],{relativeTo:this.route})}},{key:"calculateRuleOrder",value:function(e){if(0===this.rules.length)return 10;if(0===e)return this.rules[0].Order/2;if(e>=this.rules.length)return this.rulesService.GetNextLastOrder();var t=this.rules[e-1].Order;return(this.rules[e].Order-t)/2+t}},{key:"drop",value:function(e){if(e.previousContainer===e.container){var t=this.endpointRulesQuery.getAll().sort(this.rulesService.SortRules),n=t[e.previousIndex],i=null;if(e.previousIndex<e.currentIndex?i="forward":e.previousIndex>e.currentIndex&&(i="back"),!i)return;if("forward"===i)if(e.currentIndex===t.length-1)this.rulesService.UpdateRuleOrder(n,this.rulesService.GetNextLastOrder());else{var r=t[e.currentIndex];this.rulesService.UpdateRuleOrder(n,(t[e.currentIndex+1].Order-r.Order)/2+r.Order)}else if("back"===i)if(0===e.currentIndex)this.rulesService.UpdateRuleOrder(n,t[0].Order/2);else{var o=t[e.currentIndex-1];this.rulesService.UpdateRuleOrder(n,(t[e.currentIndex].Order-o.Order)/2+o.Order)}Object(O.e)(t,e.previousIndex,e.currentIndex)}else{var c=new g;c.Enabled=!1,console.log(e),c.Order=this.calculateRuleOrder(e.currentIndex),this.rulesService.Add(c).subscribe()}}},{key:"GetIcon",value:function(e){return this.actionHelper.GetIcon(e)}},{key:"prepareIcon",value:function(e){if(!e)return null;if(e.startsWith("fa#")){var t={type:"fa",icon:null};return e=e.substring(3),t.icon=e.includes("|")?e.split("|"):e,t}return{type:"ant",icon:e}}},{key:"propagateChange",value:function(e){this.rulesChanged.next(e),this.registered.forEach((function(t){t(e)}))}},{key:"writeValue",value:function(e){this.rules=e}},{key:"registerOnChange",value:function(e){-1===this.registered.indexOf(e)&&this.registered.push(e)}},{key:"registerOnTouched",value:function(e){this.onTouched=e}},{key:"setDisabledState",value:function(e){throw new Error("Method not implemented.")}},{key:"rules",set:function(e){var t=this;this._rules=(e||[]).map((function(e){var n=t._rules.find((function(t){return t.Item.Id===e.Id}));return n?(n.Item=e,n):new S(e)})),this.rulesSubject$.next(this._rules)},get:function(){return this._rules.map((function(e){return e.Item}))}}]),e}()).\u0275fac=function(e){return new(e||Me)(h.Nb(R),h.Nb(h.h),h.Nb(A.c),h.Nb(h.P),h.Nb(b.i),h.Nb(b.a),h.Nb(be),h.Nb(M))},Me.\u0275cmp=h.Hb({type:Me,selectors:[["enpoint-rules-list"]],viewQuery:function(e,t){var n;1&e&&(h.Jc(me,!0),h.Jc(ve,!0)),2&e&&(h.sc(n=h.cc())&&(t.contextMenu=n.first),h.sc(n=h.cc())&&(t.addRuleTemplate=n.first))},inputs:{rules:"rules"},outputs:{rulesChanged:"rulesChanged"},decls:12,vars:7,consts:[["cdkDropList","",1,"outer",2,"flex-grow","1","height","100%",3,"contextmenu"],["nullList","cdkDropList"],["cdkDropList","",1,"",2,"padding","2px","margin-top","8px","max-height","calc(100% - 30px)","overflow-y","auto",3,"cdkDropListDropped"],["rulesList","cdkDropList"],["style","text-align: center; font-size: 1.3em; font-weight: bold; color: #525e7678; line-height: 1.4em; line-height: 2em; margin: 0px 10px;",4,"ngIf"],["class","rule-item","cdkDrag","","cdkDragLockAxis","y",3,"selected","disabled","click","contextmenu","dblclick",4,"ngFor","ngForOf"],["outerContextMenu",""],["itemContextMenu",""],[2,"text-align","center","font-size","1.3em","font-weight","bold","color","#525e7678","line-height","1.4em","line-height","2em","margin","0px 10px"],[2,"font-size","1.5em"],["cdkDrag","","cdkDragLockAxis","y",1,"rule-item",3,"click","contextmenu","dblclick"],[2,"display","flex","min-height","60px"],["cdkDragHandle","",1,"dragHandle",2,"padding","10px 0px 0px 5px"],["icon","fa#ellipsis-v",2,"width","1.18em","margin","0 .25rem 0 0","font-size","1.2em"],[2,"padding","5px","flex-grow","1"],[2,"font-size","large","font-weight","bold","color","#292f3b"],[2,"padding","5px","min-width","200px","max-width","200px"],[2,"min-width","200px","max-width","200px","display","flex"],[2,"flex-grow","1","padding","5px"],["nz-tooltip","",3,"nzTooltipTitle",4,"ngFor","ngForOf"],["class","terminate-indicator","nz-tooltip","","nzTooltipTitle","Stop processing further Rules",4,"ngIf"],["nz-tooltip","",3,"nzTooltipTitle"],[3,"icon"],["nz-tooltip","","nzTooltipTitle","Stop processing further Rules",1,"terminate-indicator"],["nz-menu","","nzMode","vertical",1,"context-menu"],["nz-submenu","","nzTitle","Add Rule","nzIcon","menu-unfold"],[1,"context-menu"],["nz-menu-item","",3,"click"],["icon","double-left","rotate","90"],["icon","double-right","rotate","90"],["nz-menu-item","",3,"click",4,"ngIf"],["nz-submenu","","nzTitle","Add Rule","nzIcon","menu-unfold",4,"ngIf"],["nz-menu-divider",""],["icon","delete"],["icon","fa#toggle-on"],["icon","fa#toggle-off"],["icon","up"],["icon","down"]],template:function(e,t){if(1&e){var n=h.Ub();h.Tb(0,"div",0,1),h.bc("contextmenu",(function(e){h.vc(n);var i=h.tc(9);return t.openOuterContextMenu(e,i)})),h.Tb(2,"div",2,3),h.bc("cdkDropListDropped",(function(e){return t.drop(e)})),h.Dc(4,Se,5,0,"div",4),h.fc(5,"async"),h.Dc(6,xe,20,11,"div",5),h.fc(7,"async"),h.Sb(),h.Sb(),h.Dc(8,Te,9,0,"ng-template",null,6,h.Ec),h.Dc(10,we,8,3,"ng-template",null,7,h.Ec)}2&e&&(h.zb(4),h.lc("ngIf",0===(h.gc(5,2,t.rules$)||h.nc(6,Pe)).length),h.zb(2),h.lc("ngForOf",h.gc(7,4,t.rules$)))},directives:[O.c,f.o,f.n,O.a,O.b,he.c,pe.d,ge.c,L.a,ge.g,ge.e,ge.d],pipes:[f.b],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1}.rule-item[_ngcontent-%COMP%]{margin-bottom:10px!important;border-radius:0!important;box-shadow:0 0 3px 1px #cecece;background-color:#fff}.rule-item.disabled[_ngcontent-%COMP%]{opacity:.6;box-shadow:none;background-color:#e2e2e2}.rule-item[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{border-right:1px solid #fff}.rule-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}.rule-item.selected[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{background-color:#292f3b;color:#fff}.rule-item[_ngcontent-%COMP%]:hover{background-color:#b2b7c2}.new-rule.ui.button[_ngcontent-%COMP%]{margin:0}.options[_ngcontent-%COMP%]{background-color:grey;height:50px}.list-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{background-color:inherit!important}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:inherit}.dragHandle[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.list-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#e0e1e2}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{cursor:inherit}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:inherit}.list-item.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%], .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{border-radius:0!important;background-color:#2f2f2f;color:#f5f5f5}.outer.cdk-drop-list-dragging[_ngcontent-%COMP%] > .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{display:none}.context-menu[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{margin:0!important}.anticon.disabled[_ngcontent-%COMP%]{color:#ccc}.terminate-indicator[_ngcontent-%COMP%]{width:8px;background-color:#525e76;border-left:1px solid #fff}.action-item.disabled[_ngcontent-%COMP%]   .terminate-indicator[_ngcontent-%COMP%]{background-color:inherit}.action-item[_ngcontent-%COMP%]:hover   .terminate-indicator[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}  .ant-divider-horizontal.ant-divider-with-text-center:after,   .ant-divider-horizontal.ant-divider-with-text-center:before{border-top:1px solid #525e76!important}"],changeDetection:0}),Me),Ae=((Ie=function e(t){d(this,e),this.uiService=t,t.Set((function(e){e.Header.Title="Endpoint Rules",e.Content.Scrollable=!1,e.Header.Icon="fa#stream"}))}).\u0275fac=function(e){return new(e||Ie)(h.Nb(p.a))},Ie.\u0275cmp=h.Hb({type:Ie,selectors:[["ng-component"]],decls:2,vars:0,consts:[[2,"display","flex","flex-direction","column","flex-grow","1"]],template:function(e,t){1&e&&(h.Tb(0,"div",0),h.Ob(1,"enpoint-rules-list"),h.Sb())},directives:[Re],styles:[""]}),Ie),_e=o("HM3f"),De=o("3lSR"),Fe=o("t2t5"),Ne=o("INpK"),He=o("vkL3"),Ee=["urlredirect"],$e=["urlrewrite"],Ue=["script"];function Le(e,t){if(1&e&&(h.Tb(0,"div"),h.Fc(1),h.Sb(),h.Tb(2,"div"),h.Fc(3),h.Sb(),h.Tb(4,"div"),h.Fc(5),h.Sb()),2&e){var n=h.ec();h.zb(1),h.Hc(" Redirect to ",n.action.Parameters.RedirectTo," "),h.zb(2),h.Hc(" Permanent: ",n.action.Parameters.Permanent," "),h.zb(2),h.Hc(" PreserveMethod: ",n.action.Parameters.PreserveMethod," ")}}function je(e,t){if(1&e&&(h.Tb(0,"div"),h.Fc(1),h.Sb()),2&e){var n=h.ec();h.zb(1),h.Hc(" Rewrite to ",n.action.Parameters.RewriteTo," ")}}function Ge(e,t){if(1&e&&(h.Tb(0,"div"),h.Fc(1),h.Sb()),2&e){var n=h.ec();h.zb(1),h.Hc(" ",n.action.Parameters.Language," ")}}var Be,Ve=((Be=function(){function e(){d(this,e)}return s(e,[{key:"ngOnInit",value:function(){this.template=this.determineTemplate()}},{key:"determineTemplate",value:function(){switch(this.action.ActionType){case"UrlRedirect":return this.UrlRedirect;case"UrlRewrite":return this.UrlRewrite;case"Script":return this.Script}}}]),e}()).\u0275fac=function(e){return new(e||Be)},Be.\u0275cmp=h.Hb({type:Be,selectors:[["action-list-details"]],viewQuery:function(e,t){var n;1&e&&(h.Ac(Ee,!0),h.Ac($e,!0),h.Ac(Ue,!0)),2&e&&(h.sc(n=h.cc())&&(t.UrlRedirect=n.first),h.sc(n=h.cc())&&(t.UrlRewrite=n.first),h.sc(n=h.cc())&&(t.Script=n.first))},inputs:{action:"action"},decls:8,vars:1,consts:[[2,"font-size","x-small"],[3,"ngTemplateOutlet"],["urlredirect",""],["urlrewrite",""],["script",""]],template:function(e,t){1&e&&(h.Tb(0,"div",0),h.Pb(1,1),h.Sb(),h.Dc(2,Le,6,3,"ng-template",null,2,h.Ec),h.Dc(4,je,2,1,"ng-template",null,3,h.Ec),h.Dc(6,Ge,2,1,"ng-template",null,4,h.Ec)),2&e&&(h.zb(1),h.lc("ngTemplateOutlet",t.template))},directives:[f.t],styles:[""]}),Be),Ke=o("JbzU"),Je=o("Pq5H"),Qe=o("fWDI");function Xe(e,t){1&e&&(h.Tb(0,"div",8),h.Tb(1,"div",9),h.Fc(2,"Currently there is nothing..."),h.Sb(),h.Tb(3,"p"),h.Fc(4,"Use the ContextMenu to create your first action!"),h.Sb(),h.Sb())}function qe(e,t){if(1&e&&h.Ob(0,"i",23),2&e){var n=h.ec().$implicit;h.lc("nzType",n.icon)}}function We(e,t){if(1&e&&h.Ob(0,"fa-icon",24),2&e){var n=h.ec().$implicit;h.lc("icon",n.icon)}}function Ye(e,t){if(1&e&&(h.Tb(0,"div",20),h.Dc(1,qe,1,1,"i",21),h.Dc(2,We,1,1,"fa-icon",22),h.Sb()),2&e){var n=t.$implicit;h.zb(1),h.lc("ngIf","ant"==n.type),h.zb(1),h.lc("ngIf","fa"==n.type)}}function Ze(e,t){if(1&e&&h.Ob(0,"div",25),2&e){var n=h.ec(),i=n.$implicit,r=n.index,o=h.ec();h.lc("nzTooltipTitle",o.GetTerminateStatusText(i,r))}}function et(e,t){if(1&e&&(h.Rb(0),h.Ob(1,"nz-divider",26),h.Qb()),2&e){var n=t.$implicit;h.zb(1),h.lc("nzText",n)}}function tt(e,t){if(1&e){var n=h.Ub();h.Rb(0),h.Tb(1,"div",10),h.Tb(2,"div",11),h.bc("click",(function(e){h.vc(n);var i=t.$implicit;return h.ec().ClickAction(e,i)}))("dblclick",(function(){h.vc(n);var e=t.$implicit;return h.ec().openModal(e)}))("contextmenu",(function(e){h.vc(n);var i=t.$implicit,r=h.ec(),o=h.tc(11);return r.openItemContextMenu(e,o,i)})),h.Tb(3,"div",12),h.Tb(4,"div",13),h.Dc(5,Ye,3,2,"div",14),h.Sb(),h.Tb(6,"div",15),h.Tb(7,"div",16),h.Fc(8),h.Sb(),h.Ob(9,"action-list-details",17),h.Sb(),h.Dc(10,Ze,1,1,"div",18),h.Sb(),h.Sb(),h.Dc(11,et,2,1,"ng-container",19),h.Sb(),h.Qb()}if(2&e){var i=t.$implicit,r=t.index,o=h.ec();h.zb(2),h.Fb("selected",o.IsActionSelected(i))("disabled",!i.Enabled)("afterTerminate",o.IsAfterTerminate(r)),h.zb(3),h.lc("ngIf",o.prepareIcon(o.GetIcon(i))),h.zb(3),h.Hc("",i.ActionType," "),h.zb(1),h.lc("action",i),h.zb(1),h.lc("ngIf",i.Terminating),h.zb(1),h.lc("ngIf",o.GetTerminateStatus(i,r))}}function nt(e,t){if(1&e){var n=h.Ub();h.Tb(0,"ul",27),h.Tb(1,"li",28),h.Tb(2,"ul",29),h.Tb(3,"li",30),h.bc("click",(function(){return h.vc(n),h.ec().CreateAction("UrlRedirect","bottom")})),h.Ob(4,"i",31),h.Fc(5," UrlRedirect "),h.Sb(),h.Tb(6,"li",30),h.bc("click",(function(){return h.vc(n),h.ec().CreateAction("UrlRewrite","bottom")})),h.Ob(7,"i",32),h.Fc(8," UrlRewrite "),h.Sb(),h.Tb(9,"li",30),h.bc("click",(function(){return h.vc(n),h.ec().CreateAction("Script","bottom")})),h.Ob(10,"i",33),h.Fc(11," Script "),h.Sb(),h.Sb(),h.Sb(),h.Sb()}}var it=function(){return["fas","toggle-on"]};function rt(e,t){if(1&e){var n=h.Ub();h.Tb(0,"li",30),h.bc("click",(function(){h.vc(n);var e=h.ec().$implicit;return h.ec().SetActionEnabled(e.Single,!0)})),h.Ob(1,"fa-icon",40),h.Fc(2," Enable "),h.Sb()}2&e&&(h.zb(1),h.lc("icon",h.nc(1,it)))}var ot=function(){return["fas","toggle-off"]};function ct(e,t){if(1&e){var n=h.Ub();h.Tb(0,"li",30),h.bc("click",(function(){h.vc(n);var e=h.ec().$implicit;return h.ec().SetActionEnabled(e.Single,!1)})),h.Ob(1,"fa-icon",40),h.Fc(2," Disable "),h.Sb()}2&e&&(h.zb(1),h.lc("icon",h.nc(1,ot)))}function lt(e,t){if(1&e){var n=h.Ub();h.Tb(0,"li",30),h.bc("click",(function(){h.vc(n);var e=h.ec().$implicit;return h.ec().openModal(e.Single)})),h.Ob(1,"i",41),h.Fc(2," Edit "),h.Sb()}}function at(e,t){if(1&e){var n=h.Ub();h.Tb(0,"li",30),h.bc("click",(function(){h.vc(n);var e=h.ec(2).$implicit;return h.ec().SetActionTerminate(e.Single,!0)})),h.Ob(1,"db-icon",43),h.Fc(2," Stop processing after Action "),h.Sb()}}function ut(e,t){if(1&e){var n=h.Ub();h.Tb(0,"li",30),h.bc("click",(function(){h.vc(n);var e=h.ec(2).$implicit;return h.ec().SetActionTerminate(e.Single,!1)})),h.Ob(1,"db-icon",44),h.Fc(2," Continue processing after Action "),h.Sb()}}function st(e,t){if(1&e&&(h.Tb(0,"li",42),h.Tb(1,"ul",29),h.Dc(2,at,3,0,"li",34),h.Dc(3,ut,3,0,"li",34),h.Sb(),h.Sb()),2&e){var n=h.ec().$implicit;h.zb(2),h.lc("ngIf",!1===(null==n.Single?null:n.Single.Terminating)),h.zb(1),h.lc("ngIf",!0===(null==n.Single?null:n.Single.Terminating))}}function dt(e,t){if(1&e){var n=h.Ub();h.Tb(0,"li",45),h.Tb(1,"ul",29),h.Tb(2,"li",30),h.bc("click",(function(){h.vc(n);var e=h.ec().$implicit;return h.ec().CreateAction("UrlRedirect","before",e.Single)})),h.Ob(3,"i",31),h.Fc(4," UrlRedirect "),h.Sb(),h.Tb(5,"li",30),h.bc("click",(function(){h.vc(n);var e=h.ec().$implicit;return h.ec().CreateAction("UrlRewrite","before",e.Single)})),h.Ob(6,"i",32),h.Fc(7," UrlRewrite "),h.Sb(),h.Tb(8,"li",30),h.bc("click",(function(){h.vc(n);var e=h.ec().$implicit;return h.ec().CreateAction("Script","before",e.Single)})),h.Ob(9,"i",33),h.Fc(10," Script "),h.Sb(),h.Sb(),h.Sb()}}function ft(e,t){if(1&e){var n=h.Ub();h.Tb(0,"li",46),h.Tb(1,"ul",29),h.Tb(2,"li",30),h.bc("click",(function(){h.vc(n);var e=h.ec().$implicit;return h.ec().CreateAction("UrlRedirect","after",e.Single)})),h.Ob(3,"i",31),h.Fc(4," UrlRedirect "),h.Sb(),h.Tb(5,"li",30),h.bc("click",(function(){h.vc(n);var e=h.ec().$implicit;return h.ec().CreateAction("UrlRewrite","after",e.Single)})),h.Ob(6,"i",32),h.Fc(7," UrlRewrite "),h.Sb(),h.Tb(8,"li",30),h.bc("click",(function(){h.vc(n);var e=h.ec().$implicit;return h.ec().CreateAction("Script","after",e.Single)})),h.Ob(9,"i",33),h.Fc(10," Script "),h.Sb(),h.Sb(),h.Sb()}}function bt(e,t){if(1&e){var n=h.Ub();h.Tb(0,"ul",27),h.Dc(1,rt,3,2,"li",34),h.Dc(2,ct,3,2,"li",34),h.Dc(3,lt,3,0,"li",34),h.Dc(4,st,4,2,"li",35),h.Dc(5,dt,11,0,"li",36),h.Dc(6,ft,11,0,"li",37),h.Ob(7,"li",38),h.Tb(8,"li",30),h.bc("click",(function(){h.vc(n);var e=t.$implicit;return h.ec().RemoveActions(e.Selected)})),h.Ob(9,"i",39),h.Fc(10," Remove "),h.Sb(),h.Sb()}if(2&e){var i=t.$implicit;h.zb(1),h.lc("ngIf",!1===(null==i.Single?null:i.Single.Enabled)),h.zb(1),h.lc("ngIf",!0===(null==i.Single?null:i.Single.Enabled)),h.zb(1),h.lc("ngIf",i.Single),h.zb(1),h.lc("ngIf",i.Single),h.zb(1),h.lc("ngIf",i.Single),h.zb(1),h.lc("ngIf",i.Single)}}var ht,pt=function(){return[]},gt=((ht=function(){function e(t,n,i,r,o,c,l,a){var u=this;d(this,e),this.uiService=t,this.modal=n,this.overlay=i,this.viewContainerRef=r,this.cref=o,this.componentFactoryResolver=c,this.actionHelper=l,this.rulesService=a,this.terminateActionIndex=-1,this.actionsSubject$=new v.a(null),this.actions$=this.actionsSubject$.asObservable().pipe(Object(m.a)((function(e){u.terminateActionIndex=e.findIndex((function(e){return e.Enabled&&e.Terminating}))}))),this.actionsChange=new h.n,this.selectedActions=[],this.registered=[],this.onTouched=function(){}}return s(e,[{key:"ngOnInit",value:function(){}},{key:"IsActionSelected",value:function(e){return this.selectedActions.includes(e.Id)}},{key:"setActionSelected",value:function(e,n){this.selectedActions=n?t(new Set([].concat(t(this.selectedActions),[e.Id]))):this.selectedActions.filter((function(t){return t!=e.Id}))}},{key:"GetSelectedActions",value:function(){var e=this;return this.actions.filter((function(t){return e.selectedActions.includes(t.Id)}))}},{key:"ClickAction",value:function(e,t){var n;if(e.stopPropagation(),null===(n=this.ContextMenu)||void 0===n||n.Close(),e.ctrlKey){var i=this.IsActionSelected(t);this.setActionSelected(t,!i)}else this.selectedActions=[],this.setActionSelected(t,!0)}},{key:"OpenOuterContextMenu",value:function(e,t){var n;e.stopPropagation(),this.selectedActions=[],null===(n=this.ContextMenu)||void 0===n||n.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,null)}},{key:"ClickOutside",value:function(){this.selectedActions=[]}},{key:"openItemContextMenu",value:function(e,t,n){var i;if(e.stopPropagation(),0==this.selectedActions.length||!this.IsActionSelected(n))if(e.ctrlKey){var r=this.IsActionSelected(n);this.setActionSelected(n,!r)}else this.selectedActions=[],this.setActionSelected(n,!0);null===(i=this.ContextMenu)||void 0===i||i.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,this.BuildContext())}},{key:"BuildContext",value:function(){var e=this,t=new y;return t.AllItems=this.actions,t.Selected=this.actions.filter((function(t){return e.selectedActions.includes(t.Id)})),t}},{key:"GetIcon",value:function(e){return this.actionHelper.GetIcon(e)}},{key:"prepareIcon",value:function(e){if(!e)return null;if(e.startsWith("fa#")){var t={type:"fa",icon:null};return e=e.substring(3),t.icon=e.includes("|")?e.split("|"):e,t}return{type:"ant",icon:e}}},{key:"CreateAction",value:function(e,n,i){var r=new _;switch(e.toLowerCase()){case"urlredirect":r=new Z;break;case"urlrewrite":r=new F;break;case"script":r=new oe}r.Order=this.CalculateOrder(n,i),r.Id=this.getNewActionsId().toString(),this.actions=[].concat(t(this.actions),[r]),this.propagateChange(this.actions)}},{key:"getNewActionsId",value:function(){var e=this.actions.map((function(e){return/^(\-|\+)?([0-9]+|Infinity)$/.test(t=e.Id)?Number(t):NaN;var t})).filter((function(e){return!Number.isNaN(e)})).sort((function(e,t){return t-e}));return e&&e.length>0?e[0]+1:0}},{key:"GetNextLastOrder",value:function(){if(!this.actions||0===this.actions.length)return 10;var e=Math.trunc(Math.max.apply(Math,t(this.actions.map((function(e){return e.Order}))))+10);return console.log("NEXT",e),e}},{key:"CalculateOrder",value:function(e,t){var n,i=-1;switch(t&&(i=null===(n=this.actions)||void 0===n?void 0:n.findIndex((function(e){return e.Order===t.Order}))),e){case"top":return this.actions&&0!=this.actions.length?this.actions[0].Order/2:10;case"before":return 0==i?t.Order/2:t.Order-(t.Order-this.actions[i-1].Order)/2;case"after":return i==this.actions.length-1?this.GetNextLastOrder():t.Order+(this.actions[i+1].Order-t.Order)/2;case"bottom":return this.GetNextLastOrder()}}},{key:"SetActionEnabled",value:function(e,t){this.actions=this.actions.map((function(n){return n==e&&(n.Enabled=t),n})),this.propagateChange(this.actions)}},{key:"SetActionTerminate",value:function(e,t){this.actions=this.actions.map((function(n){return n==e&&(n.Terminating=t),n})),this.propagateChange(this.actions)}},{key:"RemoveActions",value:function(e){var t,n=e.map((function(e){return e.Id}));this.actions=this.actions.filter((function(e){return!n.includes(e.Id)})),this.propagateChange(this.actions),null===(t=this.ContextMenu)||void 0===t||t.Close()}},{key:"drop",value:function(e){console.log(e);var n=this.actions[e.previousIndex],i=null;if(e.previousIndex<e.currentIndex?i="forward":e.previousIndex>e.currentIndex&&(i="back"),i){if(console.log(i,this.actions.length),"forward"===i)if(e.currentIndex===this.actions.length-1)console.log("-- 1 --"),n.Order=this.GetNextLastOrder();else{console.log("-- 2 --");var r=this.actions[e.currentIndex];n.Order=(this.actions[e.currentIndex+1].Order-r.Order)/2+r.Order}else if("back"===i)if(0===e.currentIndex)console.log("-- 3 --"),n.Order=this.actions[0].Order/2;else{console.log("-- 4 --");var o=this.actions[e.currentIndex-1];n.Order=(this.actions[e.currentIndex].Order-o.Order)/2+o.Order}Object(O.e)(this.actions,e.previousIndex,e.currentIndex),this.actions=t(this.actions),this.propagateChange(this.actions)}}},{key:"GetTerminateStatus",value:function(e,t){return e.Enabled?this.IsAfterTerminate(t)?null:this.GetTerminateStatusText(e,t):null}},{key:"GetTerminateStatusText",value:function(e,t){var n=this.IsLastExecuted(t);return!e.Terminating&&n?"Continue with next Endpoint Rule":e.Terminating&&n?"Stop processing further Endpoint Rules":e.Terminating&&!n?"Stop processing further Actions / Endpoint Rules":void 0}},{key:"IsAfterTerminate",value:function(e){return-1!=this.terminateActionIndex&&e>this.terminateActionIndex}},{key:"IsLastExecuted",value:function(e){return 0==this.actions.filter((function(t,n){return t.Enabled&&n>e})).length}},{key:"openModal",value:function(e){var n,i=this;switch(null===(n=this.ContextMenu)||void 0===n||n.Close(),Object.assign({},e),e.ActionType){case"UrlRedirect":this.actionHelper.GetModal("UrlRedirect").SetData(e).AddEventHandler("OK",(function(n){e.Parameters=n.payload,i.actions=t(i.actions),i.propagateChange(i.actions)})).Open();break;case"UrlRewrite":this.actionHelper.GetModal("UrlRewrite").SetData(e).AddEventHandler("OK",(function(n){e.Parameters=n.payload,i.actions=t(i.actions),i.propagateChange(i.actions)})).Open();break;case"Script":this.actionHelper.GetModal("Script").SetData(e).AddEventHandler("OK",(function(n){e.Parameters=n.payload,i.actions=t(i.actions),i.propagateChange(i.actions)})).Open()}}},{key:"propagateChange",value:function(e){this.actionsChange.emit(e),this.registered.forEach((function(t){t(e)}))}},{key:"writeValue",value:function(e){this.actions=e}},{key:"registerOnChange",value:function(e){-1===this.registered.indexOf(e)&&this.registered.push(e)}},{key:"registerOnTouched",value:function(e){this.onTouched=e}},{key:"setDisabledState",value:function(e){}},{key:"actions",get:function(){return this.actionsSubject$.value},set:function(e){e=null==e?void 0:e.sort((function(e,t){return e.Order>t.Order?1:e.Order<t.Order?-1:0})),this.actionsSubject$.next(e)}}]),e}()).\u0275fac=function(e){return new(e||ht)(h.Nb(p.a),h.Nb(A.b),h.Nb(A.c),h.Nb(h.P),h.Nb(h.h),h.Nb(h.j),h.Nb(be),h.Nb(R))},ht.\u0275cmp=h.Hb({type:ht,selectors:[["endpoint-actions-list"]],inputs:{actions:"actions"},outputs:{actionsChange:"actionsChange"},features:[h.yb([{provide:N.k,useExisting:ht,multi:!0}])],decls:12,vars:7,consts:[["cdkDropList","",1,"outer",2,"flex-grow","1","height","100%",3,"contextmenu","click"],["nullList","cdkDropList"],["cdkDropList","",2,"padding","2px","margin-top","8px","max-height","calc(100% - 30px)","overflow-y","auto",3,"cdkDropListDropped"],["rulesList","cdkDropList"],["style","text-align: center; font-size: 1.3em; font-weight: bold; color: #525e7678; line-height: 1.4em; line-height: 2em; margin: 0px 10px;",4,"ngIf"],[4,"ngFor","ngForOf"],["outerContextMenu",""],["itemContextMenu",""],[2,"text-align","center","font-size","1.3em","font-weight","bold","color","#525e7678","line-height","1.4em","line-height","2em","margin","0px 10px"],[2,"font-size","1.5em"],["cdkDrag","","cdkDragLockAxis","y"],[1,"action-item",3,"click","dblclick","contextmenu"],[2,"display","flex"],["cdkDragHandle","",1,"dragHandle",2,"padding","10px 0px 0px 5px"],["class","title-icon",4,"ngIf"],[2,"padding","5px","flex-grow","1"],[2,"font-size","large","font-weight","bold","color","#292f3b"],[3,"action"],["class","terminate-indicator","nz-tooltip","",3,"nzTooltipTitle",4,"ngIf"],[4,"ngIf"],[1,"title-icon"],["style","font-size: xx-large; width: 40px; text-align: left;","nz-icon","","nzTheme","outline",3,"nzType",4,"ngIf"],["style","font-size: xx-large; width: 40px; text-align: left;","nz-icon","",3,"icon",4,"ngIf"],["nz-icon","","nzTheme","outline",2,"font-size","xx-large","width","40px","text-align","left",3,"nzType"],["nz-icon","",2,"font-size","xx-large","width","40px","text-align","left",3,"icon"],["nz-tooltip","",1,"terminate-indicator",3,"nzTooltipTitle"],["nzDashed","",1,"action-divider",3,"nzText"],["nz-menu","","nzMode","vertical",1,"context-menu"],["nz-submenu","","nzTitle","Add Action","nzIcon","menu-unfold"],[1,"context-menu"],["nz-menu-item","",3,"click"],["nz-icon","","nzType","rollback","nzTheme","outline"],["nz-icon","","nzType","edit","nzTheme","outline"],["nz-icon","","nzType","code","nzTheme","outline"],["nz-menu-item","",3,"click",4,"ngIf"],["nz-submenu","","nzTitle","Options","nzIcon","setting",4,"ngIf"],["nz-submenu","","nzTitle","Add Action Before","nzIcon","up",4,"ngIf"],["nz-submenu","","nzTitle","Add Action After","nzIcon","down",4,"ngIf"],["nz-menu-divider",""],["nz-icon","","nzType","delete","nzTheme","outline"],["nz-icon","",3,"icon"],["nz-icon","","nzType","form","nzTheme","outline"],["nz-submenu","","nzTitle","Options","nzIcon","setting"],["icon","fa#far|stop-circle"],["icon","fa#far|play-circle"],["nz-submenu","","nzTitle","Add Action Before","nzIcon","up"],["nz-submenu","","nzTitle","Add Action After","nzIcon","down"]],template:function(e,t){if(1&e){var n=h.Ub();h.Tb(0,"div",0,1),h.bc("contextmenu",(function(e){h.vc(n);var i=h.tc(9);return t.OpenOuterContextMenu(e,i)}))("click",(function(){return t.ClickOutside()})),h.Tb(2,"div",2,3),h.bc("cdkDropListDropped",(function(e){return t.drop(e)})),h.Dc(4,Xe,5,0,"div",4),h.fc(5,"async"),h.Dc(6,tt,12,11,"ng-container",5),h.fc(7,"async"),h.Sb(),h.Sb(),h.Dc(8,nt,12,0,"ng-template",null,6,h.Ec),h.Dc(10,bt,11,6,"ng-template",null,7,h.Ec)}2&e&&(h.zb(4),h.lc("ngIf",0===(h.gc(5,2,t.actions$)||h.nc(6,pt)).length),h.zb(2),h.lc("ngForOf",h.gc(7,4,t.actions$)))},directives:[O.c,f.o,f.n,O.a,O.b,Ve,L.a,Ke.a,Je.b,pe.d,Qe.a,ge.c,ge.g,ge.e,ge.d,he.c],pipes:[f.b],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1}.action-item[_ngcontent-%COMP%]{margin-bottom:10px!important;border-radius:0!important;box-shadow:0 0 3px 1px #cecece;background-color:#fff}.action-item.disabled[_ngcontent-%COMP%]{opacity:.6;box-shadow:none;background-color:#e2e2e2}.action-item[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{border-right:1px solid #fff}.action-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}.action-item.selected[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{background-color:#292f3b;color:#fff}.action-item[_ngcontent-%COMP%]:hover{background-color:#b2b7c2}.new-rule.ui.button[_ngcontent-%COMP%]{margin:0}.options[_ngcontent-%COMP%]{background-color:grey;height:50px}.list-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{background-color:inherit!important}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:inherit}.dragHandle[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.list-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#e0e1e2}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{cursor:inherit}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:inherit}.list-item.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%], .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{border-radius:0!important;background-color:#2f2f2f;color:#f5f5f5}.outer.cdk-drop-list-dragging[_ngcontent-%COMP%] > .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{display:none}.context-menu[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{margin:0!important}.afterTerminate[_ngcontent-%COMP%]{opacity:.3}.terminate-indicator[_ngcontent-%COMP%]{width:8px;background-color:#525e76;border-left:1px solid #fff}.action-item.disabled[_ngcontent-%COMP%]   .terminate-indicator[_ngcontent-%COMP%]{background-color:inherit}.action-item[_ngcontent-%COMP%]:hover   .terminate-indicator[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}"],changeDetection:0}),ht);function mt(e,t){1&e&&(h.Ob(0,"i",32),h.Fc(1,"Basic "))}function vt(e,t){1&e&&(h.Tb(0,"span"),h.Fc(1,"Enabled"),h.Sb())}function St(e,t){1&e&&(h.Tb(0,"span"),h.Fc(1,"Disabled"),h.Sb())}function Ot(e,t){1&e&&(h.Ob(0,"i",33),h.Fc(1,"Actions"))}function yt(e,t){1&e&&(h.Ob(0,"i",36),h.Fc(1,"Debug"))}function xt(e,t){if(1&e&&(h.Tb(0,"nz-tab",3),h.Dc(1,yt,2,0,"ng-template",null,34,h.Ec),h.Tb(3,"div",35),h.Tb(4,"pre"),h.Fc(5),h.fc(6,"json"),h.Sb(),h.Sb(),h.Sb()),2&e){var n=h.tc(2),i=h.ec(2);h.lc("nzTitle",n),h.zb(5),h.Gc(h.gc(6,2,i.form.value))}}var Tt=function(){return{inkBar:!0,tabPane:!1}},kt=function(){return[","]};function zt(e,t){if(1&e){var n=h.Ub();h.Rb(0),h.Tb(1,"form",1),h.Tb(2,"nz-tabset",2),h.bc("nzSelectChange",(function(e){return h.vc(n),h.ec().tabChanged(e)})),h.Tb(3,"nz-tab",3),h.Dc(4,mt,2,0,"ng-template",null,4,h.Ec),h.Tb(6,"div",5),h.Tb(7,"div",6),h.Tb(8,"nz-form-label",7),h.Fc(9,"Name"),h.Sb(),h.Tb(10,"nz-form-control"),h.Ob(11,"input",8),h.Sb(),h.Tb(12,"nz-form-label",9),h.Fc(13,"Path"),h.Sb(),h.Tb(14,"nz-form-control"),h.Ob(15,"input",10),h.Sb(),h.Tb(16,"nz-form-label",11),h.Fc(17,"Hostname"),h.Sb(),h.Tb(18,"nz-form-control"),h.Ob(19,"input",12),h.Sb(),h.Sb(),h.Ob(20,"div",13),h.Tb(21,"div",14),h.Tb(22,"nz-collapse",15),h.Tb(23,"nz-collapse-panel",16),h.Tb(24,"label",17),h.Dc(25,vt,2,0,"span",0),h.Dc(26,St,2,0,"span",0),h.Sb(),h.Sb(),h.Tb(27,"nz-collapse-panel",18),h.Tb(28,"nz-select",19),h.Ob(29,"nz-option",20),h.Ob(30,"nz-option",21),h.Sb(),h.Sb(),h.Tb(31,"nz-collapse-panel",22),h.Tb(32,"nz-form-control"),h.Tb(33,"nz-select",23),h.Ob(34,"nz-option",24),h.Ob(35,"nz-option",25),h.Ob(36,"nz-option",26),h.Ob(37,"nz-option",27),h.Ob(38,"nz-option",28),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(39,"nz-tab",3),h.Dc(40,Ot,2,0,"ng-template",null,29,h.Ec),h.Ob(42,"endpoint-actions-list",30),h.Sb(),h.Dc(43,xt,7,4,"nz-tab",31),h.fc(44,"async"),h.Sb(),h.Sb(),h.Qb()}if(2&e){var i=h.tc(5),r=h.tc(41),o=h.ec();h.zb(1),h.lc("formGroup",o.form),h.zb(1),h.lc("nzAnimated",h.nc(12,Tt)),h.zb(1),h.lc("nzTitle",i),h.zb(19),h.lc("nzBordered",!0),h.zb(1),h.lc("nzActive",!0),h.zb(2),h.lc("ngIf",!!o.form.value.Enabled),h.zb(1),h.lc("ngIf",!o.form.value.Enabled),h.zb(7),h.lc("nzTokenSeparators",h.nc(13,kt)),h.zb(6),h.lc("nzTitle",r),h.zb(4),h.lc("ngIf",h.gc(44,10,o.showDebugInformations$))}}var Ct,wt,It,Mt=[{path:"",component:Ae},{path:":id",component:(Ct=function(){function t(n,i,r,o){var c=this;d(this,t),this.uiService=n,this.route=i,this.rulesService=r,this.fb=o,this.rule$=Object(_e.a)([this.route.paramMap,this.route.queryParamMap,this.route.fragment]).pipe(Object(T.a)((function(t){var n=e(t,3),i=n[0];return n[1],n[2],c.Id=i.get("id"),c.rulesService.GetRule(c.Id)})),Object(De.a)(),Object(T.a)((function(e){return e.Actions=e.Actions.sort((function(e,t){return e.Order-t.Order})),e})),Object(m.a)((function(e){c.BaseRule||(c.BaseRule=e),c.uiService.Set((function(t){t.Header.Title="Endpoint Rule",t.Header.SubTitle=e.Name,t.Header.Icon="form",t.Footer.Button1.Visible=!0,t.Footer.Button2.Visible=!0})),c.form.patchValue(e)}))),this.showDebugInformations$=this.uiService.showDebugInformations$,this.selectedTab=new v.a(0),this.uiService.Set((function(e){e.Footer.Button1.Disabled=!0,e.Footer.Button2.Disabled=!0,e.Footer.Button1.OnClick=function(){c.save()},e.Footer.Button2.Text="Reset",e.Footer.Button2.OnClick=function(){c.form.reset(c.BaseRule)},e.Footer.Show=!0})),this.form=this.fb.group({Id:[null],Name:[null,N.q.required],Scheme:[],Hostname:[],Path:[],Actions:[[]],HttpMethods:[[]],Order:[],Enabled:[!1]})}return s(t,[{key:"ngOnInit",value:function(){var e=this;this.form.get("Name").valueChanges.subscribe((function(t){return e.uiService.Set((function(e){return e.Header.SubTitle=t}))})),this.form.valueChanges.subscribe((function(t){e.form.valid?e.SetButtonStatus(t):e.uiService.Set((function(e){e.Footer.Button1.Disabled=!0,e.Footer.Button1.Text="Form not valid!"}))}))}},{key:"GeneratePatchDocument",value:function(e,t){return t=null!=t?t:this.form.value,(e=null!=e?e:this.BaseRule).Permissions=null,t.Permissions=null,Object(Fe.a)(e,t)}},{key:"save",value:function(){var e,t=this,n=this.form.value;null===(e=n.Actions)||void 0===e||e.forEach((function(e){var t,n=/^(\-|\+)?([0-9]+|Infinity)$/.test(t=e.Id)?Number(t):NaN;Number.isNaN(n)||(e.Id=null)})),console.log(n),this.rulesService.Update(this.Id,n).pipe(Object(m.a)((function(){t.BaseRule=t.form.value,t.SetButtonStatus(t.BaseRule)}))).subscribe()}},{key:"SetButtonStatus",value:function(e){var t=this.GeneratePatchDocument(this.BaseRule,e);this.uiService.Set(t.length>0?function(e){e.Footer.Button1.Disabled=!1,e.Footer.Button1.Text="Save Changes",e.Footer.Button2.Disabled=!1}:function(e){e.Footer.Button1.Disabled=!0,e.Footer.Button1.Text="No Changes",e.Footer.Button2.Disabled=!0})}},{key:"tabChanged",value:function(e){var t;this.selectedTab.next(null!==(t=e.index)&&void 0!==t?t:0)}},{key:"isNotSelected",value:function(e){return-1===this.form.value.HttpMethods.indexOf(e)}},{key:"BaseRule",set:function(e){this._baseRule=JSON.parse(JSON.stringify(e))},get:function(){return this._baseRule}}]),t}(),Ct.\u0275fac=function(e){return new(e||Ct)(h.Nb(p.a),h.Nb(b.a),h.Nb(R),h.Nb(N.e))},Ct.\u0275cmp=h.Hb({type:Ct,selectors:[["endpoint-rule-details"]],decls:2,vars:3,consts:[[4,"ngIf"],["nz-form","",2,"flex-grow","1","display","flex","flex-direction","column","overflow","hidden",3,"formGroup"],[3,"nzAnimated","nzSelectChange"],[3,"nzTitle"],["BasicTitle",""],[2,"display","flex","flex-direction","row","padding","3px"],[2,"flex-grow","1"],["nzRequired","","nzFor","Name"],["nz-input","","formControlName","Name","id","Name",2,"width","100%"],["nzRequired","","nzFor","Path"],["nz-input","","formControlName","Path","id","Path",2,"width","100%"],["nzFor","Hostname"],["nz-input","","formControlName","Hostname","id","Hostname","placeHolder","*",2,"width","100%"],[2,"width","10px","margin-right","10px"],[2,"width","30%"],["nzAccordion","",3,"nzBordered"],["nzHeader","Options",3,"nzActive"],["nz-checkbox","","formControlName","Enabled"],["nzHeader","Schemes"],["nzMode","multiple","nzPlaceHolder","all Schemes allowed","formControlName","Scheme","nzMode","tags",2,"width","100%"],["nzLabel","Http","nzValue","http"],["nzLabel","Https","nzValue","https"],["nzHeader","Http Methods"],["nzMode","multiple","nzPlaceHolder","all Methods allowed","formControlName","HttpMethods","nzMode","tags",2,"width","100%",3,"nzTokenSeparators"],["nzLabel","Get","nzValue","Get"],["nzLabel","Post","nzValue","Post"],["nzLabel","Put","nzValue","Put"],["nzLabel","Delete","nzValue","Delete"],["nzLabel","Patch","nzValue","Patch"],["ActionsTitle",""],["formControlName","Actions"],[3,"nzTitle",4,"ngIf"],["nz-icon","","nzType","container"],["nz-icon","","nzType","ordered-list"],["DebugTitle",""],[2,"height","100%"],["nz-icon","","nzType","bug"]],template:function(e,t){1&e&&(h.Dc(0,zt,45,14,"ng-container",0),h.fc(1,"async")),2&e&&h.lc("ngIf",h.gc(1,1,t.rule$))},directives:[f.o,N.r,N.n,K.b,N.h,Ne.c,Ne.a,J.a,K.d,K.a,Q.b,N.d,N.m,N.g,He.a,He.c,ee.a,ce.b,ce.a,gt,L.a,Ke.a],pipes:[f.b,f.i],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1;overflow:hidden}"]}),Ct)}],Pt=((wt=function e(){d(this,e)}).\u0275mod=h.Lb({type:wt}),wt.\u0275inj=h.Kb({factory:function(e){return new(e||wt)},imports:[[b.l.forChild(Mt)],b.l]}),wt),Rt=o("YPwk"),At=((It=function e(){d(this,e)}).\u0275mod=h.Lb({type:It}),It.\u0275inj=h.Kb({factory:function(e){return new(e||It)},imports:[[f.c,N.p,Pt,O.d,Rt.a]]}),It)}}])}();