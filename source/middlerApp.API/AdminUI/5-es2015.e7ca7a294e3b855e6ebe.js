(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{CgPW:function(e,t,n){"use strict";n.r(t),n.d(t,"EndpointRulesModule",(function(){return ut}));var i=n("2kYt"),o=n("sEIs"),c=n("EM62"),r=n("ZF+8");class s{}var l=n("8j5Y"),a=n("C05f");class d{constructor(e){this.Item=e,this._showDetails=!1,this.ShowDetailsSubject$=new a.a(!1),this.ShowDetails$=this.ShowDetailsSubject$.asObservable()}set ShowDetails(e){this._showDetails=e,this.ShowDetailsSubject$.next(this._showDetails)}get ShowDetails(){return this._showDetails}}var u=n("oqI+");class b{constructor(){this.AllItems=[],this.Selected=[]}get Single(){var e;return 1===(null===(e=this.Selected)||void 0===e?void 0:e.length)?this.Selected[0]:null}get IsFirst(){return this.Single?this.AllItems[0].Id===this.Single.Id:null}get IsLast(){return this.Single?this.AllItems[this.AllItems.length-1].Id===this.Single.Id:null}}var h=n("vobO"),p=n("YtkY"),g=n("J+dc"),f=n("kZjU"),m=n("D57K"),S=n("XzLU");let O=(()=>{let e=class extends S.a{constructor(){super()}};return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=c.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e=Object(m.a)([Object(S.e)({name:"endpoint-rules",idKey:"Id"})],e),e})(),v=(()=>{class e extends S.c{constructor(e){super(e),this.store=e}}return e.\u0275fac=function(t){return new(t||e)(c.Xb(O))},e.\u0275prov=c.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const x=new h.e({"Content-Type":"application/json-patch+json",Accept:"application/json"});let T=(()=>{class e{constructor(e,t,n,i){this.http=e,this.message=t,this.endpointRulesStore=n,this.endpointRulesQuery=i,this.RulesOrder={},this.typings$=new a.a([]),this.Subscribe(),this.message.RunOnEveryReconnect(()=>this.GetAllRules().subscribe()),this.message.RunOnEveryReconnect(()=>this.GetTypings())}Subscribe(){this.message.Stream("MiddlerRule.Subscribe").pipe(Object(l.a)(e=>{switch(e.Action){case"Created":this.endpointRulesStore.add(e.Payload);break;case"Updated":if(e.MetaData.UpdateOrder){var t=e.Payload;Object.keys(t).forEach(e=>{this.endpointRulesStore.update(e,{Order:t[e]})})}else this.endpointRulesStore.update(e.Payload.Id,t=>e.Payload);break;case"Deleted":this.endpointRulesStore.update(e.Payload,e=>Object.assign(Object.assign({},e),{Deleted:!0})),this.endpointRulesStore.remove(e.Payload)}})).subscribe()}ReLoadRules(){this.http.get("/api/endpoint-rules").pipe(Object(l.a)(e=>this.endpointRulesStore.set(e))).subscribe()}GetAllRules(e){return!e&&this.endpointRulesQuery.getHasCache()||this.ReLoadRules(),this.endpointRulesQuery.selectAll().pipe(Object(p.a)(e=>e.sort(this.SortRules)))}GetRule(e){return this.http.get("/api/endpoint-rules/"+e)}Add(e){return this.http.post("/api/endpoint-rules",e)}Remove(e){return this.http.delete("/api/endpoint-rules/"+e)}Update(e,t){return this.http.put("/api/endpoint-rules/"+e,t)}SortRules(e,t){return e.Order>t.Order?1:e.Order<t.Order?-1:0}GetNextLastOrder(){const e=this.endpointRulesQuery.getAll();return e&&0!==e.length?Math.trunc(Math.max(...e.map(e=>e.Order))+10):10}UpdateRuleOrder(e,t){var n={};n[e.Id]=t,this.http.post("/api/endpoint-rules/order",n,{headers:x}).subscribe()}SetRuleEnabled(e,t){this.http.put(`/api/endpoint-rules/${e.Id}/enabled/${t}`,null,{headers:x}).subscribe()}GetTypings(){this.message.Invoke("MiddlerRule.GetTypings").pipe(Object(g.a)(1),Object(l.a)(e=>{var t=e.map(e=>new f.b(e.Key,e.Value,!1));this.typings$.next(t)})).subscribe()}}return e.\u0275fac=function(t){return new(t||e)(c.Xb(h.c),c.Xb(r.d),c.Xb(O),c.Xb(v))},e.\u0275prov=c.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var z=n("5m6l");class C{constructor(){this.Enabled=!0}}class w{constructor(){this.RewriteTo=""}}class I extends C{constructor(){super(...arguments),this.ActionType="UrlRewrite",this.Parameters=new w,this.Terminating=!1}}var k=n("nIj0"),M=n("l+TO"),P=n("duTG"),y=n("ZTwM"),R=n("1spV");function A(e,t){1&e&&(c.Tb(0,"div"),c.Fc(1,"Action"),c.Sb())}const _=["*"];let D=(()=>{class e{constructor(){this.ok=new c.n,this.cancel=new c.n}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c.Hb({type:e,selectors:[["action-basic-modal"]],hostAttrs:[1,"flex-grow-column","action-basic-modal"],inputs:{form:"form"},outputs:{ok:"ok",cancel:"cancel"},ngContentSelectors:_,decls:15,vars:2,consts:[[1,"modal-header",2,"padding","10px !important","display","flex","margin-bottom","1px"],[2,"font-size","2em","font-weight","bold","line-height","1.4285em","color","whitesmoke","margin","auto"],["dbPortal","ActionModalHeader-Left",1,"Irgendwos"],["left","dbPortal"],[4,"ngIf"],[2,"flex-grow","1"],["dbPortal","ActionModalHeader-Right"],[1,"modal-content"],[1,"modal-footer",2,"margin-bottom","0px","margin-top","1px"],["nz-button","","nzType","primary","nzBlock","",2,"height","40px",3,"disabled","click"],["nz-button","","nzType","default","nzBlock","",1,"secondary",2,"height","40px",3,"click"]],template:function(e,t){if(1&e&&(c.kc(),c.Tb(0,"div",0),c.Tb(1,"div",1),c.Pb(2,2,3),c.Dc(4,A,2,0,"div",4),c.Sb(),c.Ob(5,"div",5),c.Tb(6,"div"),c.Pb(7,6),c.Sb(),c.Sb(),c.Tb(8,"div",7),c.jc(9),c.Sb(),c.Tb(10,"div",8),c.Tb(11,"button",9),c.bc("click",(function(){return t.ok.next()})),c.Fc(12,"Submit"),c.Sb(),c.Tb(13,"button",10),c.bc("click",(function(){return t.cancel.next()})),c.Fc(14,"Cancel"),c.Sb(),c.Sb()),2&e){const e=c.tc(3);c.zb(4),c.lc("ngIf",!e.hasSource),c.zb(7),c.lc("disabled",!t.form.valid)}},directives:[M.d,i.o,P.a,y.a,R.a],styles:["[_nghost-%COMP%]{box-shadow:0 0 1px 2px #dedddd;max-width:100%;max-height:100%;background-color:#dedddd}",".modal-header[_ngcontent-%COMP%]{background-color:#292f3b!important}.modal-header[_ngcontent-%COMP%], .modal-header[_ngcontent-%COMP%]   .ui.huge.header[_ngcontent-%COMP%]{color:#fff!important}.modal-content[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]{border:none!important;display:flex}.modal-content[_ngcontent-%COMP%]{flex-grow:1;max-width:100%;max-height:100%}.flex-grow-column[_ngcontent-%COMP%], .modal-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], action-basic-modal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], action-basic-modal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   ng-component[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column}action-basic-modal[_ngcontent-%COMP%]   div[name][_ngcontent-%COMP%]{min-height:1.28571429em}.action-basic-modal[_ngcontent-%COMP%]{box-shadow:0 0 3px 1px #bfbfbf!important}"]}),e})();var F=n("PlhU"),N=n("Mr8s"),H=n("mybp");function E(e,t){1&e&&c.Fc(0," Url - Rewrite ")}let U=(()=>{class e{constructor(e,t){this.fb=e,this.context=t}ngOnInit(){this.form=this.fb.group({RewriteTo:[]}),this.form.patchValue(this.context.data.Parameters)}ok(){this.context.invoke("OK",this.form.value)}cancel(){this.context.handle.Close()}}return e.\u0275fac=function(t){return new(t||e)(c.Nb(k.e),c.Nb(z.d))},e.\u0275cmp=c.Hb({type:e,selectors:[["ng-component"]],decls:7,vars:2,consts:[[3,"form","ok","cancel"],["nz-form","",2,"width","100%",3,"formGroup"],["nzRequired","","nzFor","RewriteTo"],["nz-input","","formControlName","RewriteTo","id","RewriteTo",2,"width","100%"],["dbPortalTemplate","ActionModalHeader-Left"]],template:function(e,t){1&e&&(c.Tb(0,"action-basic-modal",0),c.bc("ok",(function(){return t.ok()}))("cancel",(function(){return t.cancel()})),c.Tb(1,"form",1),c.Tb(2,"nz-form-label",2),c.Fc(3,"RewriteTo"),c.Sb(),c.Tb(4,"nz-form-control"),c.Ob(5,"input",3),c.Sb(),c.Dc(6,E,1,0,"ng-template",4),c.Sb(),c.Sb()),2&e&&(c.lc("form",t.form),c.zb(1),c.lc("formGroup",t.form))},directives:[D,k.r,k.n,F.b,k.h,N.a,F.d,F.a,H.b,k.d,k.m,k.g,M.e],styles:[""]}),e})();class L{constructor(){this.RedirectTo="",this.Permanent=!1,this.PreserveMethod=!0}}class G extends C{constructor(){super(...arguments),this.ActionType="UrlRedirect",this.Parameters=new L,this.Terminating=!0}}var B=n("MaY1");function j(e,t){1&e&&c.Fc(0," Url - Redirect ")}let V=(()=>{class e{constructor(e,t){this.fb=e,this.context=t}ngOnInit(){this.form=this.fb.group({RedirectTo:[],Permanent:[],PreserveMethod:[]}),this.form.patchValue(this.context.data.Parameters)}ok(){this.context.invoke("OK",this.form.value)}cancel(){this.context.handle.Close()}}return e.\u0275fac=function(t){return new(t||e)(c.Nb(k.e),c.Nb(z.d))},e.\u0275cmp=c.Hb({type:e,selectors:[["ng-component"]],decls:14,vars:2,consts:[[3,"form","ok","cancel"],["nz-form","",2,"width","100%",3,"formGroup"],["nzRequired","","nzFor","RedirectTo"],["nz-input","","formControlName","RedirectTo","id","RedirectTo",2,"width","100%"],[2,"display","flex","flex-direction","row"],[1,"field"],["nz-checkbox","","formControlName","PreserveMethod"],["nz-checkbox","","formControlName","Permanent"],["dbPortalTemplate","ActionModalHeader-Left"]],template:function(e,t){1&e&&(c.Tb(0,"action-basic-modal",0),c.bc("ok",(function(){return t.ok()}))("cancel",(function(){return t.cancel()})),c.Tb(1,"form",1),c.Tb(2,"nz-form-label",2),c.Fc(3,"RedirectTo"),c.Sb(),c.Tb(4,"nz-form-control"),c.Ob(5,"input",3),c.Sb(),c.Tb(6,"div",4),c.Tb(7,"div",5),c.Tb(8,"label",6),c.Fc(9,"PreserveMethod"),c.Sb(),c.Sb(),c.Tb(10,"div",5),c.Tb(11,"label",7),c.Fc(12,"Permanent"),c.Sb(),c.Sb(),c.Sb(),c.Dc(13,j,1,0,"ng-template",8),c.Sb(),c.Sb()),2&e&&(c.lc("form",t.form),c.zb(1),c.lc("formGroup",t.form))},directives:[D,k.r,k.n,F.b,k.h,N.a,F.d,F.a,H.b,k.d,k.m,k.g,B.a,M.e],styles:[".field[_ngcontent-%COMP%]{padding-top:5px}"]}),e})();class K{constructor(){this.Language="Typescript"}}class J extends C{constructor(){super(...arguments),this.ActionType="Script",this.Parameters=new K,this.Terminating=!0}}var Q=n("ox+w");function X(e,t){1&e&&c.Fc(0," Script ")}function q(e,t){1&e&&(c.Tb(0,"div",6),c.Tb(1,"div",7),c.Tb(2,"nz-select",8),c.Ob(3,"nz-option",9),c.Ob(4,"nz-option",10),c.Ob(5,"nz-option",11),c.Sb(),c.Sb(),c.Sb())}const W=function(){return{noLib:!0}};let Y=(()=>{class e{constructor(e,t,n){this.fb=e,this.context=t,this.rulesService=n,this.typings$=this.rulesService.typings$.pipe(Object(l.a)(e=>console.log(e)))}ngOnInit(){this.form=this.fb.group({Language:[],SourceCode:[]}),this.context.data.Parameters.Language||(this.context.data.Parameters.Language="Typescript"),this.form.patchValue(this.context.data.Parameters)}initRestrictionsAccordion(e){$(e.nativeElement).accordion()}ok(){this.context.invoke("OK",this.form.value)}cancel(){this.context.handle.Close()}}return e.\u0275fac=function(t){return new(t||e)(c.Nb(k.e),c.Nb(z.d),c.Nb(T))},e.\u0275cmp=c.Hb({type:e,selectors:[["ng-component"]],decls:7,vars:8,consts:[[3,"form","ok","cancel"],["nz-form","",1,"flex-grow-column",2,"width","100%",3,"formGroup"],[1,"field","flex-grow-column"],["formControlName","SourceCode",2,"max-width","100%","max-height","100%","position","relative",3,"language","typings","tsOptions"],["dbPortalTemplate","ActionModalHeader-Left"],["dbPortalTemplate","ActionModalHeader-Right"],[1,"fields"],[2,"width","180px"],["formControlName","Language",2,"width","100%"],["nzLabel","Typescript","nzValue","Typescript"],["nzLabel","Javascript","nzValue","Javascript"],["nzLabel","Powershell","nzValue","Powershell"]],template:function(e,t){1&e&&(c.Tb(0,"action-basic-modal",0),c.bc("ok",(function(){return t.ok()}))("cancel",(function(){return t.cancel()})),c.Tb(1,"form",1),c.Tb(2,"div",2),c.Ob(3,"db-editor",3),c.fc(4,"async"),c.Sb(),c.Dc(5,X,1,0,"ng-template",4),c.Dc(6,q,6,0,"ng-template",5),c.Sb(),c.Sb()),2&e&&(c.lc("form",t.form),c.zb(1),c.lc("formGroup",t.form),c.zb(2),c.lc("language",t.form.value.Language)("typings",c.gc(4,5,t.typings$))("tsOptions",c.nc(7,W)))},directives:[D,k.r,k.n,F.b,k.h,f.a,k.m,k.g,M.e,Q.b,Q.a],pipes:[i.b],styles:[""]}),e})(),Z=(()=>{class e{constructor(e,t){this.modal=e,this.componentFactoryResolver=t}GetIcon(e){switch(e.ActionType){case"UrlRedirect":return"rollback";case"UrlRewrite":return"edit";case"Proxy":return"fa#random";case"Script":return"code"}return"hat wizard"}GetModal(e){switch(e.toLowerCase()){case"urlredirect":return this.modal.FromComponent(V).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"50%",maxWidth:"500px"}}).CloseOnOutsideClick();case"urlrewrite":return this.modal.FromComponent(U).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"50%",maxWidth:"500px"}}).CloseOnOutsideClick();case"script":return this.modal.FromComponent(Y).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"80%",height:"90%"}}).CloseOnOutsideClick()}}}return e.\u0275fac=function(t){return new(t||e)(c.Xb(z.b),c.Xb(c.j))},e.\u0275prov=c.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var ee=n("2rm1"),te=n("t8yx"),ne=n("XS/p");const ie=["contextMenu"],oe=["addRuleTemplate"];function ce(e,t){1&e&&(c.Tb(0,"div",8),c.Tb(1,"div",9),c.Fc(2,"Currently there is nothing..."),c.Sb(),c.Tb(3,"p"),c.Fc(4,"Use the ContextMenu to create your first rule!"),c.Sb(),c.Sb())}function re(e,t){if(1&e&&(c.Tb(0,"span",21),c.Ob(1,"db-icon",22),c.Sb()),2&e){const e=t.$implicit,n=c.ec(2);c.lc("nzTooltipTitle",e.ActionType),c.zb(1),c.lc("icon",n.GetIcon(e))}}function se(e,t){1&e&&c.Ob(0,"div",23)}function le(e,t){if(1&e){const e=c.Ub();c.Tb(0,"div",10),c.bc("click",(function(n){c.vc(e);const i=t.$implicit;return c.ec().clickAction(n,i)}))("contextmenu",(function(n){c.vc(e);const i=t.$implicit,o=c.ec(),r=c.tc(11);return o.openItemContextMenu(n,r,i)}))("dblclick",(function(){c.vc(e);const n=t.$implicit;return c.ec().editRule(n.Item.Id)})),c.Tb(1,"div",11),c.Tb(2,"div",12),c.Ob(3,"db-icon",13),c.Sb(),c.Tb(4,"div",14),c.Tb(5,"div",15),c.Fc(6),c.Sb(),c.Tb(7,"div"),c.Fc(8),c.Sb(),c.Sb(),c.Tb(9,"div",16),c.Tb(10,"div"),c.Fc(11),c.Sb(),c.Tb(12,"div"),c.Fc(13),c.Sb(),c.Sb(),c.Tb(14,"div",17),c.Tb(15,"div",18),c.Tb(16,"div"),c.Fc(17),c.Sb(),c.Dc(18,re,2,2,"span",19),c.Sb(),c.Dc(19,se,1,0,"div",20),c.Sb(),c.Sb(),c.Sb()}if(2&e){const e=t.$implicit,n=c.ec();c.Fb("selected",e.Selected)("disabled",!e.Item.Enabled),c.zb(6),c.Gc(e.Item.Name),c.zb(2),c.Gc(e.Item.Path),c.zb(3),c.Gc(e.Item.Scheme),c.zb(2),c.Gc(e.Item.Hostname),c.zb(4),c.Hc(" ",(null==e.Item.Actions?null:e.Item.Actions.length)||0," Actions "),c.zb(1),c.lc("ngForOf",e.Item.Actions),c.zb(1),c.lc("ngIf",n.IsRuleTerminating(e.Item))}}function ae(e,t){if(1&e){const e=c.Ub();c.Tb(0,"ul",24),c.Tb(1,"li",25),c.Tb(2,"ul",26),c.Tb(3,"li",27),c.bc("click",(function(){return c.vc(e),c.ec().CreateRuleOnTop()})),c.Ob(4,"db-icon",28),c.Fc(5," Top "),c.Sb(),c.Tb(6,"li",27),c.bc("click",(function(){return c.vc(e),c.ec().CreateRuleOnBottom()})),c.Ob(7,"db-icon",29),c.Fc(8," Bottom "),c.Sb(),c.Sb(),c.Sb(),c.Sb()}}function de(e,t){if(1&e){const e=c.Ub();c.Tb(0,"li",27),c.bc("click",(function(){c.vc(e);const t=c.ec().$implicit;return c.ec().SetRuleEnabled(t.Single,!0)})),c.Ob(1,"db-icon",34),c.Fc(2," Enable "),c.Sb()}}function ue(e,t){if(1&e){const e=c.Ub();c.Tb(0,"li",27),c.bc("click",(function(){c.vc(e);const t=c.ec().$implicit;return c.ec().SetRuleEnabled(t.Single,!1)})),c.Ob(1,"db-icon",35),c.Fc(2," Disable "),c.Sb()}}function be(e,t){if(1&e){const e=c.Ub();c.Tb(0,"li",25),c.Tb(1,"ul",26),c.Tb(2,"li",27),c.bc("click",(function(){return c.vc(e),c.ec(2).CreateRuleOnTop()})),c.Ob(3,"db-icon",28),c.Fc(4," Top "),c.Sb(),c.Tb(5,"li",27),c.bc("click",(function(){c.vc(e);const t=c.ec().$implicit;return c.ec().CreateRuleBefore(t.Single)})),c.Ob(6,"db-icon",36),c.Fc(7," Before "),c.Sb(),c.Tb(8,"li",27),c.bc("click",(function(){c.vc(e);const t=c.ec().$implicit;return c.ec().CreateRuleAfter(t.Single)})),c.Ob(9,"db-icon",37),c.Fc(10," After "),c.Sb(),c.Tb(11,"li",27),c.bc("click",(function(){return c.vc(e),c.ec(2).CreateRuleOnBottom()})),c.Ob(12,"db-icon",29),c.Fc(13," Bottom "),c.Sb(),c.Sb(),c.Sb()}}function he(e,t){if(1&e){const e=c.Ub();c.Tb(0,"ul",24),c.Dc(1,de,3,0,"li",30),c.Dc(2,ue,3,0,"li",30),c.Dc(3,be,14,0,"li",31),c.Ob(4,"li",32),c.Tb(5,"li",27),c.bc("click",(function(){c.vc(e);const n=t.$implicit;return c.ec().RemoveRules(n.Selected)})),c.Ob(6,"db-icon",33),c.Fc(7," Remove "),c.Sb(),c.Sb()}if(2&e){const e=t.$implicit;c.zb(1),c.lc("ngIf",!1===(null==e.Single?null:e.Single.Enabled)),c.zb(1),c.lc("ngIf",!0===(null==e.Single?null:e.Single.Enabled)),c.zb(1),c.lc("ngIf",e.Single)}}const pe=function(){return[]};let ge=(()=>{class e{constructor(e,t,n,i,o,r,s,l){this.rulesService=e,this.cref=t,this.overlay=n,this.viewContainerRef=i,this.router=o,this.route=r,this.actionHelper=s,this.endpointRulesQuery=l,this._rules=[],this.rulesSubject$=new a.a(this._rules),this.rules$=this.rulesSubject$.asObservable(),this.rulesChanged=new c.n,this.selected=[],this.registered=[],this.onTouched=()=>{}}set rules(e){this._rules=(e||[]).map(e=>{const t=this._rules.find(t=>t.Item.Id===e.Id);return t?(t.Item=e,t):new d(e)}),this.rulesSubject$.next(this._rules)}get rules(){return this._rules.map(e=>e.Item)}ngOnInit(){this.rulesService.GetAllRules().pipe(Object(l.a)(e=>{this.rules=e})).subscribe()}ngAfterViewInit(){}clickAction(e,t){e.ctrlKey?t.Selected=!t.Selected:this._rules=this._rules.map(e=>(e.Selected=e==t,e))}openOuterContextMenu(e,t){var n;e.stopPropagation(),null===(n=this.ContextMenu)||void 0===n||n.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,null)}openItemContextMenu(e,t,n){var i;e.stopPropagation();const o=this._rules.filter(e=>e.Selected);0!=o.length&&o.includes(n)||(this._rules=this._rules.map(e=>(e.Selected=e==n,e))),null===(i=this.ContextMenu)||void 0===i||i.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,this.BuildContext())}DeSelectAll(){console.log("Deselect"),this._rules=this._rules.map(e=>(e.Selected=!1,e))}SetRuleEnabled(e,t){var n;null===(n=this.ContextMenu)||void 0===n||n.Close(),this.rulesService.SetRuleEnabled(e,t)}GetActionByIndex(e){return this.rules[e]}GetActionById(e){return this.rules.find(t=>t.Id===e)}ClearSelection(){this.selected=[],this.cref.markForCheck()}BuildContext(){const e=new b;return e.AllItems=this.rules,e.Selected=this._rules.filter(e=>e.Selected).map(e=>e.Item),e}IsRuleTerminating(e){return!!e.Actions&&-1!=e.Actions.findIndex(e=>e.Enabled&&e.Terminating)}initContextMenu(e){}CreateRuleOnTop(){let e=new s;e.Enabled=!1,e.Order=this.rules&&0!=this.rules.length?this.rules[0].Order/2:10,this.rulesService.Add(e).subscribe(),this.ContextMenu.Close()}CreateRuleBefore(e){const t=this.rules.findIndex(t=>t.Order===e.Order);let n=new s;n.Enabled=!1,n.Order=0==t?e.Order/2:e.Order-(e.Order-this.rules[t-1].Order)/2,console.log(n),this.rulesService.Add(n).subscribe(),this.ContextMenu.Close()}CreateRuleAfter(e){const t=this.rules.findIndex(t=>t.Order===e.Order);let n=new s;n.Enabled=!1,n.Order=t==this.rules.length-1?this.rulesService.GetNextLastOrder():e.Order+(this.rules[t+1].Order-e.Order)/2,console.log(n),this.rulesService.Add(n).subscribe(),this.ContextMenu.Close()}CreateRuleOnBottom(){let e=new s;e.Enabled=!1,e.Order=this.rulesService.GetNextLastOrder(),this.rulesService.Add(e).subscribe(),this.ContextMenu.Close()}RemoveRules(e){e.forEach(e=>this.rulesService.Remove(e.Id).subscribe()),this.ContextMenu.Close()}editRule(e){this.router.navigate([e],{relativeTo:this.route})}calculateRuleOrder(e){if(0===this.rules.length)return 10;if(0===e)return this.rules[0].Order/2;if(e>=this.rules.length)return this.rulesService.GetNextLastOrder();const t=this.rules[e-1].Order;return(this.rules[e].Order-t)/2+t}drop(e){if(e.previousContainer===e.container){const t=this.endpointRulesQuery.getAll().sort(this.rulesService.SortRules),n=t[e.previousIndex];let i=null;if(e.previousIndex<e.currentIndex?i="forward":e.previousIndex>e.currentIndex&&(i="back"),!i)return;if("forward"===i)if(e.currentIndex===t.length-1)this.rulesService.UpdateRuleOrder(n,this.rulesService.GetNextLastOrder());else{const i=t[e.currentIndex];this.rulesService.UpdateRuleOrder(n,(t[e.currentIndex+1].Order-i.Order)/2+i.Order)}else if("back"===i)if(0===e.currentIndex)this.rulesService.UpdateRuleOrder(n,t[0].Order/2);else{const i=t[e.currentIndex-1];this.rulesService.UpdateRuleOrder(n,(t[e.currentIndex].Order-i.Order)/2+i.Order)}Object(u.e)(t,e.previousIndex,e.currentIndex)}else{let t=new s;t.Enabled=!1,console.log(e),t.Order=this.calculateRuleOrder(e.currentIndex),this.rulesService.Add(t).subscribe()}}GetIcon(e){return this.actionHelper.GetIcon(e)}prepareIcon(e){if(!e)return null;if(e.startsWith("fa#")){let t={type:"fa",icon:null};return e=e.substring(3),t.icon=e.includes("|")?e.split("|"):e,t}return{type:"ant",icon:e}}propagateChange(e){this.rulesChanged.next(e),this.registered.forEach(t=>{t(e)})}writeValue(e){this.rules=e}registerOnChange(e){-1===this.registered.indexOf(e)&&this.registered.push(e)}registerOnTouched(e){this.onTouched=e}setDisabledState(e){throw new Error("Method not implemented.")}}return e.\u0275fac=function(t){return new(t||e)(c.Nb(T),c.Nb(c.h),c.Nb(z.c),c.Nb(c.P),c.Nb(o.i),c.Nb(o.a),c.Nb(Z),c.Nb(v))},e.\u0275cmp=c.Hb({type:e,selectors:[["enpoint-rules-list"]],viewQuery:function(e,t){var n;1&e&&(c.Jc(ie,!0),c.Jc(oe,!0)),2&e&&(c.sc(n=c.cc())&&(t.contextMenu=n.first),c.sc(n=c.cc())&&(t.addRuleTemplate=n.first))},inputs:{rules:"rules"},outputs:{rulesChanged:"rulesChanged"},decls:12,vars:7,consts:[["cdkDropList","",1,"outer",2,"flex-grow","1","height","100%",3,"contextmenu"],["nullList","cdkDropList"],["cdkDropList","",1,"",2,"padding","2px","margin-top","8px","max-height","calc(100% - 30px)","overflow-y","auto",3,"cdkDropListDropped"],["rulesList","cdkDropList"],["style","text-align: center; font-size: 1.3em; font-weight: bold; color: #525e7678; line-height: 1.4em; line-height: 2em; margin: 0px 10px;",4,"ngIf"],["class","rule-item","cdkDrag","","cdkDragLockAxis","y",3,"selected","disabled","click","contextmenu","dblclick",4,"ngFor","ngForOf"],["outerContextMenu",""],["itemContextMenu",""],[2,"text-align","center","font-size","1.3em","font-weight","bold","color","#525e7678","line-height","1.4em","line-height","2em","margin","0px 10px"],[2,"font-size","1.5em"],["cdkDrag","","cdkDragLockAxis","y",1,"rule-item",3,"click","contextmenu","dblclick"],[2,"display","flex","min-height","60px"],["cdkDragHandle","",1,"dragHandle",2,"padding","10px 0px 0px 5px"],["icon","fa#ellipsis-v",2,"width","1.18em","margin","0 .25rem 0 0","font-size","1.2em"],[2,"padding","5px","flex-grow","1"],[2,"font-size","large","font-weight","bold","color","#292f3b"],[2,"padding","5px","min-width","200px","max-width","200px"],[2,"min-width","200px","max-width","200px","display","flex"],[2,"flex-grow","1","padding","5px"],["nz-tooltip","",3,"nzTooltipTitle",4,"ngFor","ngForOf"],["class","terminate-indicator","nz-tooltip","","nzTooltipTitle","Stop processing further Rules",4,"ngIf"],["nz-tooltip","",3,"nzTooltipTitle"],[3,"icon"],["nz-tooltip","","nzTooltipTitle","Stop processing further Rules",1,"terminate-indicator"],["nz-menu","","nzMode","vertical",1,"context-menu"],["nz-submenu","","nzTitle","Add Rule","nzIcon","menu-unfold"],[1,"context-menu"],["nz-menu-item","",3,"click"],["icon","double-left","rotate","90"],["icon","double-right","rotate","90"],["nz-menu-item","",3,"click",4,"ngIf"],["nz-submenu","","nzTitle","Add Rule","nzIcon","menu-unfold",4,"ngIf"],["nz-menu-divider",""],["icon","delete"],["icon","fa#toggle-on"],["icon","fa#toggle-off"],["icon","up"],["icon","down"]],template:function(e,t){if(1&e){const e=c.Ub();c.Tb(0,"div",0,1),c.bc("contextmenu",(function(n){c.vc(e);const i=c.tc(9);return t.openOuterContextMenu(n,i)})),c.Tb(2,"div",2,3),c.bc("cdkDropListDropped",(function(e){return t.drop(e)})),c.Dc(4,ce,5,0,"div",4),c.fc(5,"async"),c.Dc(6,le,20,11,"div",5),c.fc(7,"async"),c.Sb(),c.Sb(),c.Dc(8,ae,9,0,"ng-template",null,6,c.Ec),c.Dc(10,he,8,3,"ng-template",null,7,c.Ec)}2&e&&(c.zb(4),c.lc("ngIf",0===(c.gc(5,2,t.rules$)||c.nc(6,pe)).length),c.zb(2),c.lc("ngForOf",c.gc(7,4,t.rules$)))},directives:[u.c,i.o,i.n,u.a,u.b,ee.c,te.d,ne.c,R.a,ne.g,ne.e,ne.d],pipes:[i.b],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1}.rule-item[_ngcontent-%COMP%]{margin-bottom:10px!important;border-radius:0!important;box-shadow:0 0 3px 1px #cecece;background-color:#fff}.rule-item.disabled[_ngcontent-%COMP%]{opacity:.6;box-shadow:none;background-color:#e2e2e2}.rule-item[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{border-right:1px solid #fff}.rule-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}.rule-item.selected[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{background-color:#292f3b;color:#fff}.rule-item[_ngcontent-%COMP%]:hover{background-color:#b2b7c2}.new-rule.ui.button[_ngcontent-%COMP%]{margin:0}.options[_ngcontent-%COMP%]{background-color:grey;height:50px}.list-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{background-color:inherit!important}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:inherit}.dragHandle[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.list-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#e0e1e2}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{cursor:inherit}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:inherit}.list-item.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%], .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{border-radius:0!important;background-color:#2f2f2f;color:#f5f5f5}.outer.cdk-drop-list-dragging[_ngcontent-%COMP%] > .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{display:none}.context-menu[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{margin:0!important}.anticon.disabled[_ngcontent-%COMP%]{color:#ccc}.terminate-indicator[_ngcontent-%COMP%]{width:8px;background-color:#525e76;border-left:1px solid #fff}.action-item.disabled[_ngcontent-%COMP%]   .terminate-indicator[_ngcontent-%COMP%]{background-color:inherit}.action-item[_ngcontent-%COMP%]:hover   .terminate-indicator[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}  .ant-divider-horizontal.ant-divider-with-text-center:after,   .ant-divider-horizontal.ant-divider-with-text-center:before{border-top:1px solid #525e76!important}"],changeDetection:0}),e})(),fe=(()=>{class e{constructor(e){this.uiService=e,e.Set(e=>{e.Header.Title="Endpoint Rules",e.Content.Scrollable=!1,e.Header.Icon="fa#stream"})}}return e.\u0275fac=function(t){return new(t||e)(c.Nb(r.a))},e.\u0275cmp=c.Hb({type:e,selectors:[["ng-component"]],decls:2,vars:0,consts:[[2,"display","flex","flex-direction","column","flex-grow","1"]],template:function(e,t){1&e&&(c.Tb(0,"div",0),c.Ob(1,"enpoint-rules-list"),c.Sb())},directives:[ge],styles:[""]}),e})();var me=n("HM3f"),Se=n("3lSR"),Oe=n("t2t5"),ve=n("INpK"),xe=n("vkL3");const Te=["urlredirect"],ze=["urlrewrite"],Ce=["script"];function we(e,t){if(1&e&&(c.Tb(0,"div"),c.Fc(1),c.Sb(),c.Tb(2,"div"),c.Fc(3),c.Sb(),c.Tb(4,"div"),c.Fc(5),c.Sb()),2&e){const e=c.ec();c.zb(1),c.Hc(" Redirect to ",e.action.Parameters.RedirectTo," "),c.zb(2),c.Hc(" Permanent: ",e.action.Parameters.Permanent," "),c.zb(2),c.Hc(" PreserveMethod: ",e.action.Parameters.PreserveMethod," ")}}function Ie(e,t){if(1&e&&(c.Tb(0,"div"),c.Fc(1),c.Sb()),2&e){const e=c.ec();c.zb(1),c.Hc(" Rewrite to ",e.action.Parameters.RewriteTo," ")}}function ke(e,t){if(1&e&&(c.Tb(0,"div"),c.Fc(1),c.Sb()),2&e){const e=c.ec();c.zb(1),c.Hc(" ",e.action.Parameters.Language," ")}}let Me=(()=>{class e{ngOnInit(){this.template=this.determineTemplate()}determineTemplate(){switch(this.action.ActionType){case"UrlRedirect":return this.UrlRedirect;case"UrlRewrite":return this.UrlRewrite;case"Script":return this.Script}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c.Hb({type:e,selectors:[["action-list-details"]],viewQuery:function(e,t){var n;1&e&&(c.Ac(Te,!0),c.Ac(ze,!0),c.Ac(Ce,!0)),2&e&&(c.sc(n=c.cc())&&(t.UrlRedirect=n.first),c.sc(n=c.cc())&&(t.UrlRewrite=n.first),c.sc(n=c.cc())&&(t.Script=n.first))},inputs:{action:"action"},decls:8,vars:1,consts:[[2,"font-size","x-small"],[3,"ngTemplateOutlet"],["urlredirect",""],["urlrewrite",""],["script",""]],template:function(e,t){1&e&&(c.Tb(0,"div",0),c.Pb(1,1),c.Sb(),c.Dc(2,we,6,3,"ng-template",null,2,c.Ec),c.Dc(4,Ie,2,1,"ng-template",null,3,c.Ec),c.Dc(6,ke,2,1,"ng-template",null,4,c.Ec)),2&e&&(c.zb(1),c.lc("ngTemplateOutlet",t.template))},directives:[i.t],styles:[""]}),e})();var Pe=n("JbzU"),ye=n("Pq5H"),Re=n("fWDI");function Ae(e,t){1&e&&(c.Tb(0,"div",8),c.Tb(1,"div",9),c.Fc(2,"Currently there is nothing..."),c.Sb(),c.Tb(3,"p"),c.Fc(4,"Use the ContextMenu to create your first action!"),c.Sb(),c.Sb())}function _e(e,t){if(1&e&&c.Ob(0,"i",23),2&e){const e=c.ec().$implicit;c.lc("nzType",e.icon)}}function De(e,t){if(1&e&&c.Ob(0,"fa-icon",24),2&e){const e=c.ec().$implicit;c.lc("icon",e.icon)}}function Fe(e,t){if(1&e&&(c.Tb(0,"div",20),c.Dc(1,_e,1,1,"i",21),c.Dc(2,De,1,1,"fa-icon",22),c.Sb()),2&e){const e=t.$implicit;c.zb(1),c.lc("ngIf","ant"==e.type),c.zb(1),c.lc("ngIf","fa"==e.type)}}function Ne(e,t){if(1&e&&c.Ob(0,"div",25),2&e){const e=c.ec(),t=e.$implicit,n=e.index,i=c.ec();c.lc("nzTooltipTitle",i.GetTerminateStatusText(t,n))}}function He(e,t){if(1&e&&(c.Rb(0),c.Ob(1,"nz-divider",26),c.Qb()),2&e){const e=t.$implicit;c.zb(1),c.lc("nzText",e)}}function Ee(e,t){if(1&e){const e=c.Ub();c.Rb(0),c.Tb(1,"div",10),c.Tb(2,"div",11),c.bc("click",(function(n){c.vc(e);const i=t.$implicit;return c.ec().ClickAction(n,i)}))("dblclick",(function(){c.vc(e);const n=t.$implicit;return c.ec().openModal(n)}))("contextmenu",(function(n){c.vc(e);const i=t.$implicit,o=c.ec(),r=c.tc(11);return o.openItemContextMenu(n,r,i)})),c.Tb(3,"div",12),c.Tb(4,"div",13),c.Dc(5,Fe,3,2,"div",14),c.Sb(),c.Tb(6,"div",15),c.Tb(7,"div",16),c.Fc(8),c.Sb(),c.Ob(9,"action-list-details",17),c.Sb(),c.Dc(10,Ne,1,1,"div",18),c.Sb(),c.Sb(),c.Dc(11,He,2,1,"ng-container",19),c.Sb(),c.Qb()}if(2&e){const e=t.$implicit,n=t.index,i=c.ec();c.zb(2),c.Fb("selected",i.IsActionSelected(e))("disabled",!e.Enabled)("afterTerminate",i.IsAfterTerminate(n)),c.zb(3),c.lc("ngIf",i.prepareIcon(i.GetIcon(e))),c.zb(3),c.Hc("",e.ActionType," "),c.zb(1),c.lc("action",e),c.zb(1),c.lc("ngIf",e.Terminating),c.zb(1),c.lc("ngIf",i.GetTerminateStatus(e,n))}}function $e(e,t){if(1&e){const e=c.Ub();c.Tb(0,"ul",27),c.Tb(1,"li",28),c.Tb(2,"ul",29),c.Tb(3,"li",30),c.bc("click",(function(){return c.vc(e),c.ec().CreateAction("UrlRedirect","bottom")})),c.Ob(4,"i",31),c.Fc(5," UrlRedirect "),c.Sb(),c.Tb(6,"li",30),c.bc("click",(function(){return c.vc(e),c.ec().CreateAction("UrlRewrite","bottom")})),c.Ob(7,"i",32),c.Fc(8," UrlRewrite "),c.Sb(),c.Tb(9,"li",30),c.bc("click",(function(){return c.vc(e),c.ec().CreateAction("Script","bottom")})),c.Ob(10,"i",33),c.Fc(11," Script "),c.Sb(),c.Sb(),c.Sb(),c.Sb()}}const Ue=function(){return["fas","toggle-on"]};function Le(e,t){if(1&e){const e=c.Ub();c.Tb(0,"li",30),c.bc("click",(function(){c.vc(e);const t=c.ec().$implicit;return c.ec().SetActionEnabled(t.Single,!0)})),c.Ob(1,"fa-icon",40),c.Fc(2," Enable "),c.Sb()}2&e&&(c.zb(1),c.lc("icon",c.nc(1,Ue)))}const Ge=function(){return["fas","toggle-off"]};function Be(e,t){if(1&e){const e=c.Ub();c.Tb(0,"li",30),c.bc("click",(function(){c.vc(e);const t=c.ec().$implicit;return c.ec().SetActionEnabled(t.Single,!1)})),c.Ob(1,"fa-icon",40),c.Fc(2," Disable "),c.Sb()}2&e&&(c.zb(1),c.lc("icon",c.nc(1,Ge)))}function je(e,t){if(1&e){const e=c.Ub();c.Tb(0,"li",30),c.bc("click",(function(){c.vc(e);const t=c.ec().$implicit;return c.ec().openModal(t.Single)})),c.Ob(1,"i",41),c.Fc(2," Edit "),c.Sb()}}function Ve(e,t){if(1&e){const e=c.Ub();c.Tb(0,"li",30),c.bc("click",(function(){c.vc(e);const t=c.ec(2).$implicit;return c.ec().SetActionTerminate(t.Single,!0)})),c.Ob(1,"db-icon",43),c.Fc(2," Stop processing after Action "),c.Sb()}}function Ke(e,t){if(1&e){const e=c.Ub();c.Tb(0,"li",30),c.bc("click",(function(){c.vc(e);const t=c.ec(2).$implicit;return c.ec().SetActionTerminate(t.Single,!1)})),c.Ob(1,"db-icon",44),c.Fc(2," Continue processing after Action "),c.Sb()}}function Je(e,t){if(1&e&&(c.Tb(0,"li",42),c.Tb(1,"ul",29),c.Dc(2,Ve,3,0,"li",34),c.Dc(3,Ke,3,0,"li",34),c.Sb(),c.Sb()),2&e){const e=c.ec().$implicit;c.zb(2),c.lc("ngIf",!1===(null==e.Single?null:e.Single.Terminating)),c.zb(1),c.lc("ngIf",!0===(null==e.Single?null:e.Single.Terminating))}}function Qe(e,t){if(1&e){const e=c.Ub();c.Tb(0,"li",45),c.Tb(1,"ul",29),c.Tb(2,"li",30),c.bc("click",(function(){c.vc(e);const t=c.ec().$implicit;return c.ec().CreateAction("UrlRedirect","before",t.Single)})),c.Ob(3,"i",31),c.Fc(4," UrlRedirect "),c.Sb(),c.Tb(5,"li",30),c.bc("click",(function(){c.vc(e);const t=c.ec().$implicit;return c.ec().CreateAction("UrlRewrite","before",t.Single)})),c.Ob(6,"i",32),c.Fc(7," UrlRewrite "),c.Sb(),c.Tb(8,"li",30),c.bc("click",(function(){c.vc(e);const t=c.ec().$implicit;return c.ec().CreateAction("Script","before",t.Single)})),c.Ob(9,"i",33),c.Fc(10," Script "),c.Sb(),c.Sb(),c.Sb()}}function Xe(e,t){if(1&e){const e=c.Ub();c.Tb(0,"li",46),c.Tb(1,"ul",29),c.Tb(2,"li",30),c.bc("click",(function(){c.vc(e);const t=c.ec().$implicit;return c.ec().CreateAction("UrlRedirect","after",t.Single)})),c.Ob(3,"i",31),c.Fc(4," UrlRedirect "),c.Sb(),c.Tb(5,"li",30),c.bc("click",(function(){c.vc(e);const t=c.ec().$implicit;return c.ec().CreateAction("UrlRewrite","after",t.Single)})),c.Ob(6,"i",32),c.Fc(7," UrlRewrite "),c.Sb(),c.Tb(8,"li",30),c.bc("click",(function(){c.vc(e);const t=c.ec().$implicit;return c.ec().CreateAction("Script","after",t.Single)})),c.Ob(9,"i",33),c.Fc(10," Script "),c.Sb(),c.Sb(),c.Sb()}}function qe(e,t){if(1&e){const e=c.Ub();c.Tb(0,"ul",27),c.Dc(1,Le,3,2,"li",34),c.Dc(2,Be,3,2,"li",34),c.Dc(3,je,3,0,"li",34),c.Dc(4,Je,4,2,"li",35),c.Dc(5,Qe,11,0,"li",36),c.Dc(6,Xe,11,0,"li",37),c.Ob(7,"li",38),c.Tb(8,"li",30),c.bc("click",(function(){c.vc(e);const n=t.$implicit;return c.ec().RemoveActions(n.Selected)})),c.Ob(9,"i",39),c.Fc(10," Remove "),c.Sb(),c.Sb()}if(2&e){const e=t.$implicit;c.zb(1),c.lc("ngIf",!1===(null==e.Single?null:e.Single.Enabled)),c.zb(1),c.lc("ngIf",!0===(null==e.Single?null:e.Single.Enabled)),c.zb(1),c.lc("ngIf",e.Single),c.zb(1),c.lc("ngIf",e.Single),c.zb(1),c.lc("ngIf",e.Single),c.zb(1),c.lc("ngIf",e.Single)}}const We=function(){return[]};let Ye=(()=>{class e{constructor(e,t,n,i,o,r,s,d){this.uiService=e,this.modal=t,this.overlay=n,this.viewContainerRef=i,this.cref=o,this.componentFactoryResolver=r,this.actionHelper=s,this.rulesService=d,this.terminateActionIndex=-1,this.actionsSubject$=new a.a(null),this.actions$=this.actionsSubject$.asObservable().pipe(Object(l.a)(e=>{this.terminateActionIndex=e.findIndex(e=>e.Enabled&&e.Terminating)})),this.actionsChange=new c.n,this.selectedActions=[],this.registered=[],this.onTouched=()=>{}}get actions(){return this.actionsSubject$.value}set actions(e){e=null==e?void 0:e.sort((e,t)=>e.Order>t.Order?1:e.Order<t.Order?-1:0),this.actionsSubject$.next(e)}ngOnInit(){}IsActionSelected(e){return this.selectedActions.includes(e.Id)}setActionSelected(e,t){this.selectedActions=t?[...new Set([...this.selectedActions,e.Id])]:this.selectedActions.filter(t=>t!=e.Id)}GetSelectedActions(){return this.actions.filter(e=>this.selectedActions.includes(e.Id))}ClickAction(e,t){var n;if(e.stopPropagation(),null===(n=this.ContextMenu)||void 0===n||n.Close(),e.ctrlKey){const e=this.IsActionSelected(t);this.setActionSelected(t,!e)}else this.selectedActions=[],this.setActionSelected(t,!0)}OpenOuterContextMenu(e,t){var n;e.stopPropagation(),this.selectedActions=[],null===(n=this.ContextMenu)||void 0===n||n.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,null)}ClickOutside(){this.selectedActions=[]}openItemContextMenu(e,t,n){var i;if(e.stopPropagation(),0==this.selectedActions.length||!this.IsActionSelected(n))if(e.ctrlKey){const e=this.IsActionSelected(n);this.setActionSelected(n,!e)}else this.selectedActions=[],this.setActionSelected(n,!0);null===(i=this.ContextMenu)||void 0===i||i.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,this.BuildContext())}BuildContext(){const e=new b;return e.AllItems=this.actions,e.Selected=this.actions.filter(e=>this.selectedActions.includes(e.Id)),e}GetIcon(e){return this.actionHelper.GetIcon(e)}prepareIcon(e){if(!e)return null;if(e.startsWith("fa#")){let t={type:"fa",icon:null};return e=e.substring(3),t.icon=e.includes("|")?e.split("|"):e,t}return{type:"ant",icon:e}}CreateAction(e,t,n){let i=new C;switch(e.toLowerCase()){case"urlredirect":i=new G;break;case"urlrewrite":i=new I;break;case"script":i=new J}i.Order=this.CalculateOrder(t,n),i.Id=this.getNewActionsId().toString(),this.actions=[...this.actions,i],this.propagateChange(this.actions)}getNewActionsId(){var e=this.actions.map(e=>{return/^(\-|\+)?([0-9]+|Infinity)$/.test(t=e.Id)?Number(t):NaN;var t}).filter(e=>!Number.isNaN(e)).sort((e,t)=>t-e);return e&&e.length>0?e[0]+1:0}GetNextLastOrder(){if(!this.actions||0===this.actions.length)return 10;var e=Math.trunc(Math.max(...this.actions.map(e=>e.Order))+10);return console.log("NEXT",e),e}CalculateOrder(e,t){var n;let i=-1;switch(t&&(i=null===(n=this.actions)||void 0===n?void 0:n.findIndex(e=>e.Order===t.Order)),e){case"top":return this.actions&&0!=this.actions.length?this.actions[0].Order/2:10;case"before":return 0==i?t.Order/2:t.Order-(t.Order-this.actions[i-1].Order)/2;case"after":return i==this.actions.length-1?this.GetNextLastOrder():t.Order+(this.actions[i+1].Order-t.Order)/2;case"bottom":return this.GetNextLastOrder()}}SetActionEnabled(e,t){this.actions=this.actions.map(n=>(n==e&&(n.Enabled=t),n)),this.propagateChange(this.actions)}SetActionTerminate(e,t){this.actions=this.actions.map(n=>(n==e&&(n.Terminating=t),n)),this.propagateChange(this.actions)}RemoveActions(e){var t;const n=e.map(e=>e.Id);this.actions=this.actions.filter(e=>!n.includes(e.Id)),this.propagateChange(this.actions),null===(t=this.ContextMenu)||void 0===t||t.Close()}drop(e){console.log(e);const t=this.actions[e.previousIndex];let n=null;if(e.previousIndex<e.currentIndex?n="forward":e.previousIndex>e.currentIndex&&(n="back"),n){if(console.log(n,this.actions.length),"forward"===n)if(e.currentIndex===this.actions.length-1)console.log("-- 1 --"),t.Order=this.GetNextLastOrder();else{console.log("-- 2 --");const n=this.actions[e.currentIndex];t.Order=(this.actions[e.currentIndex+1].Order-n.Order)/2+n.Order}else if("back"===n)if(0===e.currentIndex)console.log("-- 3 --"),t.Order=this.actions[0].Order/2;else{console.log("-- 4 --");const n=this.actions[e.currentIndex-1];t.Order=(this.actions[e.currentIndex].Order-n.Order)/2+n.Order}Object(u.e)(this.actions,e.previousIndex,e.currentIndex),this.actions=[...this.actions],this.propagateChange(this.actions)}}GetTerminateStatus(e,t){return e.Enabled?this.IsAfterTerminate(t)?null:this.GetTerminateStatusText(e,t):null}GetTerminateStatusText(e,t){const n=this.IsLastExecuted(t);return!e.Terminating&&n?"Continue with next Endpoint Rule":e.Terminating&&n?"Stop processing further Endpoint Rules":e.Terminating&&!n?"Stop processing further Actions / Endpoint Rules":void 0}IsAfterTerminate(e){return-1!=this.terminateActionIndex&&e>this.terminateActionIndex}IsLastExecuted(e){return 0==this.actions.filter((t,n)=>t.Enabled&&n>e).length}openModal(e){var t;switch(null===(t=this.ContextMenu)||void 0===t||t.Close(),Object.assign({},e),e.ActionType){case"UrlRedirect":this.actionHelper.GetModal("UrlRedirect").SetData(e).AddEventHandler("OK",t=>{e.Parameters=t.payload,this.actions=[...this.actions],this.propagateChange(this.actions)}).Open();break;case"UrlRewrite":this.actionHelper.GetModal("UrlRewrite").SetData(e).AddEventHandler("OK",t=>{e.Parameters=t.payload,this.actions=[...this.actions],this.propagateChange(this.actions)}).Open();break;case"Script":this.actionHelper.GetModal("Script").SetData(e).AddEventHandler("OK",t=>{e.Parameters=t.payload,this.actions=[...this.actions],this.propagateChange(this.actions)}).Open()}}propagateChange(e){this.actionsChange.emit(e),this.registered.forEach(t=>{t(e)})}writeValue(e){this.actions=e}registerOnChange(e){-1===this.registered.indexOf(e)&&this.registered.push(e)}registerOnTouched(e){this.onTouched=e}setDisabledState(e){}}return e.\u0275fac=function(t){return new(t||e)(c.Nb(r.a),c.Nb(z.b),c.Nb(z.c),c.Nb(c.P),c.Nb(c.h),c.Nb(c.j),c.Nb(Z),c.Nb(T))},e.\u0275cmp=c.Hb({type:e,selectors:[["endpoint-actions-list"]],inputs:{actions:"actions"},outputs:{actionsChange:"actionsChange"},features:[c.yb([{provide:k.k,useExisting:e,multi:!0}])],decls:12,vars:7,consts:[["cdkDropList","",1,"outer",2,"flex-grow","1","height","100%",3,"contextmenu","click"],["nullList","cdkDropList"],["cdkDropList","",2,"padding","2px","margin-top","8px","max-height","calc(100% - 30px)","overflow-y","auto",3,"cdkDropListDropped"],["rulesList","cdkDropList"],["style","text-align: center; font-size: 1.3em; font-weight: bold; color: #525e7678; line-height: 1.4em; line-height: 2em; margin: 0px 10px;",4,"ngIf"],[4,"ngFor","ngForOf"],["outerContextMenu",""],["itemContextMenu",""],[2,"text-align","center","font-size","1.3em","font-weight","bold","color","#525e7678","line-height","1.4em","line-height","2em","margin","0px 10px"],[2,"font-size","1.5em"],["cdkDrag","","cdkDragLockAxis","y"],[1,"action-item",3,"click","dblclick","contextmenu"],[2,"display","flex"],["cdkDragHandle","",1,"dragHandle",2,"padding","10px 0px 0px 5px"],["class","title-icon",4,"ngIf"],[2,"padding","5px","flex-grow","1"],[2,"font-size","large","font-weight","bold","color","#292f3b"],[3,"action"],["class","terminate-indicator","nz-tooltip","",3,"nzTooltipTitle",4,"ngIf"],[4,"ngIf"],[1,"title-icon"],["style","font-size: xx-large; width: 40px; text-align: left;","nz-icon","","nzTheme","outline",3,"nzType",4,"ngIf"],["style","font-size: xx-large; width: 40px; text-align: left;","nz-icon","",3,"icon",4,"ngIf"],["nz-icon","","nzTheme","outline",2,"font-size","xx-large","width","40px","text-align","left",3,"nzType"],["nz-icon","",2,"font-size","xx-large","width","40px","text-align","left",3,"icon"],["nz-tooltip","",1,"terminate-indicator",3,"nzTooltipTitle"],["nzDashed","",1,"action-divider",3,"nzText"],["nz-menu","","nzMode","vertical",1,"context-menu"],["nz-submenu","","nzTitle","Add Action","nzIcon","menu-unfold"],[1,"context-menu"],["nz-menu-item","",3,"click"],["nz-icon","","nzType","rollback","nzTheme","outline"],["nz-icon","","nzType","edit","nzTheme","outline"],["nz-icon","","nzType","code","nzTheme","outline"],["nz-menu-item","",3,"click",4,"ngIf"],["nz-submenu","","nzTitle","Options","nzIcon","setting",4,"ngIf"],["nz-submenu","","nzTitle","Add Action Before","nzIcon","up",4,"ngIf"],["nz-submenu","","nzTitle","Add Action After","nzIcon","down",4,"ngIf"],["nz-menu-divider",""],["nz-icon","","nzType","delete","nzTheme","outline"],["nz-icon","",3,"icon"],["nz-icon","","nzType","form","nzTheme","outline"],["nz-submenu","","nzTitle","Options","nzIcon","setting"],["icon","fa#far|stop-circle"],["icon","fa#far|play-circle"],["nz-submenu","","nzTitle","Add Action Before","nzIcon","up"],["nz-submenu","","nzTitle","Add Action After","nzIcon","down"]],template:function(e,t){if(1&e){const e=c.Ub();c.Tb(0,"div",0,1),c.bc("contextmenu",(function(n){c.vc(e);const i=c.tc(9);return t.OpenOuterContextMenu(n,i)}))("click",(function(){return t.ClickOutside()})),c.Tb(2,"div",2,3),c.bc("cdkDropListDropped",(function(e){return t.drop(e)})),c.Dc(4,Ae,5,0,"div",4),c.fc(5,"async"),c.Dc(6,Ee,12,11,"ng-container",5),c.fc(7,"async"),c.Sb(),c.Sb(),c.Dc(8,$e,12,0,"ng-template",null,6,c.Ec),c.Dc(10,qe,11,6,"ng-template",null,7,c.Ec)}2&e&&(c.zb(4),c.lc("ngIf",0===(c.gc(5,2,t.actions$)||c.nc(6,We)).length),c.zb(2),c.lc("ngForOf",c.gc(7,4,t.actions$)))},directives:[u.c,i.o,i.n,u.a,u.b,Me,R.a,Pe.a,ye.b,te.d,Re.a,ne.c,ne.g,ne.e,ne.d,ee.c],pipes:[i.b],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1}.action-item[_ngcontent-%COMP%]{margin-bottom:10px!important;border-radius:0!important;box-shadow:0 0 3px 1px #cecece;background-color:#fff}.action-item.disabled[_ngcontent-%COMP%]{opacity:.6;box-shadow:none;background-color:#e2e2e2}.action-item[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{border-right:1px solid #fff}.action-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}.action-item.selected[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{background-color:#292f3b;color:#fff}.action-item[_ngcontent-%COMP%]:hover{background-color:#b2b7c2}.new-rule.ui.button[_ngcontent-%COMP%]{margin:0}.options[_ngcontent-%COMP%]{background-color:grey;height:50px}.list-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{background-color:inherit!important}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:inherit}.dragHandle[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.list-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#e0e1e2}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{cursor:inherit}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:inherit}.list-item.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%], .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{border-radius:0!important;background-color:#2f2f2f;color:#f5f5f5}.outer.cdk-drop-list-dragging[_ngcontent-%COMP%] > .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{display:none}.context-menu[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{margin:0!important}.afterTerminate[_ngcontent-%COMP%]{opacity:.3}.terminate-indicator[_ngcontent-%COMP%]{width:8px;background-color:#525e76;border-left:1px solid #fff}.action-item.disabled[_ngcontent-%COMP%]   .terminate-indicator[_ngcontent-%COMP%]{background-color:inherit}.action-item[_ngcontent-%COMP%]:hover   .terminate-indicator[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}"],changeDetection:0}),e})();function Ze(e,t){1&e&&(c.Ob(0,"i",32),c.Fc(1,"Basic "))}function et(e,t){1&e&&(c.Tb(0,"span"),c.Fc(1,"Enabled"),c.Sb())}function tt(e,t){1&e&&(c.Tb(0,"span"),c.Fc(1,"Disabled"),c.Sb())}function nt(e,t){1&e&&(c.Ob(0,"i",33),c.Fc(1,"Actions"))}function it(e,t){1&e&&(c.Ob(0,"i",36),c.Fc(1,"Debug"))}function ot(e,t){if(1&e&&(c.Tb(0,"nz-tab",3),c.Dc(1,it,2,0,"ng-template",null,34,c.Ec),c.Tb(3,"div",35),c.Tb(4,"pre"),c.Fc(5),c.fc(6,"json"),c.Sb(),c.Sb(),c.Sb()),2&e){const e=c.tc(2),t=c.ec(2);c.lc("nzTitle",e),c.zb(5),c.Gc(c.gc(6,2,t.form.value))}}const ct=function(){return{inkBar:!0,tabPane:!1}},rt=function(){return[","]};function st(e,t){if(1&e){const e=c.Ub();c.Rb(0),c.Tb(1,"form",1),c.Tb(2,"nz-tabset",2),c.bc("nzSelectChange",(function(t){return c.vc(e),c.ec().tabChanged(t)})),c.Tb(3,"nz-tab",3),c.Dc(4,Ze,2,0,"ng-template",null,4,c.Ec),c.Tb(6,"div",5),c.Tb(7,"div",6),c.Tb(8,"nz-form-label",7),c.Fc(9,"Name"),c.Sb(),c.Tb(10,"nz-form-control"),c.Ob(11,"input",8),c.Sb(),c.Tb(12,"nz-form-label",9),c.Fc(13,"Path"),c.Sb(),c.Tb(14,"nz-form-control"),c.Ob(15,"input",10),c.Sb(),c.Tb(16,"nz-form-label",11),c.Fc(17,"Hostname"),c.Sb(),c.Tb(18,"nz-form-control"),c.Ob(19,"input",12),c.Sb(),c.Sb(),c.Ob(20,"div",13),c.Tb(21,"div",14),c.Tb(22,"nz-collapse",15),c.Tb(23,"nz-collapse-panel",16),c.Tb(24,"label",17),c.Dc(25,et,2,0,"span",0),c.Dc(26,tt,2,0,"span",0),c.Sb(),c.Sb(),c.Tb(27,"nz-collapse-panel",18),c.Tb(28,"nz-select",19),c.Ob(29,"nz-option",20),c.Ob(30,"nz-option",21),c.Sb(),c.Sb(),c.Tb(31,"nz-collapse-panel",22),c.Tb(32,"nz-form-control"),c.Tb(33,"nz-select",23),c.Ob(34,"nz-option",24),c.Ob(35,"nz-option",25),c.Ob(36,"nz-option",26),c.Ob(37,"nz-option",27),c.Ob(38,"nz-option",28),c.Sb(),c.Sb(),c.Sb(),c.Sb(),c.Sb(),c.Sb(),c.Sb(),c.Tb(39,"nz-tab",3),c.Dc(40,nt,2,0,"ng-template",null,29,c.Ec),c.Ob(42,"endpoint-actions-list",30),c.Sb(),c.Dc(43,ot,7,4,"nz-tab",31),c.fc(44,"async"),c.Sb(),c.Sb(),c.Qb()}if(2&e){const e=c.tc(5),t=c.tc(41),n=c.ec();c.zb(1),c.lc("formGroup",n.form),c.zb(1),c.lc("nzAnimated",c.nc(12,ct)),c.zb(1),c.lc("nzTitle",e),c.zb(19),c.lc("nzBordered",!0),c.zb(1),c.lc("nzActive",!0),c.zb(2),c.lc("ngIf",!!n.form.value.Enabled),c.zb(1),c.lc("ngIf",!n.form.value.Enabled),c.zb(7),c.lc("nzTokenSeparators",c.nc(13,rt)),c.zb(6),c.lc("nzTitle",t),c.zb(4),c.lc("ngIf",c.gc(44,10,n.showDebugInformations$))}}const lt=[{path:"",component:fe},{path:":id",component:(()=>{class e{constructor(e,t,n,i){this.uiService=e,this.route=t,this.rulesService=n,this.fb=i,this.rule$=Object(me.a)([this.route.paramMap,this.route.queryParamMap,this.route.fragment]).pipe(Object(p.a)(([e,t,n])=>(this.Id=e.get("id"),this.rulesService.GetRule(this.Id))),Object(Se.a)(),Object(p.a)(e=>(e.Actions=e.Actions.sort((e,t)=>e.Order-t.Order),e)),Object(l.a)(e=>{this.BaseRule||(this.BaseRule=e),this.uiService.Set(t=>{t.Header.Title="Endpoint Rule",t.Header.SubTitle=e.Name,t.Header.Icon="form",t.Footer.Button1.Visible=!0,t.Footer.Button2.Visible=!0}),this.form.patchValue(e)})),this.showDebugInformations$=this.uiService.showDebugInformations$,this.selectedTab=new a.a(0),this.uiService.Set(e=>{e.Footer.Button1.Disabled=!0,e.Footer.Button2.Disabled=!0,e.Footer.Button1.OnClick=()=>{this.save()},e.Footer.Button2.Text="Reset",e.Footer.Button2.OnClick=()=>{this.form.reset(this.BaseRule)},e.Footer.Show=!0}),this.form=this.fb.group({Id:[null],Name:[null,k.q.required],Scheme:[],Hostname:[],Path:[],Actions:[[]],HttpMethods:[[]],Order:[],Enabled:[!1]})}ngOnInit(){this.form.get("Name").valueChanges.subscribe(e=>this.uiService.Set(t=>t.Header.SubTitle=e)),this.form.valueChanges.subscribe(e=>{this.form.valid?this.SetButtonStatus(e):this.uiService.Set(e=>{e.Footer.Button1.Disabled=!0,e.Footer.Button1.Text="Form not valid!"})})}GeneratePatchDocument(e,t){return t=null!=t?t:this.form.value,(e=null!=e?e:this.BaseRule).Permissions=null,t.Permissions=null,Object(Oe.a)(e,t)}save(){var e,t=this.form.value;null===(e=t.Actions)||void 0===e||e.forEach(e=>{var t,n=/^(\-|\+)?([0-9]+|Infinity)$/.test(t=e.Id)?Number(t):NaN;Number.isNaN(n)||(e.Id=null)}),console.log(t),this.rulesService.Update(this.Id,t).pipe(Object(l.a)(()=>{this.BaseRule=this.form.value,this.SetButtonStatus(this.BaseRule)})).subscribe()}SetButtonStatus(e){var t=this.GeneratePatchDocument(this.BaseRule,e);this.uiService.Set(t.length>0?e=>{e.Footer.Button1.Disabled=!1,e.Footer.Button1.Text="Save Changes",e.Footer.Button2.Disabled=!1}:e=>{e.Footer.Button1.Disabled=!0,e.Footer.Button1.Text="No Changes",e.Footer.Button2.Disabled=!0})}tabChanged(e){var t;this.selectedTab.next(null!==(t=e.index)&&void 0!==t?t:0)}isNotSelected(e){return-1===this.form.value.HttpMethods.indexOf(e)}set BaseRule(e){this._baseRule=JSON.parse(JSON.stringify(e))}get BaseRule(){return this._baseRule}}return e.\u0275fac=function(t){return new(t||e)(c.Nb(r.a),c.Nb(o.a),c.Nb(T),c.Nb(k.e))},e.\u0275cmp=c.Hb({type:e,selectors:[["endpoint-rule-details"]],decls:2,vars:3,consts:[[4,"ngIf"],["nz-form","",2,"flex-grow","1","display","flex","flex-direction","column","overflow","hidden",3,"formGroup"],[3,"nzAnimated","nzSelectChange"],[3,"nzTitle"],["BasicTitle",""],[2,"display","flex","flex-direction","row","padding","3px"],[2,"flex-grow","1"],["nzRequired","","nzFor","Name"],["nz-input","","formControlName","Name","id","Name",2,"width","100%"],["nzRequired","","nzFor","Path"],["nz-input","","formControlName","Path","id","Path",2,"width","100%"],["nzFor","Hostname"],["nz-input","","formControlName","Hostname","id","Hostname","placeHolder","*",2,"width","100%"],[2,"width","10px","margin-right","10px"],[2,"width","30%"],["nzAccordion","",3,"nzBordered"],["nzHeader","Options",3,"nzActive"],["nz-checkbox","","formControlName","Enabled"],["nzHeader","Schemes"],["nzMode","multiple","nzPlaceHolder","all Schemes allowed","formControlName","Scheme","nzMode","tags",2,"width","100%"],["nzLabel","Http","nzValue","http"],["nzLabel","Https","nzValue","https"],["nzHeader","Http Methods"],["nzMode","multiple","nzPlaceHolder","all Methods allowed","formControlName","HttpMethods","nzMode","tags",2,"width","100%",3,"nzTokenSeparators"],["nzLabel","Get","nzValue","Get"],["nzLabel","Post","nzValue","Post"],["nzLabel","Put","nzValue","Put"],["nzLabel","Delete","nzValue","Delete"],["nzLabel","Patch","nzValue","Patch"],["ActionsTitle",""],["formControlName","Actions"],[3,"nzTitle",4,"ngIf"],["nz-icon","","nzType","container"],["nz-icon","","nzType","ordered-list"],["DebugTitle",""],[2,"height","100%"],["nz-icon","","nzType","bug"]],template:function(e,t){1&e&&(c.Dc(0,st,45,14,"ng-container",0),c.fc(1,"async")),2&e&&c.lc("ngIf",c.gc(1,1,t.rule$))},directives:[i.o,k.r,k.n,F.b,k.h,ve.c,ve.a,N.a,F.d,F.a,H.b,k.d,k.m,k.g,xe.a,xe.c,B.a,Q.b,Q.a,Ye,R.a,Pe.a],pipes:[i.b,i.i],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1;overflow:hidden}"]}),e})()}];let at=(()=>{class e{}return e.\u0275mod=c.Lb({type:e}),e.\u0275inj=c.Kb({factory:function(t){return new(t||e)},imports:[[o.l.forChild(lt)],o.l]}),e})();var dt=n("YPwk");let ut=(()=>{class e{}return e.\u0275mod=c.Lb({type:e}),e.\u0275inj=c.Kb({factory:function(t){return new(t||e)},imports:[[i.c,k.p,at,u.d,dt.a]]}),e})()}}]);