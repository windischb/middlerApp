(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{Rvt0:function(e,t,n){"use strict";n.r(t),n.d(t,"EndpointRulesModule",function(){return kt});var i=n("ofXK"),o=n("tyNb"),r=n("fXoL"),c=n("mElL");class s{}var l=n("vkgz"),a=n("2Vo4");class d{constructor(e){this.Item=e,this._showDetails=!1,this.ShowDetailsSubject$=new a.a(!1),this.ShowDetails$=this.ShowDetailsSubject$.asObservable()}set ShowDetails(e){this._showDetails=e,this.ShowDetailsSubject$.next(this._showDetails)}get ShowDetails(){return this._showDetails}}var u=n("5+WD");class b{constructor(){this.AllItems=[],this.Selected=[]}get Single(){var e;return 1===(null===(e=this.Selected)||void 0===e?void 0:e.length)?this.Selected[0]:null}get IsFirst(){return this.Single?this.AllItems[0].Id===this.Single.Id:null}get IsLast(){return this.Single?this.AllItems[this.AllItems.length-1].Id===this.Single.Id:null}}var h=n("tk/3"),p=n("lJxs"),g=n("IzEk"),m=n("jfkr"),f=n("mrSG"),v=n("4ZtF");let x=(()=>{let e=class extends v.a{constructor(){super()}};return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=r.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),e=Object(f.a)([Object(v.e)({name:"endpoint-rules",idKey:"Id"})],e),e})(),C=(()=>{class e extends v.c{constructor(e){super(e),this.store=e}}return e.\u0275fac=function(t){return new(t||e)(r.Zb(x))},e.\u0275prov=r.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var O=n("LgUO");let z=(()=>{class e{constructor(e,t,n,i,o){this.http=e,this.message=t,this.endpointRulesStore=n,this.endpointRulesQuery=i,this.auth=o,this.RulesOrder={},this.typings$=new a.a([]),this.imports$=new a.a([]),this.Subscribe(),this.message.RunOnEveryReconnect(()=>this.GetAllRules().subscribe()),this.message.RunOnEveryReconnect(()=>this.GetTypings()),this.message.RunOnEveryReconnect(()=>this.GetImports())}getHeaders(e=!1){return new h.e(e?{Authorization:"Bearer "+this.auth.getAccessToken(),"Content-Type":"application/json-patch+json",Accept:"application/json"}:{Authorization:"Bearer "+this.auth.getAccessToken()})}Subscribe(){this.message.Stream("MiddlerRule.Subscribe").pipe(Object(l.a)(e=>{switch(e.Action){case"Created":this.endpointRulesStore.add(e.Payload);break;case"Updated":if(e.MetaData.UpdateOrder){var t=e.Payload;Object.keys(t).forEach(e=>{this.endpointRulesStore.update(e,{Order:t[e]})})}else this.endpointRulesStore.update(e.Payload.Id,t=>e.Payload);break;case"Deleted":this.endpointRulesStore.update(e.Payload,e=>Object.assign(Object.assign({},e),{Deleted:!0})),this.endpointRulesStore.remove(e.Payload)}})).subscribe()}ReLoadRules(){this.http.get("/api/endpoint-rules",{headers:this.getHeaders()}).pipe(Object(l.a)(e=>this.endpointRulesStore.set(e))).subscribe()}GetAllRules(e){return!e&&this.endpointRulesQuery.getHasCache()||this.ReLoadRules(),this.endpointRulesQuery.selectAll().pipe(Object(p.a)(e=>e.sort(this.SortRules)))}GetRule(e){return this.http.get(`/api/endpoint-rules/${e}`,{headers:this.getHeaders()})}Add(e){return this.http.post("/api/endpoint-rules",e,{headers:this.getHeaders()})}Remove(e){return this.http.delete(`/api/endpoint-rules/${e}`,{headers:this.getHeaders()})}Update(e,t){return this.http.put(`/api/endpoint-rules/${e}`,t,{headers:this.getHeaders()})}UpdateAction(e){return this.http.put(`/api/endpoint-action/${e.Id}`,e,{headers:this.getHeaders()})}SortRules(e,t){return e.Order>t.Order?1:e.Order<t.Order?-1:0}GetNextLastOrder(){const e=this.endpointRulesQuery.getAll();return e&&0!==e.length?Math.trunc(Math.max(...e.map(e=>e.Order))+10):10}UpdateRuleOrder(e,t){var n={};n[e.Id]=t,this.http.post("/api/endpoint-rules/order",n,{headers:this.getHeaders(!0)}).subscribe()}SetRuleEnabled(e,t){this.http.put(`/api/endpoint-rules/${e.Id}/enabled/${t}`,null,{headers:this.getHeaders(!0)}).subscribe()}GetTypings(){this.http.get("api/endpoint-rules/type-definitions",{headers:this.getHeaders()}).pipe(Object(g.a)(1),Object(l.a)(e=>{var t=e.map(e=>new m.b(e.Key,e.Value,!1));this.typings$.next(t)})).subscribe()}GetImports(){this.http.get("api/endpoint-rules/import-definitions",{headers:this.getHeaders()}).pipe(Object(g.a)(1),Object(l.a)(e=>{var t=e.map(e=>new m.b(e.Key,e.Value,!1));this.imports$.next(t)})).subscribe()}}return e.\u0275fac=function(t){return new(t||e)(r.Zb(h.c),r.Zb(c.d),r.Zb(x),r.Zb(C),r.Zb(O.b))},e.\u0275prov=r.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var w=n("h0m+");class S{constructor(){this.Enabled=!0}}class y{constructor(){this.RewriteTo=""}}class M extends S{constructor(){super(...arguments),this.ActionType="UrlRewrite",this.Parameters=new y,this.Terminating=!1}}var P=n("3Pt+"),I=n("t7qs"),U=n("OzZK"),k=n("RwU8"),V=n("C2AL"),R=n("Nqz0"),T=n("FwiY"),A=n("Q8cG");function H(e,t){1&e&&(r.Vb(0,"div"),r.Hc(1,"Action"),r.Ub())}const _=["*"];let B=(()=>{class e{constructor(){this.ok=new r.n,this.save=new r.n,this.cancel=new r.n,this.ctrls=!1}keydown(e){e.stopPropagation();const t=String.fromCharCode(e.which).toLowerCase();e.ctrlKey&&"s"===t&&(e.preventDefault(),this.ctrls||(this.ctrls=!0,this.save.next()))}keyup(e){e.stopPropagation();const t=String.fromCharCode(e.which).toLowerCase();e.ctrlKey&&"s"===t&&(e.preventDefault(),this.ctrls=!1)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Jb({type:e,selectors:[["action-basic-modal"]],hostAttrs:[1,"flex-grow-column","action-basic-modal"],hostBindings:function(e,t){1&e&&r.dc("keydown",function(e){return t.keydown(e)},!1,r.xc)("keyup",function(e){return t.keyup(e)},!1,r.xc)},inputs:{form:"form"},outputs:{ok:"ok",save:"save",cancel:"cancel"},ngContentSelectors:_,decls:25,vars:4,consts:[[1,"modal-header",2,"padding","10px !important","display","flex","margin-bottom","1px"],[2,"font-size","2em","font-weight","bold","line-height","1.4285em","color","whitesmoke","margin","auto"],["dbPortal","ActionModalHeader-Left",1,"Irgendwos"],["left","dbPortal"],[4,"ngIf"],[2,"flex-grow","1"],["dbPortal","ActionModalHeader-Right"],[1,"modal-content"],[1,"modal-footer",2,"margin-bottom","0px","margin-top","1px","background","#292f3b","padding","2px"],["nz-button","","nzType","default",1,"secondary",3,"click"],["nz-button","","nzType","primary",3,"disabled","click"],["nz-button","","nzType","primary","nz-dropdown","",3,"nzDropdownMenu","disabled"],["nz-icon","","nzType","ellipsis"],["menu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"click"]],template:function(e,t){if(1&e&&(r.mc(),r.Vb(0,"div",0),r.Vb(1,"div",1),r.Rb(2,2,3),r.Fc(4,H,2,0,"div",4),r.Ub(),r.Qb(5,"div",5),r.Vb(6,"div"),r.Rb(7,6),r.Ub(),r.Ub(),r.Vb(8,"div",7),r.lc(9),r.Ub(),r.Vb(10,"div",8),r.Vb(11,"button",9),r.dc("click",function(){return t.cancel.next()}),r.Hc(12,"Cancel"),r.Ub(),r.Qb(13,"div",5),r.Vb(14,"nz-button-group"),r.Vb(15,"button",10),r.dc("click",function(){return t.ok.next()}),r.Hc(16,"Submit & Close"),r.Ub(),r.Vb(17,"button",11),r.Qb(18,"i",12),r.Ub(),r.Ub(),r.Ub(),r.Vb(19,"nz-dropdown-menu",null,13),r.Vb(21,"ul",14),r.Vb(22,"li",15),r.dc("click",function(){return t.save.next()}),r.Vb(23,"a"),r.Hc(24,"Save Action without close"),r.Ub(),r.Ub(),r.Ub(),r.Ub()),2&e){const e=r.vc(3),n=r.vc(20);r.Bb(4),r.nc("ngIf",!e.hasSource),r.Bb(11),r.nc("disabled",!t.form.valid),r.Bb(2),r.nc("nzDropdownMenu",n)("disabled",!t.form.valid)}},directives:[I.d,i.o,U.a,k.a,V.a,U.b,R.d,R.b,T.a,R.e,A.c,A.e],styles:["[_nghost-%COMP%]{box-shadow:0 0 1px 2px #dedddd;max-width:100%;max-height:100%;background-color:#dedddd}",".modal-header[_ngcontent-%COMP%]{background-color:#292f3b!important}.modal-header[_ngcontent-%COMP%], .modal-header[_ngcontent-%COMP%]   .ui.huge.header[_ngcontent-%COMP%]{color:#fff!important}.modal-content[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]{border:none!important;display:flex}.modal-content[_ngcontent-%COMP%]{flex-grow:1;max-width:100%;max-height:100%}.flex-grow-column[_ngcontent-%COMP%], .modal-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], action-basic-modal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], action-basic-modal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   ng-component[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column}action-basic-modal[_ngcontent-%COMP%]   div[name][_ngcontent-%COMP%]{min-height:1.28571429em}.action-basic-modal[_ngcontent-%COMP%]{box-shadow:0 0 3px 1px #bfbfbf!important}"]}),e})();var F=n("ocnv"),D=n("B+r4"),G=n("PTRe");function Q(e,t){1&e&&r.Hc(0," Url - Rewrite ")}let L=(()=>{class e{constructor(e,t){this.fb=e,this.context=t}ngOnInit(){this.form=this.fb.group({RewriteTo:[]}),this.form.patchValue(this.context.data.Parameters)}ok(){this.context.invoke("OK",this.form.value)}cancel(){this.context.handle.Close()}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(P.e),r.Pb(w.d))},e.\u0275cmp=r.Jb({type:e,selectors:[["ng-component"]],decls:7,vars:2,consts:[[3,"form","ok","cancel"],["nz-form","",2,"width","100%",3,"formGroup"],["nzRequired","","nzFor","RewriteTo"],["nz-input","","formControlName","RewriteTo","id","RewriteTo",2,"width","100%"],["dbPortalTemplate","ActionModalHeader-Left"]],template:function(e,t){1&e&&(r.Vb(0,"action-basic-modal",0),r.dc("ok",function(){return t.ok()})("cancel",function(){return t.cancel()}),r.Vb(1,"form",1),r.Vb(2,"nz-form-label",2),r.Hc(3,"RewriteTo"),r.Ub(),r.Vb(4,"nz-form-control"),r.Qb(5,"input",3),r.Ub(),r.Fc(6,Q,1,0,"ng-template",4),r.Ub(),r.Ub()),2&e&&(r.nc("form",t.form),r.Bb(1),r.nc("formGroup",t.form))},directives:[B,P.r,P.n,F.b,P.h,D.a,F.d,F.a,G.b,P.d,P.m,P.g,I.e],styles:[""]}),e})();class N{constructor(){this.RedirectTo="",this.Permanent=!1,this.PreserveMethod=!0}}class E extends S{constructor(){super(...arguments),this.ActionType="UrlRedirect",this.Parameters=new N,this.Terminating=!0}}var j=n("TaO5");function W(e,t){1&e&&r.Hc(0," Url - Redirect ")}let J=(()=>{class e{constructor(e,t){this.fb=e,this.context=t}ngOnInit(){this.form=this.fb.group({RedirectTo:[],Permanent:[],PreserveMethod:[]}),this.form.patchValue(this.context.data.Parameters)}ok(){this.context.invoke("OK",this.form.value)}cancel(){this.context.handle.Close()}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(P.e),r.Pb(w.d))},e.\u0275cmp=r.Jb({type:e,selectors:[["ng-component"]],decls:14,vars:2,consts:[[3,"form","ok","cancel"],["nz-form","",2,"width","100%",3,"formGroup"],["nzRequired","","nzFor","RedirectTo"],["nz-input","","formControlName","RedirectTo","id","RedirectTo",2,"width","100%"],[2,"display","flex","flex-direction","row"],[1,"field"],["nz-checkbox","","formControlName","PreserveMethod"],["nz-checkbox","","formControlName","Permanent"],["dbPortalTemplate","ActionModalHeader-Left"]],template:function(e,t){1&e&&(r.Vb(0,"action-basic-modal",0),r.dc("ok",function(){return t.ok()})("cancel",function(){return t.cancel()}),r.Vb(1,"form",1),r.Vb(2,"nz-form-label",2),r.Hc(3,"RedirectTo"),r.Ub(),r.Vb(4,"nz-form-control"),r.Qb(5,"input",3),r.Ub(),r.Vb(6,"div",4),r.Vb(7,"div",5),r.Vb(8,"label",6),r.Hc(9,"PreserveMethod"),r.Ub(),r.Ub(),r.Vb(10,"div",5),r.Vb(11,"label",7),r.Hc(12,"Permanent"),r.Ub(),r.Ub(),r.Ub(),r.Fc(13,W,1,0,"ng-template",8),r.Ub(),r.Ub()),2&e&&(r.nc("form",t.form),r.Bb(1),r.nc("formGroup",t.form))},directives:[B,P.r,P.n,F.b,P.h,D.a,F.d,F.a,G.b,P.d,P.m,P.g,j.a,I.e],styles:[".field[_ngcontent-%COMP%]{padding-top:5px}"]}),e})();class K{constructor(){this.Language="TypeScript"}}class q extends S{constructor(){super(...arguments),this.ActionType="Script",this.Parameters=new K,this.Terminating=!0}}var Z=n("zAKX");function X(e,t){1&e&&r.Hc(0," Script ")}function Y(e,t){1&e&&(r.Vb(0,"div",6),r.Vb(1,"div",7),r.Vb(2,"nz-select",8),r.Qb(3,"nz-option",9),r.Qb(4,"nz-option",10),r.Qb(5,"nz-option",11),r.Ub(),r.Ub(),r.Ub())}const ee=function(){return{noLib:!0}};let te=(()=>{class e{constructor(e,t,n){this.fb=e,this.context=t,this.rulesService=n,this.typings$=this.rulesService.typings$.pipe(Object(l.a)(e=>console.log(e))),this.imports$=this.rulesService.imports$.pipe(Object(l.a)(e=>console.log(e)))}ngOnInit(){this.form=this.fb.group({Language:[],SourceCode:[]}),this.context.data.Parameters.Language||(this.context.data.Parameters.Language="TypeScript"),this.form.patchValue(this.context.data.Parameters)}initRestrictionsAccordion(e){$(e.nativeElement).accordion()}ok(){this.context.invoke("OK",this.form.value)}save(){console.log("save modal"),this.context.invoke("Save",this.form.value)}cancel(){this.context.handle.Close()}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(P.e),r.Pb(w.d),r.Pb(z))},e.\u0275cmp=r.Jb({type:e,selectors:[["ng-component"]],decls:8,vars:11,consts:[[3,"form","ok","cancel","save"],["nz-form","",1,"flex-grow-column",2,"width","100%",3,"formGroup"],[1,"field","flex-grow-column"],["formControlName","SourceCode",2,"max-width","100%","max-height","100%","position","relative",3,"language","typings","files","tsOptions"],["dbPortalTemplate","ActionModalHeader-Left"],["dbPortalTemplate","ActionModalHeader-Right"],[1,"fields"],[2,"width","180px"],["formControlName","Language",2,"width","100%"],["nzLabel","TypeScript","nzValue","TypeScript"],["nzLabel","JavaScript","nzValue","JavaScript"],["nzLabel","PowerShellCore","nzValue","PowerShellCore"]],template:function(e,t){1&e&&(r.Vb(0,"action-basic-modal",0),r.dc("ok",function(){return t.ok()})("cancel",function(){return t.cancel()})("save",function(){return t.save()}),r.Vb(1,"form",1),r.Vb(2,"div",2),r.Qb(3,"db-editor",3),r.hc(4,"async"),r.hc(5,"async"),r.Ub(),r.Fc(6,X,1,0,"ng-template",4),r.Fc(7,Y,6,0,"ng-template",5),r.Ub(),r.Ub()),2&e&&(r.nc("form",t.form),r.Bb(1),r.nc("formGroup",t.form),r.Bb(2),r.nc("language",t.form.value.Language)("typings",r.ic(4,6,t.typings$))("files",r.ic(5,8,t.imports$))("tsOptions",r.pc(10,ee)))},directives:[B,P.r,P.n,F.b,P.h,m.a,P.m,P.g,I.e,Z.b,Z.a],pipes:[i.b],styles:[""]}),e})(),ne=(()=>{class e{constructor(e,t){this.modal=e,this.componentFactoryResolver=t}GetIcon(e){switch(e.ActionType){case"UrlRedirect":return"rollback";case"UrlRewrite":return"edit";case"Proxy":return"fa#random";case"Script":return"code"}return"hat wizard"}GetModal(e){switch(e.toLowerCase()){case"urlredirect":return this.modal.FromComponent(J).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"50%",maxWidth:"500px"}}).CloseOnOutsideClick();case"urlrewrite":return this.modal.FromComponent(L).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"50%",maxWidth:"500px"}}).CloseOnOutsideClick();case"script":return this.modal.FromComponent(te).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"80%",height:"90%"}}).CloseOnOutsideClick()}}}return e.\u0275fac=function(t){return new(t||e)(r.Zb(w.b),r.Zb(r.j))},e.\u0275prov=r.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var ie=n("gPmL"),oe=n("nJia");const re=["contextMenu"],ce=["addRuleTemplate"];function se(e,t){1&e&&(r.Vb(0,"div",8),r.Vb(1,"div",9),r.Hc(2,"Currently there is nothing..."),r.Ub(),r.Vb(3,"p"),r.Hc(4,"Use the ContextMenu to create your first rule!"),r.Ub(),r.Ub())}function le(e,t){if(1&e&&(r.Vb(0,"span",21),r.Qb(1,"db-icon",22),r.Ub()),2&e){const e=t.$implicit,n=r.gc(2);r.nc("nzTooltipTitle",e.ActionType),r.Bb(1),r.nc("icon",n.GetIcon(e))}}function ae(e,t){1&e&&r.Qb(0,"div",23)}function de(e,t){if(1&e){const e=r.Wb();r.Vb(0,"div",10),r.dc("click",function(n){r.yc(e);const i=t.$implicit;return r.gc().clickAction(n,i)})("contextmenu",function(n){r.yc(e);const i=t.$implicit,o=r.gc(),c=r.vc(11);return o.openItemContextMenu(n,c,i)})("dblclick",function(){r.yc(e);const n=t.$implicit;return r.gc().editRule(n.Item.Id)}),r.Vb(1,"div",11),r.Vb(2,"div",12),r.Qb(3,"db-icon",13),r.Ub(),r.Vb(4,"div",14),r.Vb(5,"div",15),r.Hc(6),r.Ub(),r.Vb(7,"div"),r.Hc(8),r.Ub(),r.Ub(),r.Vb(9,"div",16),r.Vb(10,"div"),r.Hc(11),r.Ub(),r.Vb(12,"div"),r.Hc(13),r.Ub(),r.Ub(),r.Vb(14,"div",17),r.Vb(15,"div",18),r.Vb(16,"div"),r.Hc(17),r.Ub(),r.Fc(18,le,2,2,"span",19),r.Ub(),r.Fc(19,ae,1,0,"div",20),r.Ub(),r.Ub(),r.Ub()}if(2&e){const e=t.$implicit,n=r.gc();r.Hb("selected",e.Selected)("disabled",!e.Item.Enabled),r.Bb(6),r.Ic(e.Item.Name),r.Bb(2),r.Ic(e.Item.Path),r.Bb(3),r.Ic(e.Item.Scheme),r.Bb(2),r.Ic(e.Item.Hostname),r.Bb(4),r.Jc(" ",(null==e.Item.Actions?null:e.Item.Actions.length)||0," Actions "),r.Bb(1),r.nc("ngForOf",e.Item.Actions),r.Bb(1),r.nc("ngIf",n.IsRuleTerminating(e.Item))}}function ue(e,t){if(1&e){const e=r.Wb();r.Vb(0,"ul",24),r.Vb(1,"li",25),r.Vb(2,"ul",26),r.Vb(3,"li",27),r.dc("click",function(){return r.yc(e),r.gc().CreateRuleOnTop()}),r.Qb(4,"db-icon",28),r.Hc(5," Top "),r.Ub(),r.Vb(6,"li",27),r.dc("click",function(){return r.yc(e),r.gc().CreateRuleOnBottom()}),r.Qb(7,"db-icon",29),r.Hc(8," Bottom "),r.Ub(),r.Ub(),r.Ub(),r.Ub()}}function be(e,t){if(1&e){const e=r.Wb();r.Vb(0,"li",27),r.dc("click",function(){r.yc(e);const t=r.gc().$implicit;return r.gc().SetRuleEnabled(t.Single,!0)}),r.Qb(1,"db-icon",34),r.Hc(2," Enable "),r.Ub()}}function he(e,t){if(1&e){const e=r.Wb();r.Vb(0,"li",27),r.dc("click",function(){r.yc(e);const t=r.gc().$implicit;return r.gc().SetRuleEnabled(t.Single,!1)}),r.Qb(1,"db-icon",35),r.Hc(2," Disable "),r.Ub()}}function pe(e,t){if(1&e){const e=r.Wb();r.Vb(0,"li",25),r.Vb(1,"ul",26),r.Vb(2,"li",27),r.dc("click",function(){return r.yc(e),r.gc(2).CreateRuleOnTop()}),r.Qb(3,"db-icon",28),r.Hc(4," Top "),r.Ub(),r.Vb(5,"li",27),r.dc("click",function(){r.yc(e);const t=r.gc().$implicit;return r.gc().CreateRuleBefore(t.Single)}),r.Qb(6,"db-icon",36),r.Hc(7," Before "),r.Ub(),r.Vb(8,"li",27),r.dc("click",function(){r.yc(e);const t=r.gc().$implicit;return r.gc().CreateRuleAfter(t.Single)}),r.Qb(9,"db-icon",37),r.Hc(10," After "),r.Ub(),r.Vb(11,"li",27),r.dc("click",function(){return r.yc(e),r.gc(2).CreateRuleOnBottom()}),r.Qb(12,"db-icon",29),r.Hc(13," Bottom "),r.Ub(),r.Ub(),r.Ub()}}function ge(e,t){if(1&e){const e=r.Wb();r.Vb(0,"ul",24),r.Fc(1,be,3,0,"li",30),r.Fc(2,he,3,0,"li",30),r.Fc(3,pe,14,0,"li",31),r.Qb(4,"li",32),r.Vb(5,"li",27),r.dc("click",function(){r.yc(e);const n=t.$implicit;return r.gc().RemoveRules(n.Selected)}),r.Qb(6,"db-icon",33),r.Hc(7," Remove "),r.Ub(),r.Ub()}if(2&e){const e=t.$implicit;r.Bb(1),r.nc("ngIf",!1===(null==e.Single?null:e.Single.Enabled)),r.Bb(1),r.nc("ngIf",!0===(null==e.Single?null:e.Single.Enabled)),r.Bb(1),r.nc("ngIf",e.Single)}}const me=function(){return[]};let fe=(()=>{class e{constructor(e,t,n,i,o,c,s,l){this.rulesService=e,this.cref=t,this.overlay=n,this.viewContainerRef=i,this.router=o,this.route=c,this.actionHelper=s,this.endpointRulesQuery=l,this._rules=[],this.rulesSubject$=new a.a(this._rules),this.rules$=this.rulesSubject$.asObservable(),this.rulesChanged=new r.n,this.selected=[],this.registered=[],this.onTouched=()=>{}}set rules(e){this._rules=(e||[]).map(e=>{const t=this._rules.find(t=>t.Item.Id===e.Id);return t?(t.Item=e,t):new d(e)}),this.rulesSubject$.next(this._rules)}get rules(){return this._rules.map(e=>e.Item)}ngOnInit(){this.rulesService.GetAllRules().pipe(Object(l.a)(e=>{this.rules=e})).subscribe()}ngAfterViewInit(){}clickAction(e,t){e.ctrlKey?t.Selected=!t.Selected:this._rules=this._rules.map(e=>(e.Selected=e==t,e))}openOuterContextMenu(e,t){var n;e.stopPropagation(),null===(n=this.ContextMenu)||void 0===n||n.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,null)}openItemContextMenu(e,t,n){var i;e.stopPropagation();const o=this._rules.filter(e=>e.Selected);0!=o.length&&o.includes(n)||(this._rules=this._rules.map(e=>(e.Selected=e==n,e))),null===(i=this.ContextMenu)||void 0===i||i.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,this.BuildContext())}DeSelectAll(){console.log("Deselect"),this._rules=this._rules.map(e=>(e.Selected=!1,e))}SetRuleEnabled(e,t){var n;null===(n=this.ContextMenu)||void 0===n||n.Close(),this.rulesService.SetRuleEnabled(e,t)}GetActionByIndex(e){return this.rules[e]}GetActionById(e){return this.rules.find(t=>t.Id===e)}ClearSelection(){this.selected=[],this.cref.markForCheck()}BuildContext(){const e=new b;return e.AllItems=this.rules,e.Selected=this._rules.filter(e=>e.Selected).map(e=>e.Item),e}IsRuleTerminating(e){return!!e.Actions&&-1!=e.Actions.findIndex(e=>e.Enabled&&e.Terminating)}initContextMenu(e){}CreateRuleOnTop(){let e=new s;e.Enabled=!1,e.Order=this.rules&&0!=this.rules.length?this.rules[0].Order/2:10,this.rulesService.Add(e).subscribe(),this.ContextMenu.Close()}CreateRuleBefore(e){const t=this.rules.findIndex(t=>t.Order===e.Order);let n=new s;n.Enabled=!1,n.Order=0==t?e.Order/2:e.Order-(e.Order-this.rules[t-1].Order)/2,console.log(n),this.rulesService.Add(n).subscribe(),this.ContextMenu.Close()}CreateRuleAfter(e){const t=this.rules.findIndex(t=>t.Order===e.Order);let n=new s;n.Enabled=!1,n.Order=t==this.rules.length-1?this.rulesService.GetNextLastOrder():e.Order+(this.rules[t+1].Order-e.Order)/2,console.log(n),this.rulesService.Add(n).subscribe(),this.ContextMenu.Close()}CreateRuleOnBottom(){let e=new s;e.Enabled=!1,e.Order=this.rulesService.GetNextLastOrder(),this.rulesService.Add(e).subscribe(),this.ContextMenu.Close()}RemoveRules(e){e.forEach(e=>this.rulesService.Remove(e.Id).subscribe()),this.ContextMenu.Close()}editRule(e){this.router.navigate([e],{relativeTo:this.route})}calculateRuleOrder(e){if(0===this.rules.length)return 10;if(0===e)return this.rules[0].Order/2;if(e>=this.rules.length)return this.rulesService.GetNextLastOrder();const t=this.rules[e-1].Order;return(this.rules[e].Order-t)/2+t}drop(e){if(e.previousContainer===e.container){const t=this.endpointRulesQuery.getAll().sort(this.rulesService.SortRules),n=t[e.previousIndex];let i=null;if(e.previousIndex<e.currentIndex?i="forward":e.previousIndex>e.currentIndex&&(i="back"),!i)return;if("forward"===i)if(e.currentIndex===t.length-1)this.rulesService.UpdateRuleOrder(n,this.rulesService.GetNextLastOrder());else{const i=t[e.currentIndex];this.rulesService.UpdateRuleOrder(n,(t[e.currentIndex+1].Order-i.Order)/2+i.Order)}else if("back"===i)if(0===e.currentIndex)this.rulesService.UpdateRuleOrder(n,t[0].Order/2);else{const i=t[e.currentIndex-1];this.rulesService.UpdateRuleOrder(n,(t[e.currentIndex].Order-i.Order)/2+i.Order)}Object(u.e)(t,e.previousIndex,e.currentIndex)}else{let t=new s;t.Enabled=!1,console.log(e),t.Order=this.calculateRuleOrder(e.currentIndex),this.rulesService.Add(t).subscribe()}}GetIcon(e){return this.actionHelper.GetIcon(e)}prepareIcon(e){if(!e)return null;if(e.startsWith("fa#")){let t={type:"fa",icon:null};return e=e.substring(3),t.icon=e.includes("|")?e.split("|"):e,t}return{type:"ant",icon:e}}propagateChange(e){this.rulesChanged.next(e),this.registered.forEach(t=>{t(e)})}writeValue(e){this.rules=e}registerOnChange(e){-1===this.registered.indexOf(e)&&this.registered.push(e)}registerOnTouched(e){this.onTouched=e}setDisabledState(e){throw new Error("Method not implemented.")}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(z),r.Pb(r.h),r.Pb(w.c),r.Pb(r.Q),r.Pb(o.i),r.Pb(o.a),r.Pb(ne),r.Pb(C))},e.\u0275cmp=r.Jb({type:e,selectors:[["enpoint-rules-list"]],viewQuery:function(e,t){if(1&e&&(r.Lc(re,1),r.Lc(ce,1)),2&e){let e;r.uc(e=r.ec())&&(t.contextMenu=e.first),r.uc(e=r.ec())&&(t.addRuleTemplate=e.first)}},inputs:{rules:"rules"},outputs:{rulesChanged:"rulesChanged"},decls:12,vars:7,consts:[["cdkDropList","",1,"outer",2,"flex-grow","1","height","100%",3,"contextmenu"],["nullList","cdkDropList"],["cdkDropList","",1,"",2,"padding","2px","margin-top","8px","max-height","calc(100% - 30px)","overflow-y","auto",3,"cdkDropListDropped"],["rulesList","cdkDropList"],["style","text-align: center; font-size: 1.3em; font-weight: bold; color: #525e7678; line-height: 1.4em; line-height: 2em; margin: 0px 10px;",4,"ngIf"],["class","rule-item","cdkDrag","","cdkDragLockAxis","y",3,"selected","disabled","click","contextmenu","dblclick",4,"ngFor","ngForOf"],["outerContextMenu",""],["itemContextMenu",""],[2,"text-align","center","font-size","1.3em","font-weight","bold","color","#525e7678","line-height","1.4em","line-height","2em","margin","0px 10px"],[2,"font-size","1.5em"],["cdkDrag","","cdkDragLockAxis","y",1,"rule-item",3,"click","contextmenu","dblclick"],[2,"display","flex","min-height","60px"],["cdkDragHandle","",1,"dragHandle",2,"padding","10px 0px 0px 5px"],["icon","fa#ellipsis-v",2,"width","1.18em","margin","0 .25rem 0 0","font-size","1.2em"],[2,"padding","5px","flex-grow","1"],[2,"font-size","large","font-weight","bold","color","#292f3b"],[2,"padding","5px","min-width","200px","max-width","200px"],[2,"min-width","200px","max-width","200px","display","flex"],[2,"flex-grow","1","padding","5px"],["nz-tooltip","",3,"nzTooltipTitle",4,"ngFor","ngForOf"],["class","terminate-indicator","nz-tooltip","","nzTooltipTitle","Stop processing further Rules",4,"ngIf"],["nz-tooltip","",3,"nzTooltipTitle"],[3,"icon"],["nz-tooltip","","nzTooltipTitle","Stop processing further Rules",1,"terminate-indicator"],["nz-menu","","nzMode","vertical",1,"context-menu"],["nz-submenu","","nzTitle","Add Rule","nzIcon","menu-unfold"],[1,"context-menu"],["nz-menu-item","",3,"click"],["icon","double-left","rotate","90"],["icon","double-right","rotate","90"],["nz-menu-item","",3,"click",4,"ngIf"],["nz-submenu","","nzTitle","Add Rule","nzIcon","menu-unfold",4,"ngIf"],["nz-menu-divider",""],["icon","delete"],["icon","fa#toggle-on"],["icon","fa#toggle-off"],["icon","up"],["icon","down"]],template:function(e,t){if(1&e){const e=r.Wb();r.Vb(0,"div",0,1),r.dc("contextmenu",function(n){r.yc(e);const i=r.vc(9);return t.openOuterContextMenu(n,i)}),r.Vb(2,"div",2,3),r.dc("cdkDropListDropped",function(e){return t.drop(e)}),r.Fc(4,se,5,0,"div",4),r.hc(5,"async"),r.Fc(6,de,20,11,"div",5),r.hc(7,"async"),r.Ub(),r.Ub(),r.Fc(8,ue,9,0,"ng-template",null,6,r.Gc),r.Fc(10,ge,8,3,"ng-template",null,7,r.Gc)}2&e&&(r.Bb(4),r.nc("ngIf",0===(r.ic(5,2,t.rules$)||r.pc(6,me)).length),r.Bb(2),r.nc("ngForOf",r.ic(7,4,t.rules$)))},directives:[u.c,i.o,i.n,u.a,u.b,ie.c,oe.d,A.c,V.a,A.g,A.e,A.d],pipes:[i.b],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1}.rule-item[_ngcontent-%COMP%]{margin-bottom:10px!important;border-radius:0!important;box-shadow:0 0 3px 1px #cecece;background-color:#fff}.rule-item.disabled[_ngcontent-%COMP%]{opacity:.6;box-shadow:none;background-color:#e2e2e2}.rule-item[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{border-right:1px solid #fff}.rule-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}.rule-item.selected[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{background-color:#292f3b;color:#fff}.rule-item[_ngcontent-%COMP%]:hover{background-color:#b2b7c2}.new-rule.ui.button[_ngcontent-%COMP%]{margin:0}.options[_ngcontent-%COMP%]{background-color:grey;height:50px}.list-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{background-color:inherit!important}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:inherit}.dragHandle[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.list-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#e0e1e2}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{cursor:inherit}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:inherit}.list-item.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%], .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{border-radius:0!important;background-color:#2f2f2f;color:#f5f5f5}.outer.cdk-drop-list-dragging[_ngcontent-%COMP%] > .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{display:none}.context-menu[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{margin:0!important}.anticon.disabled[_ngcontent-%COMP%]{color:#ccc}.terminate-indicator[_ngcontent-%COMP%]{width:8px;background-color:#525e76;border-left:1px solid #fff}.action-item.disabled[_ngcontent-%COMP%]   .terminate-indicator[_ngcontent-%COMP%]{background-color:inherit}.action-item[_ngcontent-%COMP%]:hover   .terminate-indicator[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}  .ant-divider-horizontal.ant-divider-with-text-center:after,   .ant-divider-horizontal.ant-divider-with-text-center:before{border-top:1px solid #525e76!important}"],changeDetection:0}),e})(),ve=(()=>{class e{constructor(e){this.uiService=e,e.Set(e=>{e.Header.Title="Endpoint Rules",e.Content.Scrollable=!1,e.Header.Icon="fa#stream"})}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(c.a))},e.\u0275cmp=r.Jb({type:e,selectors:[["ng-component"]],decls:2,vars:0,consts:[[2,"display","flex","flex-direction","column","flex-grow","1"]],template:function(e,t){1&e&&(r.Vb(0,"div",0),r.Qb(1,"enpoint-rules-list"),r.Ub())},directives:[fe],styles:[""]}),e})();var xe=n("itXk"),Ce=n("bHdf"),Oe=n("1zMv"),ze=n("oyxB"),we=n("IvDN");const Se=["urlredirect"],ye=["urlrewrite"],Me=["script"];function Pe(e,t){if(1&e&&(r.Vb(0,"div"),r.Hc(1),r.Ub(),r.Vb(2,"div"),r.Hc(3),r.Ub(),r.Vb(4,"div"),r.Hc(5),r.Ub()),2&e){const e=r.gc();r.Bb(1),r.Jc(" Redirect to ",e.action.Parameters.RedirectTo," "),r.Bb(2),r.Jc(" Permanent: ",e.action.Parameters.Permanent," "),r.Bb(2),r.Jc(" PreserveMethod: ",e.action.Parameters.PreserveMethod," ")}}function Ie(e,t){if(1&e&&(r.Vb(0,"div"),r.Hc(1),r.Ub()),2&e){const e=r.gc();r.Bb(1),r.Jc(" Rewrite to ",e.action.Parameters.RewriteTo," ")}}function Ue(e,t){if(1&e&&(r.Vb(0,"div"),r.Hc(1),r.Ub()),2&e){const e=r.gc();r.Bb(1),r.Jc(" ",e.action.Parameters.Language," ")}}let ke=(()=>{class e{ngOnInit(){this.template=this.determineTemplate()}determineTemplate(){switch(this.action.ActionType){case"UrlRedirect":return this.UrlRedirect;case"UrlRewrite":return this.UrlRewrite;case"Script":return this.Script}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Jb({type:e,selectors:[["action-list-details"]],viewQuery:function(e,t){if(1&e&&(r.Lc(Se,3),r.Lc(ye,3),r.Lc(Me,3)),2&e){let e;r.uc(e=r.ec())&&(t.UrlRedirect=e.first),r.uc(e=r.ec())&&(t.UrlRewrite=e.first),r.uc(e=r.ec())&&(t.Script=e.first)}},inputs:{action:"action"},decls:8,vars:1,consts:[[2,"font-size","x-small"],[3,"ngTemplateOutlet"],["urlredirect",""],["urlrewrite",""],["script",""]],template:function(e,t){1&e&&(r.Vb(0,"div",0),r.Rb(1,1),r.Ub(),r.Fc(2,Pe,6,3,"ng-template",null,2,r.Gc),r.Fc(4,Ie,2,1,"ng-template",null,3,r.Gc),r.Fc(6,Ue,2,1,"ng-template",null,4,r.Gc)),2&e&&(r.Bb(1),r.nc("ngTemplateOutlet",t.template))},directives:[i.t],styles:[""]}),e})();var Ve=n("6NWb"),Re=n("5vDB");function Te(e,t){1&e&&(r.Vb(0,"div",8),r.Vb(1,"div",9),r.Hc(2,"Currently there is nothing..."),r.Ub(),r.Vb(3,"p"),r.Hc(4,"Use the ContextMenu to create your first action!"),r.Ub(),r.Ub())}function Ae(e,t){if(1&e&&r.Qb(0,"i",23),2&e){const e=r.gc().$implicit;r.nc("nzType",e.icon)}}function He(e,t){if(1&e&&r.Qb(0,"fa-icon",24),2&e){const e=r.gc().$implicit;r.nc("icon",e.icon)}}function _e(e,t){if(1&e&&(r.Vb(0,"div",20),r.Fc(1,Ae,1,1,"i",21),r.Fc(2,He,1,1,"fa-icon",22),r.Ub()),2&e){const e=t.$implicit;r.Bb(1),r.nc("ngIf","ant"==e.type),r.Bb(1),r.nc("ngIf","fa"==e.type)}}function Be(e,t){if(1&e&&r.Qb(0,"div",25),2&e){const e=r.gc(),t=e.$implicit,n=e.index,i=r.gc();r.nc("nzTooltipTitle",i.GetTerminateStatusText(t,n))}}function Fe(e,t){if(1&e&&(r.Tb(0),r.Qb(1,"nz-divider",26),r.Sb()),2&e){const e=t.$implicit;r.Bb(1),r.nc("nzText",e)}}function De(e,t){if(1&e){const e=r.Wb();r.Tb(0),r.Vb(1,"div",10),r.Vb(2,"div",11),r.dc("click",function(n){r.yc(e);const i=t.$implicit;return r.gc().ClickAction(n,i)})("dblclick",function(){r.yc(e);const n=t.$implicit;return r.gc().openModal(n)})("contextmenu",function(n){r.yc(e);const i=t.$implicit,o=r.gc(),c=r.vc(11);return o.openItemContextMenu(n,c,i)}),r.Vb(3,"div",12),r.Vb(4,"div",13),r.Fc(5,_e,3,2,"div",14),r.Ub(),r.Vb(6,"div",15),r.Vb(7,"div",16),r.Hc(8),r.Ub(),r.Qb(9,"action-list-details",17),r.Ub(),r.Fc(10,Be,1,1,"div",18),r.Ub(),r.Ub(),r.Fc(11,Fe,2,1,"ng-container",19),r.Ub(),r.Sb()}if(2&e){const e=t.$implicit,n=t.index,i=r.gc();r.Bb(2),r.Hb("selected",i.IsActionSelected(e))("disabled",!e.Enabled)("afterTerminate",i.IsAfterTerminate(n)),r.Bb(3),r.nc("ngIf",i.prepareIcon(i.GetIcon(e))),r.Bb(3),r.Jc("",e.ActionType," "),r.Bb(1),r.nc("action",e),r.Bb(1),r.nc("ngIf",e.Terminating),r.Bb(1),r.nc("ngIf",i.GetTerminateStatus(e,n))}}function Ge(e,t){if(1&e){const e=r.Wb();r.Vb(0,"ul",27),r.Vb(1,"li",28),r.Vb(2,"ul",29),r.Vb(3,"li",30),r.dc("click",function(){return r.yc(e),r.gc().CreateAction("UrlRedirect","bottom")}),r.Qb(4,"i",31),r.Hc(5," UrlRedirect "),r.Ub(),r.Vb(6,"li",30),r.dc("click",function(){return r.yc(e),r.gc().CreateAction("UrlRewrite","bottom")}),r.Qb(7,"i",32),r.Hc(8," UrlRewrite "),r.Ub(),r.Vb(9,"li",30),r.dc("click",function(){return r.yc(e),r.gc().CreateAction("Script","bottom")}),r.Qb(10,"i",33),r.Hc(11," Script "),r.Ub(),r.Ub(),r.Ub(),r.Ub()}}const Qe=function(){return["fas","toggle-on"]};function Le(e,t){if(1&e){const e=r.Wb();r.Vb(0,"li",30),r.dc("click",function(){r.yc(e);const t=r.gc().$implicit;return r.gc().SetActionEnabled(t.Single,!0)}),r.Qb(1,"fa-icon",40),r.Hc(2," Enable "),r.Ub()}2&e&&(r.Bb(1),r.nc("icon",r.pc(1,Qe)))}const $e=function(){return["fas","toggle-off"]};function Ne(e,t){if(1&e){const e=r.Wb();r.Vb(0,"li",30),r.dc("click",function(){r.yc(e);const t=r.gc().$implicit;return r.gc().SetActionEnabled(t.Single,!1)}),r.Qb(1,"fa-icon",40),r.Hc(2," Disable "),r.Ub()}2&e&&(r.Bb(1),r.nc("icon",r.pc(1,$e)))}function Ee(e,t){if(1&e){const e=r.Wb();r.Vb(0,"li",30),r.dc("click",function(){r.yc(e);const t=r.gc().$implicit;return r.gc().openModal(t.Single)}),r.Qb(1,"i",41),r.Hc(2," Edit "),r.Ub()}}function je(e,t){if(1&e){const e=r.Wb();r.Vb(0,"li",30),r.dc("click",function(){r.yc(e);const t=r.gc(2).$implicit;return r.gc().SetActionTerminate(t.Single,!0)}),r.Qb(1,"db-icon",43),r.Hc(2," Stop processing after Action "),r.Ub()}}function We(e,t){if(1&e){const e=r.Wb();r.Vb(0,"li",30),r.dc("click",function(){r.yc(e);const t=r.gc(2).$implicit;return r.gc().SetActionTerminate(t.Single,!1)}),r.Qb(1,"db-icon",44),r.Hc(2," Continue processing after Action "),r.Ub()}}function Je(e,t){if(1&e&&(r.Vb(0,"li",42),r.Vb(1,"ul",29),r.Fc(2,je,3,0,"li",34),r.Fc(3,We,3,0,"li",34),r.Ub(),r.Ub()),2&e){const e=r.gc().$implicit;r.Bb(2),r.nc("ngIf",!1===(null==e.Single?null:e.Single.Terminating)),r.Bb(1),r.nc("ngIf",!0===(null==e.Single?null:e.Single.Terminating))}}function Ke(e,t){if(1&e){const e=r.Wb();r.Vb(0,"li",45),r.Vb(1,"ul",29),r.Vb(2,"li",30),r.dc("click",function(){r.yc(e);const t=r.gc().$implicit;return r.gc().CreateAction("UrlRedirect","before",t.Single)}),r.Qb(3,"i",31),r.Hc(4," UrlRedirect "),r.Ub(),r.Vb(5,"li",30),r.dc("click",function(){r.yc(e);const t=r.gc().$implicit;return r.gc().CreateAction("UrlRewrite","before",t.Single)}),r.Qb(6,"i",32),r.Hc(7," UrlRewrite "),r.Ub(),r.Vb(8,"li",30),r.dc("click",function(){r.yc(e);const t=r.gc().$implicit;return r.gc().CreateAction("Script","before",t.Single)}),r.Qb(9,"i",33),r.Hc(10," Script "),r.Ub(),r.Ub(),r.Ub()}}function qe(e,t){if(1&e){const e=r.Wb();r.Vb(0,"li",46),r.Vb(1,"ul",29),r.Vb(2,"li",30),r.dc("click",function(){r.yc(e);const t=r.gc().$implicit;return r.gc().CreateAction("UrlRedirect","after",t.Single)}),r.Qb(3,"i",31),r.Hc(4," UrlRedirect "),r.Ub(),r.Vb(5,"li",30),r.dc("click",function(){r.yc(e);const t=r.gc().$implicit;return r.gc().CreateAction("UrlRewrite","after",t.Single)}),r.Qb(6,"i",32),r.Hc(7," UrlRewrite "),r.Ub(),r.Vb(8,"li",30),r.dc("click",function(){r.yc(e);const t=r.gc().$implicit;return r.gc().CreateAction("Script","after",t.Single)}),r.Qb(9,"i",33),r.Hc(10," Script "),r.Ub(),r.Ub(),r.Ub()}}function Ze(e,t){if(1&e){const e=r.Wb();r.Vb(0,"ul",27),r.Fc(1,Le,3,2,"li",34),r.Fc(2,Ne,3,2,"li",34),r.Fc(3,Ee,3,0,"li",34),r.Fc(4,Je,4,2,"li",35),r.Fc(5,Ke,11,0,"li",36),r.Fc(6,qe,11,0,"li",37),r.Qb(7,"li",38),r.Vb(8,"li",30),r.dc("click",function(){r.yc(e);const n=t.$implicit;return r.gc().RemoveActions(n.Selected)}),r.Qb(9,"i",39),r.Hc(10," Remove "),r.Ub(),r.Ub()}if(2&e){const e=t.$implicit;r.Bb(1),r.nc("ngIf",!1===(null==e.Single?null:e.Single.Enabled)),r.Bb(1),r.nc("ngIf",!0===(null==e.Single?null:e.Single.Enabled)),r.Bb(1),r.nc("ngIf",e.Single),r.Bb(1),r.nc("ngIf",e.Single),r.Bb(1),r.nc("ngIf",e.Single),r.Bb(1),r.nc("ngIf",e.Single)}}const Xe=function(){return[]};let Ye=(()=>{class e{constructor(e,t,n,i,o,c,s,d){this.uiService=e,this.modal=t,this.overlay=n,this.viewContainerRef=i,this.cref=o,this.componentFactoryResolver=c,this.actionHelper=s,this.rulesService=d,this.terminateActionIndex=-1,this.actionsSubject$=new a.a(null),this.actions$=this.actionsSubject$.asObservable().pipe(Object(l.a)(e=>{this.terminateActionIndex=e.findIndex(e=>e.Enabled&&e.Terminating)})),this.actionsChange=new r.n,this.selectedActions=[],this.registered=[],this.onTouched=()=>{}}get actions(){return this.actionsSubject$.value}set actions(e){e=null==e?void 0:e.sort((e,t)=>e.Order>t.Order?1:e.Order<t.Order?-1:0),this.actionsSubject$.next(e)}ngOnDestroy(){var e;null===(e=this.ContextMenu)||void 0===e||e.Close()}ngOnInit(){}IsActionSelected(e){return this.selectedActions.includes(e.Id)}setActionSelected(e,t){this.selectedActions=t?[...new Set([...this.selectedActions,e.Id])]:this.selectedActions.filter(t=>t!=e.Id)}GetSelectedActions(){return this.actions.filter(e=>this.selectedActions.includes(e.Id))}ClickAction(e,t){var n;if(e.stopPropagation(),null===(n=this.ContextMenu)||void 0===n||n.Close(),e.ctrlKey){const e=this.IsActionSelected(t);this.setActionSelected(t,!e)}else this.selectedActions=[],this.setActionSelected(t,!0)}OpenOuterContextMenu(e,t){var n;e.stopPropagation(),this.selectedActions=[],null===(n=this.ContextMenu)||void 0===n||n.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,null)}ClickOutside(){this.selectedActions=[]}openItemContextMenu(e,t,n){var i;if(e.stopPropagation(),0==this.selectedActions.length||!this.IsActionSelected(n))if(e.ctrlKey){const e=this.IsActionSelected(n);this.setActionSelected(n,!e)}else this.selectedActions=[],this.setActionSelected(n,!0);null===(i=this.ContextMenu)||void 0===i||i.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,this.BuildContext())}BuildContext(){const e=new b;return e.AllItems=this.actions,e.Selected=this.actions.filter(e=>this.selectedActions.includes(e.Id)),e}GetIcon(e){return this.actionHelper.GetIcon(e)}prepareIcon(e){if(!e)return null;if(e.startsWith("fa#")){let t={type:"fa",icon:null};return e=e.substring(3),t.icon=e.includes("|")?e.split("|"):e,t}return{type:"ant",icon:e}}CreateAction(e,t,n){let i=new S;switch(e.toLowerCase()){case"urlredirect":i=new E;break;case"urlrewrite":i=new M;break;case"script":i=new q}i.Order=this.CalculateOrder(t,n),i.Id=this.getNewActionsId().toString(),this.actions=[...this.actions,i],this.propagateChange(this.actions)}getNewActionsId(){var e=this.actions.map(e=>{return/^(\-|\+)?([0-9]+|Infinity)$/.test(t=e.Id)?Number(t):NaN;var t}).filter(e=>!Number.isNaN(e)).sort((e,t)=>t-e);return e&&e.length>0?e[0]+1:0}GetNextLastOrder(){if(!this.actions||0===this.actions.length)return 10;var e=Math.trunc(Math.max(...this.actions.map(e=>e.Order))+10);return console.log("NEXT",e),e}CalculateOrder(e,t){var n;let i=-1;switch(t&&(i=null===(n=this.actions)||void 0===n?void 0:n.findIndex(e=>e.Order===t.Order)),e){case"top":return this.actions&&0!=this.actions.length?this.actions[0].Order/2:10;case"before":return 0==i?t.Order/2:t.Order-(t.Order-this.actions[i-1].Order)/2;case"after":return i==this.actions.length-1?this.GetNextLastOrder():t.Order+(this.actions[i+1].Order-t.Order)/2;case"bottom":return this.GetNextLastOrder()}}SetActionEnabled(e,t){this.actions=this.actions.map(n=>(n==e&&(n.Enabled=t),n)),this.propagateChange(this.actions)}SetActionTerminate(e,t){this.actions=this.actions.map(n=>(n==e&&(n.Terminating=t),n)),this.propagateChange(this.actions)}RemoveActions(e){var t;const n=e.map(e=>e.Id);this.actions=this.actions.filter(e=>!n.includes(e.Id)),this.propagateChange(this.actions),null===(t=this.ContextMenu)||void 0===t||t.Close()}drop(e){const t=this.actions[e.previousIndex];let n=null;if(e.previousIndex<e.currentIndex?n="forward":e.previousIndex>e.currentIndex&&(n="back"),n){if(console.log(n,this.actions.length),"forward"===n)if(e.currentIndex===this.actions.length-1)console.log("-- 1 --"),t.Order=this.GetNextLastOrder();else{console.log("-- 2 --");const n=this.actions[e.currentIndex];t.Order=(this.actions[e.currentIndex+1].Order-n.Order)/2+n.Order}else if("back"===n)if(0===e.currentIndex)console.log("-- 3 --"),t.Order=this.actions[0].Order/2;else{console.log("-- 4 --");const n=this.actions[e.currentIndex-1];t.Order=(this.actions[e.currentIndex].Order-n.Order)/2+n.Order}Object(u.e)(this.actions,e.previousIndex,e.currentIndex),this.actions=[...this.actions],this.propagateChange(this.actions)}}GetTerminateStatus(e,t){return e.Enabled?this.IsAfterTerminate(t)?null:this.GetTerminateStatusText(e,t):null}GetTerminateStatusText(e,t){const n=this.IsLastExecuted(t);return!e.Terminating&&n?"Continue with next Endpoint Rule":e.Terminating&&n?"Stop processing further Endpoint Rules":e.Terminating&&!n?"Stop processing further Actions / Endpoint Rules":void 0}IsAfterTerminate(e){return-1!=this.terminateActionIndex&&e>this.terminateActionIndex}IsLastExecuted(e){return 0==this.actions.filter((t,n)=>t.Enabled&&n>e).length}openModal(e){var t;switch(null===(t=this.ContextMenu)||void 0===t||t.Close(),Object.assign({},e),e.ActionType){case"UrlRedirect":this.ContextMenu=this.actionHelper.GetModal("UrlRedirect").SetData(e).AddEventHandler("OK",t=>{e.Parameters=t.payload,this.actions=[...this.actions],this.propagateChange(this.actions)}).Open();break;case"UrlRewrite":this.ContextMenu=this.actionHelper.GetModal("UrlRewrite").SetData(e).AddEventHandler("OK",t=>{e.Parameters=t.payload,this.actions=[...this.actions],this.propagateChange(this.actions)}).Open();break;case"Script":this.ContextMenu=this.actionHelper.GetModal("Script").SetData(e).AddEventHandler("OK",t=>{e.Parameters=t.payload,this.actions=[...this.actions],this.propagateChange(this.actions),t.handle.Close()}).AddEventHandler("Save",t=>{e.Parameters=t.payload,this.actions=[...this.actions],this.propagateChange(this.actions),this.rulesService.UpdateAction(e).subscribe()}).Open()}}propagateChange(e){this.actionsChange.emit(e),this.registered.forEach(t=>{t(e)})}writeValue(e){this.actions=e}registerOnChange(e){-1===this.registered.indexOf(e)&&this.registered.push(e)}registerOnTouched(e){this.onTouched=e}setDisabledState(e){}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(c.a),r.Pb(w.b),r.Pb(w.c),r.Pb(r.Q),r.Pb(r.h),r.Pb(r.j),r.Pb(ne),r.Pb(z))},e.\u0275cmp=r.Jb({type:e,selectors:[["endpoint-actions-list"]],inputs:{actions:"actions"},outputs:{actionsChange:"actionsChange"},features:[r.Ab([{provide:P.k,useExisting:e,multi:!0}])],decls:12,vars:7,consts:[["cdkDropList","",1,"outer",2,"flex-grow","1","height","100%",3,"contextmenu","click"],["nullList","cdkDropList"],["cdkDropList","",2,"padding","2px","margin-top","8px","max-height","calc(100% - 30px)","overflow-y","auto",3,"cdkDropListDropped"],["rulesList","cdkDropList"],["style","text-align: center; font-size: 1.3em; font-weight: bold; color: #525e7678; line-height: 1.4em; line-height: 2em; margin: 0px 10px;",4,"ngIf"],[4,"ngFor","ngForOf"],["outerContextMenu",""],["itemContextMenu",""],[2,"text-align","center","font-size","1.3em","font-weight","bold","color","#525e7678","line-height","1.4em","line-height","2em","margin","0px 10px"],[2,"font-size","1.5em"],["cdkDrag","","cdkDragLockAxis","y"],[1,"action-item",3,"click","dblclick","contextmenu"],[2,"display","flex"],["cdkDragHandle","",1,"dragHandle",2,"padding","10px 0px 0px 5px"],["class","title-icon",4,"ngIf"],[2,"padding","5px","flex-grow","1"],[2,"font-size","large","font-weight","bold","color","#292f3b"],[3,"action"],["class","terminate-indicator","nz-tooltip","",3,"nzTooltipTitle",4,"ngIf"],[4,"ngIf"],[1,"title-icon"],["style","font-size: xx-large; width: 40px; text-align: left;","nz-icon","","nzTheme","outline",3,"nzType",4,"ngIf"],["style","font-size: xx-large; width: 40px; text-align: left;","nz-icon","",3,"icon",4,"ngIf"],["nz-icon","","nzTheme","outline",2,"font-size","xx-large","width","40px","text-align","left",3,"nzType"],["nz-icon","",2,"font-size","xx-large","width","40px","text-align","left",3,"icon"],["nz-tooltip","",1,"terminate-indicator",3,"nzTooltipTitle"],["nzDashed","",1,"action-divider",3,"nzText"],["nz-menu","","nzMode","vertical",1,"context-menu"],["nz-submenu","","nzTitle","Add Action","nzIcon","menu-unfold"],[1,"context-menu"],["nz-menu-item","",3,"click"],["nz-icon","","nzType","rollback","nzTheme","outline"],["nz-icon","","nzType","edit","nzTheme","outline"],["nz-icon","","nzType","code","nzTheme","outline"],["nz-menu-item","",3,"click",4,"ngIf"],["nz-submenu","","nzTitle","Options","nzIcon","setting",4,"ngIf"],["nz-submenu","","nzTitle","Add Action Before","nzIcon","up",4,"ngIf"],["nz-submenu","","nzTitle","Add Action After","nzIcon","down",4,"ngIf"],["nz-menu-divider",""],["nz-icon","","nzType","delete","nzTheme","outline"],["nz-icon","",3,"icon"],["nz-icon","","nzType","form","nzTheme","outline"],["nz-submenu","","nzTitle","Options","nzIcon","setting"],["icon","fa#far|stop-circle"],["icon","fa#far|play-circle"],["nz-submenu","","nzTitle","Add Action Before","nzIcon","up"],["nz-submenu","","nzTitle","Add Action After","nzIcon","down"]],template:function(e,t){if(1&e){const e=r.Wb();r.Vb(0,"div",0,1),r.dc("contextmenu",function(n){r.yc(e);const i=r.vc(9);return t.OpenOuterContextMenu(n,i)})("click",function(){return t.ClickOutside()}),r.Vb(2,"div",2,3),r.dc("cdkDropListDropped",function(e){return t.drop(e)}),r.Fc(4,Te,5,0,"div",4),r.hc(5,"async"),r.Fc(6,De,12,11,"ng-container",5),r.hc(7,"async"),r.Ub(),r.Ub(),r.Fc(8,Ge,12,0,"ng-template",null,6,r.Gc),r.Fc(10,Ze,11,6,"ng-template",null,7,r.Gc)}2&e&&(r.Bb(4),r.nc("ngIf",0===(r.ic(5,2,t.actions$)||r.pc(6,Xe)).length),r.Bb(2),r.nc("ngForOf",r.ic(7,4,t.actions$)))},directives:[u.c,i.o,i.n,u.a,u.b,ke,V.a,T.a,Ve.b,oe.d,Re.a,A.c,A.g,A.e,A.d,ie.c],pipes:[i.b],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1}.action-item[_ngcontent-%COMP%]{margin-bottom:10px!important;border-radius:0!important;box-shadow:0 0 3px 1px #cecece;background-color:#fff}.action-item.disabled[_ngcontent-%COMP%]{opacity:.6;box-shadow:none;background-color:#e2e2e2}.action-item[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{border-right:1px solid #fff}.action-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}.action-item.selected[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{background-color:#292f3b;color:#fff}.action-item[_ngcontent-%COMP%]:hover{background-color:#b2b7c2}.new-rule.ui.button[_ngcontent-%COMP%]{margin:0}.options[_ngcontent-%COMP%]{background-color:grey;height:50px}.list-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{background-color:inherit!important}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:inherit}.dragHandle[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.list-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#e0e1e2}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{cursor:inherit}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:inherit}.list-item.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%], .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{border-radius:0!important;background-color:#2f2f2f;color:#f5f5f5}.outer.cdk-drop-list-dragging[_ngcontent-%COMP%] > .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{display:none}.context-menu[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{margin:0!important}.afterTerminate[_ngcontent-%COMP%]{opacity:.3}.terminate-indicator[_ngcontent-%COMP%]{width:8px;background-color:#525e76;border-left:1px solid #fff}.action-item.disabled[_ngcontent-%COMP%]   .terminate-indicator[_ngcontent-%COMP%]{background-color:inherit}.action-item[_ngcontent-%COMP%]:hover   .terminate-indicator[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}"],changeDetection:0}),e})();var et=n("ycP/"),tt=n("XNiG"),nt=n("1G5W");function it(e,t){1&e&&(r.Vb(0,"div",5),r.Vb(1,"div",21),r.Vb(2,"nz-form-label",28),r.Hc(3,"PrincipalName"),r.Ub(),r.Vb(4,"nz-form-control"),r.Qb(5,"input",29),r.Ub(),r.Ub(),r.Ub())}function ot(e,t){1&e&&(r.Vb(0,"nz-form-control"),r.Qb(1,"input",30),r.Ub())}function rt(e,t){1&e&&(r.Vb(0,"nz-form-control"),r.Qb(1,"input",31),r.Ub())}let ct=(()=>{class e{constructor(e,t){this.fb=e,this.context=t,this.form=e.group({Id:[],PrincipalName:[],Type:["User"],Order:[],AccessMode:["Allow"],BoundToClient:[],Client:[],BoundToSourceAddress:[],SourceAddress:[]})}ngOnInit(){this.Get("BoundToClient").valueChanges.subscribe(e=>{e?this.Get("Client").enable():this.Get("Client").disable()}),this.Get("BoundToSourceAddress").valueChanges.subscribe(e=>{e?this.Get("SourceAddress").enable():this.Get("SourceAddress").disable()}),this.Get("Type").valueChanges.subscribe(e=>{console.log("Type",e),"Authenticated"==e||"Everyone"==e?this.Get("PrincipalName").disable():this.Get("PrincipalName").enable()}),this.form.patchValue(this.context.data),this.Get("BoundToClient").patchValue(this.Get("Client").value),this.Get("BoundToSourceAddress").patchValue(this.Get("SourceAddress").value)}ok(){this.context.invoke("OK",this.form.value)}cancel(){this.context.handle.Close()}Get(e){return this.form.get(e)}IsEnabled(e){return this.form.get(e).enabled}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(P.e),r.Pb(w.d))},e.\u0275cmp=r.Jb({type:e,selectors:[["ng-component"]],decls:43,vars:5,consts:[[1,"modal-header",2,"padding","10px !important","display","flex","margin-bottom","1px"],[2,"font-size","2em","font-weight","bold","line-height","1.4285em","color","whitesmoke","margin","auto"],[2,"flex-grow","1"],[1,"modal-content"],["nz-form","",2,"width","100%","margin","10px 0px",3,"formGroup"],["nz-row","",2,"margin-bottom","4px"],["nz-col","","nzSpan","10","nzOffset","1"],["nzRequired","","nzFor","Type"],[2,"width","100%"],["formControlName","Type","id","Type",2,"width","100%"],["nzValue","User","nzLabel","User"],["nzValue","Role","nzLabel","Role"],["nzValue","Authenticated","nzLabel","Authenticated"],["nzValue","Everyone","nzLabel","Everyone"],["nz-col","","nzSpan","10","nzOffset","2"],["nzRequired","","nzFor","AccessMode"],["formControlName","AccessMode","id","AccessMode",2,"width","100%"],["nzValue","Allow","nzLabel","Allow"],["nzValue","Deny","nzLabel","Deny"],["nzValue","Ignore","nzLabel","Ignore"],["nz-row","","style","margin-bottom: 4px;",4,"ngIf"],["nz-col","","nzSpan","22","nzOffset","1"],["nz-checkbox","","formControlName","BoundToClient",1,"select-label"],[4,"ngIf"],["formControlName","BoundToSourceAddress","nz-checkbox","",1,"select-label"],[1,"modal-footer",2,"margin-bottom","0px","margin-top","1px","background","#292f3b","padding","2px"],["nz-button","","nzType","default",1,"secondary",3,"click"],["nz-button","","nzType","primary",3,"disabled","click"],["nzRequired","","nzFor","PrincipalName"],["nz-input","","formControlName","PrincipalName","id","PrincipalName"],["nz-input","","formControlName","Client","id","Client",2,"width","100%"],["nz-input","","formControlName","SourceAddress","id","SourceAddress",2,"width","100%"]],template:function(e,t){1&e&&(r.Vb(0,"div",0),r.Vb(1,"div",1),r.Hc(2," Permission Rule "),r.Ub(),r.Qb(3,"div",2),r.Qb(4,"div"),r.Ub(),r.Vb(5,"div",3),r.Vb(6,"form",4),r.Vb(7,"div",5),r.Vb(8,"div",6),r.Vb(9,"nz-form-label",7),r.Hc(10,"Type"),r.Ub(),r.Vb(11,"nz-form-control",8),r.Vb(12,"nz-select",9),r.Qb(13,"nz-option",10),r.Qb(14,"nz-option",11),r.Qb(15,"nz-option",12),r.Qb(16,"nz-option",13),r.Ub(),r.Ub(),r.Ub(),r.Vb(17,"div",14),r.Vb(18,"nz-form-label",15),r.Hc(19,"AccessMode"),r.Ub(),r.Vb(20,"nz-form-control",8),r.Vb(21,"nz-select",16),r.Qb(22,"nz-option",17),r.Qb(23,"nz-option",18),r.Qb(24,"nz-option",19),r.Ub(),r.Ub(),r.Ub(),r.Ub(),r.Fc(25,it,6,0,"div",20),r.Vb(26,"div",5),r.Vb(27,"div",21),r.Vb(28,"label",22),r.Hc(29," Bound To Client "),r.Ub(),r.Fc(30,ot,2,0,"nz-form-control",23),r.Ub(),r.Ub(),r.Vb(31,"div",5),r.Vb(32,"div",21),r.Vb(33,"label",24),r.Hc(34," Bound To SourceAddress "),r.Ub(),r.Fc(35,rt,2,0,"nz-form-control",23),r.Ub(),r.Ub(),r.Ub(),r.Ub(),r.Vb(36,"div",25),r.Vb(37,"button",26),r.dc("click",function(){return t.cancel()}),r.Hc(38,"Cancel"),r.Ub(),r.Qb(39,"div",2),r.Vb(40,"nz-button-group"),r.Vb(41,"button",27),r.dc("click",function(){return t.ok()}),r.Hc(42,"Submit & Close"),r.Ub(),r.Ub(),r.Ub()),2&e&&(r.Bb(6),r.nc("formGroup",t.form),r.Bb(19),r.nc("ngIf",t.IsEnabled("PrincipalName")),r.Bb(5),r.nc("ngIf",t.IsEnabled("Client")),r.Bb(5),r.nc("ngIf",t.IsEnabled("SourceAddress")),r.Bb(6),r.nc("disabled",!t.form.valid))},directives:[P.r,P.n,F.b,P.h,D.c,D.a,F.d,F.a,Z.b,P.m,P.g,Z.a,i.o,j.a,U.a,k.a,V.a,U.b,G.b,P.d],styles:["[_nghost-%COMP%]{box-shadow:0 0 1px 2px #dedddd;max-width:100%;max-height:100%;background-color:#dedddd}.modal-header[_ngcontent-%COMP%]{background-color:#292f3b!important}.modal-header[_ngcontent-%COMP%], .modal-header[_ngcontent-%COMP%]   .ui.huge.header[_ngcontent-%COMP%]{color:#fff!important}.modal-content[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]{border:none!important;display:flex}.modal-content[_ngcontent-%COMP%]{flex-grow:1;max-width:100%;max-height:100%}.flex-grow-column[_ngcontent-%COMP%], .modal-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column}.select-label[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center;height:32px;color:rgba(0,0,0,.85);font-size:14px}"],changeDetection:0}),e})();class st{}var lt=n("gwh1");const at=["itemsContextMenu"],dt=["viewportContextMenu"],ut=function(){return["far","plus-square"]};function bt(e,t){if(1&e){const e=r.Wb();r.Vb(0,"ul",3),r.Vb(1,"li",4),r.dc("click",function(){return r.yc(e),r.gc().AddRule()}),r.Qb(2,"fa-icon",5),r.Hc(3," Add Rule "),r.Ub(),r.Ub()}2&e&&(r.Bb(2),r.nc("icon",r.pc(1,ut)))}function ht(e,t){if(1&e){const e=r.Wb();r.Vb(0,"li",4),r.dc("click",function(){r.yc(e);const t=r.gc().$implicit;return r.gc().RemoveClaim(t.SelectedData)}),r.Qb(1,"i",8),r.Hc(2," Delete "),r.Ub()}}function pt(e,t){if(1&e){const e=r.Wb();r.Vb(0,"ul",3),r.Vb(1,"li",4),r.dc("click",function(){return r.yc(e),r.gc().AddRule()}),r.Qb(2,"fa-icon",5),r.Hc(3," Add Rule "),r.Ub(),r.Vb(4,"li",4),r.dc("click",function(){r.yc(e);const n=t.$implicit;return r.gc().OpenEditVariableModal(n.First)}),r.Qb(5,"i",6),r.Hc(6," Edit Rule "),r.Ub(),r.Fc(7,ht,3,0,"li",7),r.Ub()}if(2&e){const e=t.$implicit;r.Bb(2),r.nc("icon",r.pc(2,ut)),r.Bb(5),r.nc("ngIf",e.Any)}}let gt=(()=>{class e{constructor(e,t,n){this.overlay=e,this.viewContainerRef=t,this.modal=n,this._entries=[],this._disabled=!1,this.entriesChange=new r.n,this.grid=(new et.d).SetColumns(e=>e.Default("Type").SetInitialWidth(300,!0).Set(e=>e.rowDrag=!0).Sortable(!1),e=>e.Default("PrincipalName").Sortable(!1),e=>e.Default("AccessMode").Sortable(!1),e=>e.Default("Client").Sortable(!1),e=>e.Default("SourceAddress").Sortable(!1)).WithRowSelection("multiple").SetGridOptions({onRowDragMove:e=>this.onRowDragMove(e),onRowDragEnd:e=>this.dragEnd(e),onRowDragLeave:e=>this.onRowDragLeave(e)}).WithFullRowEditType().WithShiftResizeMode().OnDataUpdate(e=>this.propagateChange(e)).OnCellContextMenu(e=>{const t=e.api.getSelectedNodes();0!=t.length&&t.includes(e.node)||e.node.setSelected(!0,!0);let n=new et.a(e.api,e.event);this.contextMenu=this.overlay.OpenContextMenu(e.event,this.itemsContextMenu,this.viewContainerRef,n)}).OnViewPortContextMenu((e,t)=>{t.deselectAll();let n=new et.a(t,e);this.contextMenu=this.overlay.OpenContextMenu(e,this.viewportContextMenu,this.viewContainerRef,n)}).OnRowDoubleClicked(e=>{this.OpenEditVariableModal(e.data)}).StopEditingWhenGridLosesFocus().OnGridSizeChange(e=>e.api.sizeColumnsToFit()).OnViewPortClick((e,t)=>{t.deselectAll()}),this.registered=[],this.onTouched=()=>{}}set entries(e){var t;let n=e||[];0==n.length&&(n=[]),this._entries=n,null===(t=this.grid)||void 0===t||t.SetData(this._entries)}get entries(){return this._entries}get disabled(){return this._disabled}set disabled(e){this._disabled=null!=e&&!1!==e&&!!e}AddRule(){this.contextMenu.Close(),this.OpenEditVariableModal(null)}OpenEditVariableModal(e){var t=null==e;e=null!=e?e:new st,this.modal.FromComponent(ct).SetData(e).SetModalOptions({overlayConfig:{minWidth:500}}).AddEventHandler("OK",e=>{t?(e.payload.Order=this.GetNextLastOrder(),this.entries=[...this.entries,e.payload]):this.entries=this.entries.map(t=>(t.Id==e.payload.Id&&(t.AccessMode=e.payload.AccessMode,t.Client=e.payload.Client,t.PrincipalName=e.payload.PrincipalName,t.SourceAddress=e.payload.SourceAddress,t.Type=e.payload.Type),t)),e.handle.Close()}).Open()}RemoveClaim(e){this.entries=this.entries.filter(t=>!e.includes(t)),this.contextMenu.Close()}onRowDragMove(e){function t(e,t,n){var i=e[t];e.splice(t,1),e.splice(n,0,i)}this.moveItem$||(this.moveItem$=new tt.a,this.cancelMoveItem$=new tt.a,this.dragStartingIndex=this.entries.indexOf(e.node.data),this.dragItem=e.node.data,this.moveItem$.pipe(Object(nt.a)(this.cancelMoveItem$)).subscribe(e=>{var n=e.node,i=e.overNode;if(n!==i){var o=null==i?void 0:i.data,r=this.entries.indexOf(n.data),c=o?this.entries.indexOf(o):this.entries.length-1,s=this.entries.slice();t(s,r,c),this.entries=s}},e=>console.log("Error",e),()=>{var e=this.entries.indexOf(this.dragItem),n=this.entries.slice();t(n,e,this.dragStartingIndex),this.entries=n,this.moveItem$=null,this.cancelMoveItem$=null,this.dragStartingIndex=null,this.dragItem=null})),this.moveItem$.next(e)}onRowDragLeave(e){var t;null===(t=this.cancelMoveItem$)||void 0===t||t.next(!0)}GetNextLastOrder(){if(!this.entries||0===this.entries.length)return 10;var e=Math.trunc(Math.max(...this.entries.map(e=>e.Order))+10);return console.log("NEXT",e),e}dragEnd(e){var t=this.entries.indexOf(e.node.data);if(t==this.dragStartingIndex)console.log("Gleich");else if(t==this.entries.length-1)this.setOrder(this.dragItem,this.GetNextLastOrder());else if(0==t)this.entries.length>1&&(t=this.entries[1].Order/2),this.setOrder(this.dragItem,t);else{console.log("Dazwischen");var n=this.entries[t-1].Order;this.setOrder(this.dragItem,(this.entries[t+1].Order-n)/2+n)}this.moveItem$=null,this.cancelMoveItem$=null,this.dragStartingIndex=null,this.dragItem=null}setOrder(e,t){e.Order=t,this.entries=[...this.entries]}propagateChange(e){this.entriesChange.emit(e),this.registered.forEach(t=>{t(e)})}writeValue(e){this.entries=e}registerOnChange(e){-1===this.registered.indexOf(e)&&this.registered.push(e)}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(w.c),r.Pb(r.Q),r.Pb(w.b))},e.\u0275cmp=r.Jb({type:e,selectors:[["permissions-manager"]],viewQuery:function(e,t){if(1&e&&(r.Lc(at,1),r.Lc(dt,1)),2&e){let e;r.uc(e=r.ec())&&(t.itemsContextMenu=e.first),r.uc(e=r.ec())&&(t.viewportContextMenu=e.first)}},inputs:{entries:"entries",disabled:"disabled"},outputs:{entriesChange:"entriesChange"},features:[r.Ab([{provide:P.k,useExisting:e,multi:!0}])],decls:5,vars:1,consts:[[1,"ag-theme-balham","no-scrollbar",2,"flex-grow","1",3,"dbGrid"],["viewportContextMenu",""],["itemsContextMenu",""],["nz-menu","","nzMode","vertical",1,"context-menu"],["nz-menu-item","",3,"click"],["nz-icon","",3,"icon"],["nz-icon","","nzType","form","nzTheme","outline"],["nz-menu-item","",3,"click",4,"ngIf"],["nz-icon","","nzType","delete","nzTheme","outline"]],template:function(e,t){1&e&&(r.Qb(0,"ag-grid-angular",0),r.Fc(1,bt,4,2,"ng-template",null,1,r.Gc),r.Fc(3,pt,8,3,"ng-template",null,2,r.Gc)),2&e&&r.nc("dbGrid",t.grid)},directives:[lt.a,et.b,A.c,V.a,A.e,Ve.b,T.a,i.o],styles:["[_nghost-%COMP%]{width:100%;flex-grow:1;display:flex;flex-direction:column}.editable-cell[_ngcontent-%COMP%]{position:relative;padding:5px 12px;cursor:pointer;min-height:32px}.editable-row[_ngcontent-%COMP%]:hover   .editable-cell[_ngcontent-%COMP%]{border:1px solid #d9d9d9;border-radius:4px;padding:4px 11px}.editable-row[_ngcontent-%COMP%]{height:49px}nz-table[_ngcontent-%COMP%]{flex-grow:1}"]}),e})();function mt(e,t){1&e&&(r.Qb(0,"i",35),r.Hc(1,"Basic "))}function ft(e,t){1&e&&(r.Vb(0,"span"),r.Hc(1,"Enabled"),r.Ub())}function vt(e,t){1&e&&(r.Vb(0,"span"),r.Hc(1,"Disabled"),r.Ub())}function xt(e,t){1&e&&(r.Qb(0,"i",36),r.Hc(1,"Actions"))}function Ct(e,t){1&e&&(r.Qb(0,"db-icon",37),r.Hc(1,"Permissions"))}function Ot(e,t){1&e&&(r.Qb(0,"i",40),r.Hc(1,"Debug"))}function zt(e,t){if(1&e&&(r.Vb(0,"nz-tab",3),r.Fc(1,Ot,2,0,"ng-template",null,38,r.Gc),r.Vb(3,"div",39),r.Vb(4,"pre"),r.Hc(5),r.hc(6,"json"),r.Ub(),r.Ub(),r.Ub()),2&e){const e=r.vc(2),t=r.gc(2);r.nc("nzTitle",e),r.Bb(5),r.Ic(r.ic(6,2,t.form.value))}}const wt=function(){return{inkBar:!0,tabPane:!1}},St=function(){return[","]};function yt(e,t){if(1&e){const e=r.Wb();r.Tb(0),r.Vb(1,"form",1),r.Vb(2,"nz-tabset",2),r.dc("nzSelectChange",function(t){return r.yc(e),r.gc().tabChanged(t)}),r.Vb(3,"nz-tab",3),r.Fc(4,mt,2,0,"ng-template",null,4,r.Gc),r.Vb(6,"div",5),r.Vb(7,"div",6),r.Vb(8,"nz-form-label",7),r.Hc(9,"Name"),r.Ub(),r.Vb(10,"nz-form-control"),r.Qb(11,"input",8),r.Ub(),r.Vb(12,"nz-form-label",9),r.Hc(13,"Path"),r.Ub(),r.Vb(14,"nz-form-control"),r.Qb(15,"input",10),r.Ub(),r.Vb(16,"nz-form-label",11),r.Hc(17,"Hostname"),r.Ub(),r.Vb(18,"nz-form-control"),r.Qb(19,"input",12),r.Ub(),r.Ub(),r.Qb(20,"div",13),r.Vb(21,"div",14),r.Vb(22,"nz-collapse",15),r.Vb(23,"nz-collapse-panel",16),r.Vb(24,"label",17),r.Fc(25,ft,2,0,"span",0),r.Fc(26,vt,2,0,"span",0),r.Ub(),r.Ub(),r.Vb(27,"nz-collapse-panel",18),r.Vb(28,"nz-select",19),r.Qb(29,"nz-option",20),r.Qb(30,"nz-option",21),r.Ub(),r.Ub(),r.Vb(31,"nz-collapse-panel",22),r.Vb(32,"nz-form-control"),r.Vb(33,"nz-select",23),r.Qb(34,"nz-option",24),r.Qb(35,"nz-option",25),r.Qb(36,"nz-option",26),r.Qb(37,"nz-option",27),r.Qb(38,"nz-option",28),r.Ub(),r.Ub(),r.Ub(),r.Ub(),r.Ub(),r.Ub(),r.Ub(),r.Vb(39,"nz-tab",3),r.Fc(40,xt,2,0,"ng-template",null,29,r.Gc),r.Qb(42,"endpoint-actions-list",30),r.Ub(),r.Vb(43,"nz-tab",3),r.Fc(44,Ct,2,0,"ng-template",null,31,r.Gc),r.Vb(46,"div",32),r.Qb(47,"permissions-manager",33),r.Ub(),r.Ub(),r.Fc(48,zt,7,4,"nz-tab",34),r.hc(49,"async"),r.Ub(),r.Ub(),r.Sb()}if(2&e){const e=r.vc(5),t=r.vc(41),n=r.vc(45),i=r.gc();r.Bb(1),r.nc("formGroup",i.form),r.Bb(1),r.nc("nzAnimated",r.pc(13,wt)),r.Bb(1),r.nc("nzTitle",e),r.Bb(19),r.nc("nzBordered",!0),r.Bb(1),r.nc("nzActive",!0),r.Bb(2),r.nc("ngIf",!!i.form.value.Enabled),r.Bb(1),r.nc("ngIf",!i.form.value.Enabled),r.Bb(7),r.nc("nzTokenSeparators",r.pc(14,St)),r.Bb(6),r.nc("nzTitle",t),r.Bb(4),r.nc("nzTitle",n),r.Bb(5),r.nc("ngIf",r.ic(49,11,i.showDebugInformations$))}}const Mt=[{path:"",component:ve},{path:":id",component:(()=>{class e{constructor(e,t,n,i){this.uiService=e,this.route=t,this.rulesService=n,this.fb=i,this.rule$=Object(xe.a)([this.route.paramMap,this.route.queryParamMap,this.route.fragment]).pipe(Object(p.a)(([e,t,n])=>(this.Id=e.get("id"),this.rulesService.GetRule(this.Id))),Object(Ce.a)(),Object(p.a)(e=>(e.Actions=e.Actions.sort((e,t)=>e.Order-t.Order),e)),Object(l.a)(e=>{var t;this.BaseRule||(this.BaseRule=e),this.uiService.Set(t=>{t.Header.Title="Endpoint Rule",t.Header.SubTitle=e.Name,t.Header.Icon="form",t.Footer.Button1.Visible=!0,t.Footer.Button2.Visible=!0}),e.Permissions=null!==(t=e.Permissions)&&void 0!==t?t:[],console.log(e),this.form.patchValue(e)})),this.showDebugInformations$=this.uiService.showDebugInformations$,this.selectedTab=new a.a(0),this.uiService.Set(e=>{e.Footer.Button1.Disabled=!0,e.Footer.Button2.Disabled=!0,e.Footer.Button1.OnClick=()=>{this.save()},e.Footer.Button2.Text="Reset",e.Footer.Button2.OnClick=()=>{this.form.reset(this.BaseRule)},e.Footer.Show=!0}),this.form=this.fb.group({Id:[null],Name:[null,P.q.required],Scheme:[],Hostname:[],Path:[],Actions:[[]],HttpMethods:[[]],Permissions:[[]],Order:[],Enabled:[!1]})}ngOnInit(){this.form.get("Name").valueChanges.subscribe(e=>this.uiService.Set(t=>t.Header.SubTitle=e)),this.form.valueChanges.subscribe(e=>{this.form.valid?this.SetButtonStatus(e):this.uiService.Set(e=>{e.Footer.Button1.Disabled=!0,e.Footer.Button1.Text="Form not valid!"})})}GeneratePatchDocument(e,t){return e=null!=e?e:this.BaseRule,t=null!=t?t:this.form.value,Object(Oe.a)(e,t)}save(){var e,t=this.form.value;null===(e=t.Actions)||void 0===e||e.forEach(e=>{var t,n=/^(\-|\+)?([0-9]+|Infinity)$/.test(t=e.Id)?Number(t):NaN;Number.isNaN(n)||(e.Id=null)}),console.log(t),this.rulesService.Update(this.Id,t).pipe(Object(l.a)(()=>{this.BaseRule=this.form.value,this.SetButtonStatus(this.BaseRule)})).subscribe()}SetButtonStatus(e){var t=this.GeneratePatchDocument(this.BaseRule,e);this.uiService.Set(t.length>0?e=>{e.Footer.Button1.Disabled=!1,e.Footer.Button1.Text="Save Changes",e.Footer.Button2.Disabled=!1}:e=>{e.Footer.Button1.Disabled=!0,e.Footer.Button1.Text="No Changes",e.Footer.Button2.Disabled=!0})}tabChanged(e){var t;this.selectedTab.next(null!==(t=e.index)&&void 0!==t?t:0)}isNotSelected(e){return-1===this.form.value.HttpMethods.indexOf(e)}set BaseRule(e){this._baseRule=JSON.parse(JSON.stringify(e))}get BaseRule(){return this._baseRule}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(c.a),r.Pb(o.a),r.Pb(z),r.Pb(P.e))},e.\u0275cmp=r.Jb({type:e,selectors:[["endpoint-rule-details"]],decls:2,vars:3,consts:[[4,"ngIf"],["nz-form","",2,"flex-grow","1","display","flex","flex-direction","column","overflow","hidden",3,"formGroup"],[3,"nzAnimated","nzSelectChange"],[3,"nzTitle"],["BasicTitle",""],[2,"display","flex","flex-direction","row","padding","3px"],[2,"flex-grow","1"],["nzRequired","","nzFor","Name"],["nz-input","","formControlName","Name","id","Name",2,"width","100%"],["nzRequired","","nzFor","Path"],["nz-input","","formControlName","Path","id","Path",2,"width","100%"],["nzFor","Hostname"],["nz-input","","formControlName","Hostname","id","Hostname","placeHolder","*",2,"width","100%"],[2,"width","10px","margin-right","10px"],[2,"width","30%"],["nzAccordion","",3,"nzBordered"],["nzHeader","Options",3,"nzActive"],["nz-checkbox","","formControlName","Enabled"],["nzHeader","Schemes"],["nzMode","multiple","nzPlaceHolder","all Schemes allowed","formControlName","Scheme","nzMode","tags",2,"width","100%"],["nzLabel","Http","nzValue","http"],["nzLabel","Https","nzValue","https"],["nzHeader","Http Methods"],["nzMode","multiple","nzPlaceHolder","all Methods allowed","formControlName","HttpMethods","nzMode","tags",2,"width","100%",3,"nzTokenSeparators"],["nzLabel","Get","nzValue","Get"],["nzLabel","Post","nzValue","Post"],["nzLabel","Put","nzValue","Put"],["nzLabel","Delete","nzValue","Delete"],["nzLabel","Patch","nzValue","Patch"],["ActionsTitle",""],["formControlName","Actions"],["PermissionsTitle",""],[2,"height","100%","display","flex","padding","8px 0px"],["formControlName","Permissions"],[3,"nzTitle",4,"ngIf"],["nz-icon","","nzType","container"],["nz-icon","","nzType","ordered-list"],["icon","fa#shield-alt"],["DebugTitle",""],[2,"height","100%"],["nz-icon","","nzType","bug"]],template:function(e,t){1&e&&(r.Fc(0,yt,50,15,"ng-container",0),r.hc(1,"async")),2&e&&r.nc("ngIf",r.ic(1,1,t.rule$))},directives:[i.o,P.r,P.n,F.b,P.h,ze.c,ze.a,D.a,F.d,F.a,G.b,P.d,P.m,P.g,we.a,we.c,j.a,Z.b,Z.a,Ye,gt,V.a,T.a,ie.c],pipes:[i.b,i.i],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1;overflow:hidden}"]}),e})()}];let Pt=(()=>{class e{}return e.\u0275mod=r.Nb({type:e}),e.\u0275inj=r.Mb({factory:function(t){return new(t||e)},imports:[[o.l.forChild(Mt)],o.l]}),e})();var It=n("FG6W");let Ut=(()=>{class e{}return e.\u0275mod=r.Nb({type:e}),e.\u0275inj=r.Mb({factory:function(t){return new(t||e)},imports:[[i.c,P.p,Z.c,It.a]]}),e})(),kt=(()=>{class e{}return e.\u0275mod=r.Nb({type:e}),e.\u0275inj=r.Mb({factory:function(t){return new(t||e)},imports:[[i.c,P.p,Pt,u.d,It.a,Ut]]}),e})()}}]);